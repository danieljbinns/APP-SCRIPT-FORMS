<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <?!= include('Styles'); ?>
</head>
<body>
  <div class="container">
    <div class="header">
      <img src="<?= config.LOGO_URL ?>" alt="Logo" class="logo">
      <h1><?= config.FORM_NAME ?></h1>
      <p class="subtitle">Initial Employee Setup - Form 2</p>
    </div>

    <!-- Employee Context from InitialRequest -->
    <div class="context-card">
      <h2>New Hire Information</h2>
      <div class="info-grid">
        <div class="info-item">
          <span class="label">Workflow ID:</span>
          <span class="value"><?= workflowId ?></span>
        </div>
        <div class="info-item">
          <span class="label">Employee Name:</span>
          <span class="value"><?= workflowData.Employee_Name ?></span>
        </div>
        <div class="info-item">
          <span class="label">Hire Date:</span>
          <span class="value"><?= workflowData.Hire_Date ?></span>
        </div>
        <div class="info-item">
          <span class="label">Position:</span>
          <span class="value"><?= workflowData.Position ?></span>
        </div>
        <div class="info-item">
          <span class="label">Site:</span>
          <span class="value"><?= workflowData.Site_Name ?></span>
        </div>
        <div class="info-item">
          <span class="label">Manager:</span>
          <span class="value"><?= workflowData.Manager_Name ?> (<?= workflowData.Manager_Email ?>)</span>
        </div>
        <div class="info-item">
          <span class="label">Employment Type:</span>
          <span class="value"><?= workflowData.Employment_Type ?></span>
        </div>
        <div class="info-item">
          <span class="label">Email Requested:</span>
          <span class="value"><?= workflowData.Email_Requested || 'Not specified' ?></span>
        </div>
      </div>
    </div>

    <form id="taskForm">
      <input type="hidden" name="workflowId" value="<?= workflowId ?>">
      <input type="hidden" name="Employee_Name" value="<?= workflowData.Employee_Name ?>">

      <!-- Internal Employee ID Section -->
      <div class="form-section">
        <h2>Internal Employee ID</h2>
        <div class="form-group">
          <label for="employeeId">Internal Employee ID: <span class="required">*</span></label>
          <input type="text" id="employeeId" name="Internal_Employee_ID"
                 value="<?= generatedEmployeeId ?>" required>
          <small>Auto-generated. Modify if needed or use existing ID for rehires.</small>
        </div>
      </div>

      <!-- SiteDocs Section - All Employees -->
      <div class="form-section">
        <h2>SiteDocs Setup</h2>
        <p class="section-note">All employees receive SiteDocs worker access</p>

        <div class="form-group">
          <label for="siteDocsWorkerId">SiteDocs Worker ID: <span class="required">*</span></label>
          <input type="text" id="siteDocsWorkerId" name="SiteDocs_Worker_ID" required>
          <small>Worker ID assigned in SiteDocs system</small>
        </div>

        <div class="form-group">
          <label for="siteDocsJobCode">SiteDocs Job Code: <span class="required">*</span></label>
          <select id="siteDocsJobCode" name="SiteDocs_Job_Code" required>
            <option value="">-- Select Job Code --</option>
            <option value="Hourly 1">Hourly 1</option>
            <option value="Hourly 2">Hourly 2</option>
            <option value="Salary 1">Salary 1</option>
            <option value="Salary 2">Salary 2</option>
            <option value="Supervisor">Supervisor</option>
            <option value="Manager">Manager</option>
          </select>
          <small>Job classification for SiteDocs permissions</small>
        </div>
      </div>

      <!-- SiteDocs Admin/Login Access - Conditional -->
      <? if (workflowData.SiteDocs_Access === 'Yes') { ?>
      <div class="form-section highlight">
        <h2>SiteDocs Admin/Login Access</h2>
        <p class="section-note"><strong>Note:</strong> SiteDocs admin/login access was requested in the initial form.</p>

        <div class="form-row-2">
          <div class="form-group">
            <label for="siteDocsUsername">SiteDocs Training Username: <span class="required">*</span></label>
            <input type="text" id="siteDocsUsername" name="SiteDocs_Training_Username" required>
          </div>

          <div class="form-group">
            <label for="siteDocsPassword">SiteDocs Training Password: <span class="required">*</span></label>
            <input type="text" id="siteDocsPassword" name="SiteDocs_Training_Password" required>
            <small>Temporary password for initial login</small>
          </div>
        </div>
      </div>
      <? } ?>

      <!-- DSS Training Access Section -->
      <div class="form-section">
        <h2>DSS Training Access</h2>
        <p class="section-note">All employees receive DSS training platform access</p>

        <div class="form-row-2">
          <div class="form-group">
            <label for="dssUsername">DSS Username: <span class="required">*</span></label>
            <input type="text" id="dssUsername" name="DSS_Username"
                   value="<?= generatedDssUsername ?>" required>
            <small>Auto-generated from name. Modify if needed.</small>
          </div>

          <div class="form-group">
            <label for="dssPassword">DSS Password: <span class="required">*</span></label>
            <input type="text" id="dssPassword" name="DSS_Password" required>
            <small>Temporary password for initial login</small>
          </div>
        </div>
      </div>

      <!-- BOSS System Access Section -->
      <div class="form-section">
        <h2>BOSS System Access</h2>
        <div class="form-group">
          <label>Employee Assigned to WIS Module: <span class="required">*</span></label>
          <div class="radio-group">
            <label>
              <input type="radio" name="WIS_Module_Assigned" value="Yes" required>
              <span>Yes</span>
            </label>
            <label>
              <input type="radio" name="WIS_Module_Assigned" value="No" required>
              <span>No</span>
            </label>
          </div>
          <small>Workplace Inspection System module access</small>
        </div>
      </div>

      <!-- Notes Section -->
      <div class="form-section">
        <h2>Setup Notes</h2>
        <div class="form-group">
          <label for="setupNotes">Additional Comments / Notes:</label>
          <textarea id="setupNotes" name="Setup_Notes" rows="4"
                    placeholder="Any additional notes about the employee setup process"></textarea>
        </div>
      </div>

      <button type="submit" class="btn-submit">Complete Employee Setup</button>
      <div id="status"></div>
    </form>
  </div>

  <script>
    document.getElementById('taskForm').addEventListener('submit', function(e) {
      e.preventDefault();
      const formData = Object.fromEntries(new FormData(e.target));
      document.getElementById('status').innerHTML = '<div class="status-info">Submitting...</div>';

      google.script.run
        .withSuccessHandler(r => {
          if (r.success) {
            document.getElementById('status').innerHTML =
              '<div class="success">' + r.message +
              '<p style="margin-top: 10px;">Task ID: <strong>' + r.taskId + '</strong></p>' +
              '<p style="margin-top: 10px;">You may now close this window.</p></div>';
            document.getElementById('taskForm').style.display = 'none';
          } else {
            document.getElementById('status').innerHTML =
              '<div class="error">' + r.message + '</div>';
          }
        })
        .withFailureHandler(e => {
          document.getElementById('status').innerHTML =
            '<div class="error">Error: ' + e.message + '</div>';
        })
        .processFormSubmission(formData);
    });
  </script>
</body>
</html>
