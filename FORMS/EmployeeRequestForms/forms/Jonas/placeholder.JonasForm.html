<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><?= formTitle ?> - REQUEST_FORMS</title>
    <?!= include('Styles'); ?>
  </head>
  <body>
    <div class="container">

      <!-- Header -->
      <div class="header">
        <img src="<?= logoUrl ?>" alt="<?= companyName ?>" class="logo">
        <div class="company-name"><?= companyName ?></div>
      </div>

      <h1><?= formTitle ?></h1>
      <p>This is a placeholder form for testing. Click "Complete" to mark this step as done.</p>

      <!-- Status Message -->
      <div id="status-message" class="status-message"></div>

      <!-- Employee Information (Read-Only) -->
      <div class="form-section">
        <h2>Employee Information</h2>

        <table style="width: 100%; border-collapse: collapse;">
          <tr>
            <td style="padding: 8px; font-weight: 600; width: 40%;">Request ID:</td>
            <td style="padding: 8px;"><?= requestData['Request ID'] || 'N/A' ?></td>
          </tr>
          <tr style="background: #f9f9f9;">
            <td style="padding: 8px; font-weight: 600;">Employee Name:</td>
            <td style="padding: 8px;"><?= requestData['First Name'] || '' ?> <?= requestData['Last Name'] || '' ?></td>
          </tr>
          <tr>
            <td style="padding: 8px; font-weight: 600;">Hire Date:</td>
            <td style="padding: 8px;"><?= requestData['Hire Date'] || 'N/A' ?></td>
          </tr>
          <tr style="background: #f9f9f9;">
            <td style="padding: 8px; font-weight: 600;">Site:</td>
            <td style="padding: 8px;"><?= requestData['Site Name'] || 'N/A' ?></td>
          </tr>
          <tr>
            <td style="padding: 8px; font-weight: 600;">Department:</td>
            <td style="padding: 8px;"><?= requestData['Department'] || 'N/A' ?></td>
          </tr>
          <tr style="background: #f9f9f9;">
            <td style="padding: 8px; font-weight: 600;">Position:</td>
            <td style="padding: 8px;"><?= requestData['Position/Title'] || 'N/A' ?></td>
          </tr>
          <tr>
            <td style="padding: 8px; font-weight: 600;">Manager:</td>
            <td style="padding: 8px;"><?= requestData['Reporting Manager Email'] || 'N/A' ?></td>
          </tr>
        </table>
      </div>

      <!-- Placeholder Action -->
      <div class="form-section">
        <h2>Action Required</h2>
        <p>For testing purposes, simply click the button below to complete this step.</p>

        <div class="button-group">
          <button type="button" onclick="handleComplete()" id="complete-btn">
            ✓ Mark as Complete
          </button>
        </div>
      </div>

    </div>

    <script>
      // Server-side data injection
      const requestId = '<?= requestData["Request ID"] ?>';
      const formType = '<?= formType ?>';

      /**
       * Handle placeholder form completion
       */
      function handleComplete() {
        const completeBtn = document.getElementById('complete-btn');
        const statusMessage = document.getElementById('status-message');

        // Disable button
        completeBtn.disabled = true;
        completeBtn.innerHTML = 'Processing... <span class="spinner"></span>';

        // Call server-side function
        google.script.run
          .withSuccessHandler(function(response) {
            if (response.success) {
              showMessage('success', response.message);
              completeBtn.textContent = '✓ Completed!';
              completeBtn.style.background = '#4caf50';
            } else {
              showMessage('error', response.message);
              completeBtn.disabled = false;
              completeBtn.textContent = '✓ Mark as Complete';
            }
          })
          .withFailureHandler(function(error) {
            showMessage('error', 'System error: ' + error.message);
            completeBtn.disabled = false;
            completeBtn.textContent = '✓ Mark as Complete';
          })
          .processPlaceholder(requestId, formType);
      }

      /**
       * Show status message
       */
      function showMessage(type, message) {
        const statusMessage = document.getElementById('status-message');
        statusMessage.className = 'status-message status-' + type;
        statusMessage.textContent = message;
        statusMessage.style.display = 'block';

        // Scroll to message
        statusMessage.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
      }
    </script>
  </body>
</html>
