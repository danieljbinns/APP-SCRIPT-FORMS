# Workflow Architecture Specification

## Overview
REQUEST_FORMS is a task-based workflow system where forms are independent, reusable components that can be used in multiple workflows.

## Core Concepts

### 1. Forms as Independent Tasks
Each form is:
- A standalone Apps Script project
- Capable of generating its own Task ID
- Writes to its own spreadsheet/sheet tab
- Can be triggered by any workflow or used independently

### 2. Dual ID System

**Task ID** (Form-specific):
- Generated by each individual form
- Format: `TASK-{FORM}-{YYYYMMDD}-{XXXX}`
- Examples: `TASK-HR-20251203-A1B2`, `TASK-IT-20251203-C3D4`
- Unique identifier for the task completion record

**Workflow ID** (Workflow-specific):
- Generated by the workflow initiator form
- Format: `WF-REQ-{YYYYMMDD}-{XXXX}`
- Example: `WF-REQ-20251203-E5F6`
- Links multiple tasks together in a workflow

### 3. Workflow Linking Sheet

**Location**: Team Group Companies Shared Drive
**Spreadsheet Name**: `WORKFLOW_TRACKING`
**Sheet Name**: `Workflow_Tasks`

**Columns**:
```
Workflow_ID          | Task_Type      | Task_ID           | Status      | Form_URL               | Created_Date | Completed_Date | Completed_By
WF-REQ-20251203-001  | HR             | TASK-HR-001       | Complete    | https://...&id=001     | 2025-12-03   | 2025-12-03     | hr@team-group.com
WF-REQ-20251203-001  | IT             | TASK-IT-002       | Pending     | https://...&id=001     | 2025-12-03   |                |
WF-REQ-20251203-001  | FLEETIO        | TASK-FLEETIO-003  | Open        | https://...&id=001     | 2025-12-03   |                |
WF-REQ-20251203-002  | HR             | TASK-HR-004       | Complete    | https://...&id=002     | 2025-12-03   | 2025-12-03     | hr@team-group.com
```

**Status Values**:
- `Open` - Task created, notification sent, not started
- `In Progress` - Task opened by assignee
- `Complete` - Task completed and saved
- `Cancelled` - Task cancelled (workflow cancelled or no longer needed)

## Data Flow

### Initial Request Submission (REQUEST_FORMS):
1. User submits Initial Request form
2. System generates `Workflow_ID` (e.g., `WF-REQ-20251203-001`)
3. System writes to `Initial Requests` sheet with Workflow_ID
4. System creates entries in `Workflow_Tasks` sheet for each triggered task:
   - HR task (Open)
   - IT task (Open)
   - Fleetio task (Open)
   - Credit Card task (Open)
   - etc.
5. System sends notification emails to groups with prefilled form URLs
6. Email contains: `{webapp_url}?form=hr&wfid=WF-REQ-20251203-001`

### Sub-Form Completion (FORM_HR, FORM_IT, etc.):
1. User clicks prefilled link from email
2. Form loads with `wfid` parameter (e.g., `WF-REQ-20251203-001`)
3. Form retrieves workflow data from Initial Requests sheet using `wfid`
4. User completes form
5. Form generates own `Task_ID` (e.g., `TASK-HR-20251203-A1B2`)
6. Form writes to its own sheet (e.g., `HR_TASKS`) with both IDs
7. Form updates `Workflow_Tasks` sheet:
   - Find row where `Workflow_ID = wfid` AND `Task_Type = HR`
   - Update `Task_ID`, `Status = Complete`, `Completed_Date`, `Completed_By`

## Spreadsheet Structure

### REQUEST_FORMS Spreadsheet
**Location**: Team Group Companies Shared Drive
**Folder**: `/REQUEST_FORMS/`
**Name**: `REQUEST_FORMS_DATA`

**Sheets**:
1. `Initial Requests` - Main intake form submissions
   - Columns: Workflow_ID, Submission Timestamp, Requester Name, Employee Name, Hire Date, etc.

### Individual Form Spreadsheets
Each form project has its own spreadsheet:

**FORM_HR** → `HR_TASKS` spreadsheet
- Task_ID, Workflow_ID, Employee Name, Benefits Enrollment, I-9 Complete, etc.

**FORM_IT** → `IT_TASKS` spreadsheet
- Task_ID, Workflow_ID, Employee Name, Email Created, Computer Assigned, etc.

**FORM_FLEETIO** → `FLEETIO_TASKS` spreadsheet
- Task_ID, Workflow_ID, Employee Name, Vehicle Assigned, Fuel Card, etc.

### Workflow Tracking Spreadsheet
**Name**: `WORKFLOW_TRACKING`
**Location**: Team Group Companies Shared Drive / REQUEST_FORMS folder

**Sheets**:
1. `Workflow_Tasks` - Links workflows to tasks (structure shown above)
2. `Workflow_Summary` - Aggregated view (optional dashboard)

## Project Structure

```
P:\Repos\github\danieljbinns\APP SCRIPT FORMS\
├── REQUEST_FORMS\              # Main workflow initiator
│   ├── Code.gs
│   ├── Config.gs
│   ├── Setup.gs
│   ├── EmailUtils.gs
│   ├── WorkflowUtils.gs        # NEW: Workflow linking functions
│   ├── InitialRequest.html
│   └── appsscript.json
│
├── FORM_HR\                    # Standalone HR task form
│   ├── Code.gs
│   ├── Config.gs
│   ├── HRForm.html
│   └── appsscript.json
│
├── FORM_IT\                    # Standalone IT task form
│   ├── Code.gs
│   ├── Config.gs
│   ├── ITForm.html
│   └── appsscript.json
│
├── FORM_FLEETIO\               # Standalone Fleetio task form
├── FORM_CREDITCARD\            # Standalone Credit Card task form
├── FORM_REVIEW306090\          # Standalone 30-60-90 Review form
├── FORM_ADP_SUPERVISOR\        # Standalone ADP Supervisor form
├── FORM_ADP_MANAGER\           # Standalone ADP Manager form
├── FORM_JONAS\                 # Standalone JONAS access form
└── FORM_SITEDOCS\              # Standalone SiteDocs training form
```

## Future Workflows

Because each form is independent, they can be reused in new workflows:

**Example: Employee Promotion Workflow**
- Initial form: PROMOTION_REQUEST
- Triggered tasks: HR (update position), IT (update permissions), JONAS (update access)
- Same FORM_HR, FORM_IT, FORM_JONAS projects, different workflow

**Example: Employee Termination Workflow**
- Initial form: TERMINATION_REQUEST
- Triggered tasks: HR (benefits), IT (disable accounts), Fleetio (return vehicle), Credit Card (cancel)
- Reuses existing form projects

## Implementation Phases

### Phase 1: Workflow Tracking Foundation ✓ (Current)
- [ ] Create `WORKFLOW_TRACKING` spreadsheet
- [ ] Update REQUEST_FORMS to generate Workflow_ID
- [ ] Create WorkflowUtils.gs for linking functions
- [ ] Update Config.gs with workflow architecture constants

### Phase 2: REQUEST_FORMS Integration
- [ ] Update processInitialRequest() to create workflow tasks
- [ ] Update email notifications to include wfid parameter
- [ ] Add workflow status tracking

### Phase 3: Separate Form Projects
- [ ] Create FORM_HR standalone project
- [ ] Create FORM_IT standalone project
- [ ] Create remaining 7 form projects
- [ ] Each form updates Workflow_Tasks on completion

### Phase 4: Dashboard & Reporting
- [ ] Create workflow status dashboard
- [ ] Add completion percentage tracking
- [ ] Email notifications for workflow completion

## Configuration Updates Needed

### Config.gs additions:
```javascript
// Workflow Tracking
WORKFLOW_TRACKING_SPREADSHEET_ID: 'TBD',
WORKFLOW_TASKS_SHEET: 'Workflow_Tasks',

// Workflow ID prefix
WORKFLOW_ID_PREFIX: 'WF-REQ',

// Task types
TASK_TYPES: {
  HR: 'HR',
  IT: 'IT',
  FLEETIO: 'FLEETIO',
  CREDIT_CARD: 'CREDIT_CARD',
  REVIEW_306090: 'REVIEW_306090',
  ADP_SUPERVISOR: 'ADP_SUPERVISOR',
  ADP_MANAGER: 'ADP_MANAGER',
  JONAS: 'JONAS',
  SITEDOCS: 'SITEDOCS'
},

// Task statuses
TASK_STATUS: {
  OPEN: 'Open',
  IN_PROGRESS: 'In Progress',
  COMPLETE: 'Complete',
  CANCELLED: 'Cancelled'
}
```
