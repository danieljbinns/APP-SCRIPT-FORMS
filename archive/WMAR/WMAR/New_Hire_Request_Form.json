{"files":[{"id":"b677af5f-c1f4-467b-a745-6fa503662542","name":"appsscript","type":"json","source":"{\n  \"timeZone\": \"America/Toronto\",\n  \"dependencies\": {},\n  \"exceptionLogging\": \"STACKDRIVER\",\n  \"runtimeVersion\": \"V8\",\n  \"webapp\": {\n    \"executeAs\": \"USER_DEPLOYING\",\n    \"access\": \"DOMAIN\"\n  }\n}"},{"id":"d694448a-a495-4341-8a94-e4e1e9a13fc6","name":"Code","type":"server_js","source":"// --- CONFIGURATION ---\n// This section contains global constants that configure the script\u0027s behavior.\n// Changing these values will alter which forms, spreadsheets, and email addresses the script uses.\n\n// The unique ID of the Google Form used for initial employee requests.\nconst FORM_ID \u003d \u002718_TDAe9LsUWR5dAonQTAycAJzWPBF_ynegNaaZGKK_8\u0027;\n// The unique ID of the master Google Spreadsheet where all request data is stored.\nconst SPREADSHEET_ID \u003d \u00271f9tMk4REw8mGxkf9Ao9s5SSLcjd-Z2DGFPSBB6Ezod8\u0027;\n// The unique ID of the Google Spreadsheet containing job codes and site information.\nconst JOB_CODES_SHEET_ID \u003d \u00271ZAMh-XmTT06HWzMNmZiDfh4JslJVrykkSP0CeNPjdKY\u0027;\n// The URL of the company logo to be displayed on web pages and in PDF documents.\nconst LOGO_URL \u003d \u0027https://team-group.com/wp-content/uploads/2024/06/TGC-Flag-White.jpg\u0027;\n// The name of the specific sheet within the master spreadsheet that holds the data.\nconst MASTER_SHEET_NAME \u003d \u0027All Responses\u0027;\n\n// --- Email Configuration ---\n// Email addresses for various stages of the workflow.\n\n// Email address to receive the initial request and HR setup task.\nconst HR_SETUP_EMAIL \u003d \u0027dbinns@team-group.com\u0027;\n// Email address to receive the final approval task for salaried employees.\nconst HR_APPROVAL_EMAIL \u003d \u0027dbinns@team-group.com\u0027;\n// Email address to receive the IT setup task.\nconst IT_SETUP_EMAIL \u003d \u0027dbinns@team-group.com\u0027;\n\n// Emails for parallel tasks that are triggered based on form responses.\nconst FLEETIO_EMAIL \u003d \u0027dbinns@team-group.com\u0027;\nconst CREDIT_CARD_EMAIL \u003d \u0027dbinns@team-group.com\u0027;\nconst BUSINESS_CARD_EMAIL \u003d \u0027dbinns@team-group.com\u0027;\nconst THIRTY_SIXTY_NINETY_EMAIL \u003d \u0027dbinns@team-group.com\u0027;\nconst ADP_MANAGER_ACCESS_EMAIL \u003d \u0027dbinns@team-group.com\u0027;\nconst ADP_SUPERVISOR_ACCESS_EMAIL \u003d \u0027dbinns@team-group.com\u0027;\nconst JR_EMAIL \u003d \u0027dbinns@team-group.com\u0027;\nconst JR_306090_EMAIL \u003d \u0027dbinns@team-group.com\u0027;\nconst JONAS_EMAIL \u003d \u0027dbinns@team-group.com\u0027;\nconst SITEDOCS_EMAIL \u003d \u0027dbinns@team-group.com\u0027; \n\n\n// --- MASTER ROUTER ---\n/**\n * @description This is the main function that runs when a user accesses the web app\u0027s URL. It acts as a router, directing the user to the correct web page based on the URL parameters.\n * @howItWorks It inspects the `e.parameter` object from the URL.\n * - If there are no parameters, it shows the main employee request form (Index.html).\n * - If there\u0027s an \u0027id\u0027, it fetches the corresponding request data.\n * - Based on additional parameters like \u0027view\u0027 or \u0027action\u0027, it routes to specific pages like the HR form, IT form, approval/denial pages, or parallel task forms.\n * - If a request is in a state that doesn\u0027t match the URL parameters (e.g., trying to approve an already completed request), it shows a generic \"Closed\" page with the current status.\n * @output {HtmlService.HtmlOutput} An HTML page to be displayed in the user\u0027s browser.\n */\nfunction doGet(e) {\n  // Get the URL parameters (e.g., ?id\u003d...\u0026view\u003d...).\n  const p \u003d e.parameter;\n\n  // If no parameters are provided, show the main submission form.\n  if (Object.keys(p).length \u003d\u003d\u003d 0) {\n    return showPage(\u0027Index.html\u0027, \u0027Employee Request Form\u0027);\n  }\n\n  // All subsequent routes require a request ID.\n  const id \u003d p.id;\n  if (!id) { return HtmlService.createHtmlOutput(\u0027Missing Request ID.\u0027); }\n\n  // Fetch the data for the given request ID from the spreadsheet.\n  const data \u003d getRequestData(id);\n  if (!data) { return HtmlService.createHtmlOutput(\u0027Invalid Request ID.\u0027); }\n  \n  // Get the current workflow status of the request.\n  const status \u003d data[\u0027Workflow Status\u0027];\n  Logger.log(`Routing request ID ${id} with status: \"${status}\"`);\n\n  // --- Router for all parallel tasks (Fleetio, Credit Card, etc.) ---\n  const parallelTasks \u003d getParallelTaskMap();\n  // Find if the \u0027view\u0027 parameter in the URL matches a defined parallel task.\n  const parallelTask \u003d parallelTasks.find(task \u003d\u003e task.viewName \u003d\u003d\u003d p.view);\n  if (parallelTask) {\n    // Check if the task is already completed.\n    const taskStatus \u003d Array.isArray(parallelTask.statusColumn) ? data[parallelTask.statusColumn[0]] : data[parallelTask.statusColumn];\n    if (taskStatus \u003d\u003d\u003d \u0027Complete\u0027) {\n      return showClosedPage(`This ${parallelTask.formTitle} form has already been completed.`);\n    }\n    // Prepare data to be passed to the HTML template.\n    const templateData \u003d {\n      requestId: id,\n      employeeName: `${data[\u0027First Name\u0027]} ${data[\u0027Last Name\u0027]}`,\n      employeeId: data[\u0027Temporary ID\u0027],\n      formTitle: parallelTask.formTitle,\n      statusColumn: parallelTask.statusColumn,\n      additionalAccounts: data[\u0027Additional Credit/ Purchasing Accounts\u0027] || \u0027\u0027\n    };\n    // Use a specific HTML file if defined, otherwise use the generic one.\n    const formFile \u003d parallelTask.formFile || \u0027ParallelTaskForm.html\u0027;\n    return showPage(formFile, parallelTask.formTitle, templateData);\n  }\n\n  // --- Router for main sequential tasks (HR, IT) ---\n  if (p.view) {\n    if (p.view \u003d\u003d\u003d \u0027hr\u0027 \u0026\u0026 status \u003d\u003d\u003d \u0027Pending HR Setup\u0027) {\n      return showPage(\u0027HR.html\u0027, \u0027Employee Setup Form\u0027, { requestId: id });\n    }\n    if (p.view \u003d\u003d\u003d \u0027it\u0027 \u0026\u0026 status \u003d\u003d\u003d \u0027Pending IT Setup\u0027) {\n      return showPage(\u0027ITSetup.html\u0027, \u0027IT Setup Form\u0027, { requestId: id });\n    }\n    // If the view doesn\u0027t match the current status, show the closed page.\n    return showClosedPage(status);\n  }\n  \n  // --- Router for final approval actions ---\n  if (p.action) {\n    if (status \u003d\u003d\u003d \u0027Pending Final HR Approval\u0027) {\n      if (p.action \u003d\u003d\u003d \u0027approve\u0027) {\n         return showPage(\u0027Approval.html\u0027, \u0027Final Approval\u0027, { approvalId: id, submitFunction: \u0027processFinalApproval\u0027 });\n      }\n      if (p.action \u003d\u003d\u003d \u0027deny\u0027) {\n         return showPage(\u0027Denial.html\u0027, \u0027Final Denial\u0027, { approvalId: id, submitFunction: \u0027processFinalDenial\u0027 });\n      }\n      if (p.action \u003d\u003d\u003d \u0027sendback\u0027) {\n         return showPage(\u0027SendBack.html\u0027, \u0027Send Back Request\u0027, { requestId: id });\n      }\n    }\n    // If the action is not valid for the current status, show the closed page.\n    return showClosedPage(status);\n  }\n  \n  // --- Router for editing a request that was sent back ---\n  if (p.id \u0026\u0026 !p.view \u0026\u0026 !p.action) {\n    if (status \u003d\u003d\u003d \u0027Sent Back to Requester\u0027) {\n      // Re-opens the main form, which will be pre-populated with existing data.\n      return showPage(\u0027Index.html\u0027, \u0027Edit Employee Request\u0027);\n    } else {\n      // If the request is not in an editable state, show the closed page.\n      return showClosedPage(status);\n    }\n  }\n\n  // Fallback for any other combination of parameters.\n  return showClosedPage(status);\n}\n\n// --- DATA PROVIDERS ---\n// These functions are called from the client-side JavaScript (HTML files) to fetch data needed to populate the forms.\n\n/**\n * @description Fetches all the necessary data for the initial requester form (Index.html).\n * @howItWorks It checks if an \u0027id\u0027 is provided to fetch existing data for an edit. It also fetches the structure of the Google Form (all the questions) and the list of job codes. It sanitizes the data to ensure dates are in a client-friendly format.\n * @output {object} An object containing `requestData` (or null if new), `formStructure`, and `jobCodeData`. Returns an `error` object on failure.\n */\nfunction getRequesterInitialData(params) {\n  try {\n    const id \u003d params.id;\n    let data \u003d null;\n    if (id) {\n      data \u003d getRequestData(id);\n    }\n    const structure \u003d getFormStructure();\n    const jobCodes \u003d getJobCodeData();\n    const sanitizedData \u003d sanitizeDataForClient(data);\n    return { requestData: sanitizedData, formStructure: structure, jobCodeData: jobCodes };\n  } catch (e) {\n    Logger.log(e);\n    return { error: e.message };\n  }\n}\n\n/**\n * @description Fetches data for the HR Setup form and generates a suggested DSS username.\n * @howItWorks It retrieves the request data using the `requestId`. It then looks up the site abbreviation from the job codes data sheet. Using the employee\u0027s initials, hire date, and site abbreviation, it constructs a username (e.g., \u0027DB20250829KIT\u0027). This generated username is added to the data object before being sent to the client.\n * @output {object} A sanitized data object for the request, including the new `generatedDssUsername` property. Returns null on failure.\n */\nfunction getHrRequestData(requestId) {\n  try {\n    let data \u003d getRequestData(requestId);\n    if (data) {\n      const jobCodes \u003d getJobCodeData();\n      const siteName \u003d data[\u0027Site Name\u0027];\n      const siteInfo \u003d jobCodes.find(row \u003d\u003e row[0] \u003d\u003d\u003d siteName);\n      \n      if (siteInfo) {\n        const siteAbbreviation \u003d siteInfo[1];\n        const firstInitial \u003d data[\u0027First Name\u0027] ? data[\u0027First Name\u0027].charAt(0) : \u0027X\u0027;\n        const lastInitial \u003d data[\u0027Last Name\u0027] ? data[\u0027Last Name\u0027].charAt(0) : \u0027X\u0027;\n        \n        let datePart;\n        const hireDate \u003d data[\u0027Hire Date\u0027];\n        if (hireDate \u0026\u0026 hireDate instanceof Date) {\n            datePart \u003d Utilities.formatDate(hireDate, Session.getScriptTimeZone(), \u0027yyyyMMdd\u0027);\n        } else {\n            datePart \u003d Utilities.formatDate(new Date(null), Session.getScriptTimeZone(), \u0027yyyyMMdd\u0027);\n        }\n        data.generatedDssUsername \u003d `${firstInitial}${lastInitial}${datePart}${siteAbbreviation}`.toUpperCase();\n      }\n    }\n    return sanitizeDataForClient(data);\n  } catch(e) {\n    Logger.log(`Error in getHrRequestData: ${e.message}`);\n    return null;\n  }\n}\n\n/**\n * @description Fetches data for the IT Setup form.\n * @howItWorks It simply calls `getRequestData` with the provided `requestId` and sanitizes the result for client-side use.\n * @output {object} A sanitized data object for the request. Returns null on failure.\n */\nfunction getItSetupData(requestId) {\n  try {\n    let data \u003d getRequestData(requestId);\n    return sanitizeDataForClient(data);\n  } catch(e) {\n    Logger.log(e);\n    return null;\n  }\n}\n\n// --- FORM SUBMISSION ROUTER ---\n/**\n * @description A server-side router that receives all form submissions from the client.\n * @howItWorks It reads the `formType` property from the submitted `formData` object. Based on this value (\u0027requester\u0027, \u0027hr\u0027, \u0027it\u0027, etc.), it calls the appropriate handler function to process the submission.\n * @output {object} A status object (e.g., `{status: \u0027success\u0027, message: \u0027...\u0027}`) which is sent back to the client to confirm the submission.\n */\nfunction processSubmission(formData) {\n  try {\n    const formType \u003d formData.formType;\n    if (formType \u003d\u003d\u003d \u0027requester\u0027) return handleRequesterSubmission(formData);\n    if (formType \u003d\u003d\u003d \u0027hr\u0027) return handleHrSetupSubmission(formData);\n    if (formType \u003d\u003d\u003d \u0027it\u0027) return handleItSubmission(formData);\n    if (formType \u003d\u003d\u003d \u0027parallel_task_submission\u0027) return handleParallelTaskSubmission(formData);\n    throw new Error(`Unknown form type submitted: ${formType}`);\n  } catch(e) {\n    Logger.log(`Error in processSubmission: ${e.message}`);\n    return { status: \u0027error\u0027, message: `Server error: ${e.message}`};\n  }\n}\n\n// --- WORKFLOW STAGE HANDLERS ---\n\n/**\n * @description Handles the submission of the initial employee request form, for both new and edited requests.\n * @howItWorks \n * - It sets the `Submission Timestamp` and a `Post-Processing Status` to \u0027Pending Requester Emails\u0027.\n * - If a `Request ID` exists in the form data, it treats it as an edit, updates the existing row in the spreadsheet, and sets the `Workflow Status` to \u0027Pending HR Setup\u0027.\n * - If no `Request ID` exists, it\u0027s a new submission. It generates a unique `Request ID` (using timestamp) and a daily incrementing `Temporary ID`. It then appends this new request as a new row to the spreadsheet.\n * - Finally, it calls `createPostProcessingTrigger()` to schedule the email notifications.\n * @output {object} A success object with a confirmation message for the user.\n */\nfunction handleRequesterSubmission(formData) {\n  const sheet \u003d SpreadsheetApp.openById(SPREADSHEET_ID).getSheetByName(MASTER_SHEET_NAME);\n  const employeeName \u003d formData[\u0027First Name\u0027] + \u0027 \u0027 + formData[\u0027Last Name\u0027];\n  let message;\n  let requestId \u003d formData[\u0027Request ID\u0027];\n\n  formData[\u0027Submission Timestamp\u0027] \u003d new Date();\n  \n  // Set the post-processing status before writing to the sheet. This flags the row for the queue processor.\n  formData[\u0027Post-Processing Status\u0027] \u003d \u0027Pending Requester Emails\u0027;\n\n  if (requestId) { // This is for an EDIT of a sent-back request.\n    formData[\u0027Workflow Status\u0027] \u003d \u0027Pending HR Setup\u0027;\n    updateSheetData(sheet, requestId, formData); // Update the existing row.\n    message \u003d `Your edited request for ${employeeName} has been resubmitted.`;\n  } else { // This is for a NEW submission.\n    // Generate a human-readable temporary ID based on date and a daily counter.\n    const today \u003d new Date();\n    const dateStr \u003d Utilities.formatDate(today, Session.getScriptTimeZone(), \u0027yyMMdd\u0027);\n    const scriptProperties \u003d PropertiesService.getScriptProperties();\n    const propertyKey \u003d \u0027daily_increment_\u0027 + dateStr;\n    \n    let currentIncrement \u003d scriptProperties.getProperty(propertyKey);\n    let nextIncrement \u003d currentIncrement ? parseInt(currentIncrement) + 1 : 1;\n    scriptProperties.setProperty(propertyKey, nextIncrement);\n    \n    const increment \u003d nextIncrement.toString().padStart(3, \u00270\u0027);\n    const temporaryId \u003d `${dateStr}${increment}`;\n    \n    // Generate a unique system ID for the request.\n    requestId \u003d `REQ-${new Date().getTime()}`;\n    formData[\u0027Request ID\u0027] \u003d requestId;\n    formData[\u0027Temporary ID\u0027] \u003d temporaryId;\n    formData[\u0027Workflow Status\u0027] \u003d \u0027Pending HR Setup\u0027;\n    \n    appendDataToSheet(sheet, formData); // Add as a new row.\n    message \u003d `Form submitted! It is now being processed.`;\n  }\n  \n  SpreadsheetApp.flush(); // Ensure all changes are written to the spreadsheet.\n  createPostProcessingTrigger(); // Schedule the email processing.\n  \n  return { status: \u0027success\u0027, message: message };\n}\n\n/**\n * @description Handles the submission of the HR Setup form.\n * @howItWorks It updates the `Workflow Status` to \u0027Pending IT Setup\u0027, adds an HR submission timestamp, and sets the `Post-Processing Status` to \u0027Pending HR Emails\u0027. It then updates the corresponding row in the spreadsheet and creates a trigger to process the next batch of emails.\n * @output {object} A success object with a confirmation message.\n */\nfunction handleHrSetupSubmission(formData) {\n  const sheet \u003d SpreadsheetApp.openById(SPREADSHEET_ID).getSheetByName(MASTER_SHEET_NAME);\n  const requestId \u003d formData[\u0027Request ID\u0027];\n\n  formData[\u0027Workflow Status\u0027] \u003d \u0027Pending IT Setup\u0027; \n  formData[\u0027HR - Date of Submission\u0027] \u003d new Date();\n  formData[\u0027Post-Processing Status\u0027] \u003d \u0027Pending HR Emails\u0027;\n  updateSheetData(sheet, requestId, formData);\n  \n  SpreadsheetApp.flush();\n  createPostProcessingTrigger();\n\n  return { status: \u0027success\u0027, message: \u0027Employee setup information has been saved and is being sent to relevant departments.\u0027 };\n}\n\n/**\n * @description Handles the submission of the IT Setup form.\n * @howItWorks It adds an IT completion timestamp, sets the `Post-Processing Status` to \u0027Pending IT Emails\u0027, updates the spreadsheet, and creates a trigger. The trigger will run `processQueue` which in turn calls `checkForCompletion`.\n * @output {object} A success object with a confirmation message.\n */\nfunction handleItSubmission(formData) {\n  const sheet \u003d SpreadsheetApp.openById(SPREADSHEET_ID).getSheetByName(MASTER_SHEET_NAME);\n  const requestId \u003d formData[\u0027Request ID\u0027];\n\n  formData[\u0027IT - Completion Timestamp\u0027] \u003d new Date();\n  formData[\u0027Post-Processing Status\u0027] \u003d \u0027Pending IT Emails\u0027;\n  updateSheetData(sheet, requestId, formData);\n  SpreadsheetApp.flush();\n  \n  createPostProcessingTrigger();\n\n  return { status: \u0027success\u0027, message: \u0027IT setup has been submitted.\u0027 };\n}\n\n/**\n * @description Handles submissions from any of the parallel task forms (e.g., Fleetio, Credit Card).\n * @howItWorks It\u0027s a generic handler. It identifies which status column to update from the `statusColumn` property in the `formData`. It sets that column to \u0027Complete\u0027 and adds a corresponding timestamp. It also copies any other submitted data (like asset numbers) into an `updateData` object. Finally, it writes all these updates to the spreadsheet and calls `checkForCompletion` to see if the whole request can now move forward.\n * @output {object} A simple success object. The user sees a generic \u0027completed\u0027 page.\n */\nfunction handleParallelTaskSubmission(formData) {\n  Logger.log(\u0027handleParallelTaskSubmission received: \u0027 + JSON.stringify(formData));\n\n  const requestId \u003d formData.requestId;\n  const sheet \u003d SpreadsheetApp.openById(SPREADSHEET_ID).getSheetByName(MASTER_SHEET_NAME);\n  const updateData \u003d {};\n\n  // Generic logic for simple tasks.\n  const statusColumn \u003d formData.statusColumn;\n  if (statusColumn) {\n    Logger.log(`Found statusColumn: \"${statusColumn}\". Preparing to update status and timestamp.`);\n    updateData[statusColumn] \u003d formData.statusValue || \u0027Complete\u0027;\n    const timestampColumn \u003d statusColumn.replace(\u0027Status\u0027, \u0027Timestamp\u0027).trim();\n    updateData[timestampColumn] \u003d new Date();\n  } else {\n    Logger.log(\u0027WARNING: No \"statusColumn\" property was found in the submitted form data.\u0027);\n  }\n\n  // Specific logic for combined forms like JR/30-60-90.\n  if (formData[\u0027JR - Status\u0027]) {\n    updateData[\u0027JR - Status\u0027] \u003d formData[\u0027JR - Status\u0027];\n    updateData[\u0027JR - Timestamp\u0027] \u003d new Date();\n  }\n  if (formData[\u002730-60-90 - Status\u0027]) {\n     updateData[\u002730-60-90 - Status\u0027] \u003d formData[\u002730-60-90 - Status\u0027];\n     updateData[\u002730-60-90 - Timestamp\u0027] \u003d new Date();\n  }\n\n  // Copy any other data from the form (e.g., asset numbers, card limits) into the update object.\n  for (const key in formData) {\n    if (!updateData.hasOwnProperty(key) \u0026\u0026 key !\u003d\u003d \u0027requestId\u0027 \u0026\u0026 key !\u003d\u003d \u0027formType\u0027 \u0026\u0026 key !\u003d\u003d \u0027statusColumn\u0027 \u0026\u0026 key !\u003d\u003d \u0027statusValue\u0027) {\n      updateData[key] \u003d formData[key];\n    }\n  }\n\n  Logger.log(\u0027Data prepared for sheet update: \u0027 + JSON.stringify(updateData));\n\n  // Update the sheet if there\u0027s data to save.\n  if (Object.keys(updateData).length \u003e 0) {\n    updateSheetData(sheet, requestId, updateData);\n    SpreadsheetApp.flush();\n    checkForCompletion(requestId); // Check if this completion triggers the next workflow step.\n  } else {\n    Logger.log(\u0027No data to update. Skipping sheet update.\u0027);\n  }\n\n  return { status: \u0027success\u0027 };\n}\n\n/**\n * @description Creates a time-based trigger to run the `processQueue` function in 60 seconds.\n * @howItWorks It first deletes any existing triggers for `processQueue` to prevent multiple triggers from running simultaneously. Then, it creates a new trigger that will execute the `processQueue` function once, approximately 60 seconds from now. This decouples the time-consuming email sending process from the user\u0027s form submission, providing a faster UI response.\n * @output {void}\n */\nfunction createPostProcessingTrigger() {\n  const triggers \u003d ScriptApp.getProjectTriggers();\n  for (const trigger of triggers) {\n    // Clean up old or stuck triggers.\n    if (trigger.getHandlerFunction() \u003d\u003d\u003d \u0027processQueue\u0027 || trigger.getHandlerFunction() \u003d\u003d\u003d \u0027doGet\u0027) {\n      ScriptApp.deleteTrigger(trigger);\n    }\n  }\n  // Create a new trigger to run the queue processor after a delay.\n  ScriptApp.newTrigger(\u0027processQueue\u0027)\n      .timeBased()\n      .after(60 * 1000) // 1 minute\n      .create();\n}\n\n/**\n * @description Scans the spreadsheet for rows that require background processing (like sending emails) and handles them.\n * @howItWorks This function is executed by a time-based trigger. It reads the entire sheet, finds rows with a \u0027Post-Processing Status\u0027 that is not \u0027Complete\u0027 or \u0027Error\u0027. \n * - For \u0027Pending Requester Emails\u0027, it generates a PDF of the initial submission and emails it to HR (with a setup link) and to the requester/manager (as a confirmation).\n * - For \u0027Pending HR Emails\u0027, it generates an updated PDF and emails IT with a setup link. It also emails all the departments responsible for parallel tasks (Fleetio, etc.) if their task was requested. Finally, it sends an update to the requester/manager.\n * - For \u0027Pending IT Emails\u0027, it simply calls `checkForCompletion` to see if the workflow can advance.\n * After successfully processing a row, it updates the \u0027Post-Processing Status\u0027 to \u0027Complete\u0027. If it finds no rows to process, it deletes the trigger to stop itself from running again unnecessarily.\n * @output {void}\n */\nfunction processQueue() {\n  const sheet \u003d SpreadsheetApp.openById(SPREADSHEET_ID).getSheetByName(MASTER_SHEET_NAME);\n  const data \u003d sheet.getDataRange().getValues();\n  const headers \u003d data.shift();\n  \n  let processed \u003d false;\n\n  for (let i \u003d 0; i \u003c data.length; i++) {\n    const row \u003d data[i];\n    const rowObject \u003d {};\n    headers.forEach((header, index) \u003d\u003e rowObject[header] \u003d row[index]);\n\n    const status \u003d rowObject[\u0027Post-Processing Status\u0027];\n    const requestId \u003d rowObject[\u0027Request ID\u0027];\n\n    if (status \u0026\u0026 status !\u003d\u003d \u0027Complete\u0027 \u0026\u0026 !status.startsWith(\u0027Error\u0027)) {\n      try {\n        if (status \u003d\u003d\u003d \u0027Pending Requester Emails\u0027) {\n          // --- STAGE 1: After initial submission ---\n          const employeeName \u003d rowObject[\u0027First Name\u0027] + \u0027 \u0027 + rowObject[\u0027Last Name\u0027];\n          const siteName \u003d rowObject[\u0027Site Name\u0027];\n          const requesterEmail \u003d rowObject[\u0027Requester Email\u0027];\n          const managerEmail \u003d rowObject[\u0027Reporting Manager Email \u0027];\n          \n          const initialPdf \u003d generateRequesterPdf(rowObject);\n          const setupUrl \u003d ScriptApp.getService().getUrl() + `?view\u003dhr\u0026id\u003d${requestId}`;\n          const subject \u003d `ACTION REQUIRED: New Hire Setup for ${employeeName} at ${siteName}`;\n          const hrEmailBody \u003d `A new employee request for ${employeeName} has been submitted. Please review the attached PDF.\u003cbr/\u003e\u003cbr/\u003eThen complete the setup form using the link below:\u003cbr/\u003e\u003cbr/\u003e\u003ca href\u003d\"${setupUrl}\" style\u003d\"background-color: #007bff; color: white; padding: 10px 15px; text-decoration: none; border-radius: 5px;\"\u003eComplete Employee Setup Form\u003c/a\u003e`;\n          \n          // Send task email to HR.\n          MailApp.sendEmail({ to: HR_SETUP_EMAIL, subject: subject, htmlBody: hrEmailBody, attachments: [initialPdf] });\n\n          // Send confirmation email to Requester and Manager.\n          const recipients \u003d [requesterEmail];\n          if (managerEmail \u0026\u0026 managerEmail.includes(\u0027@\u0027)) {\n            recipients.push(managerEmail);\n          }\n          MailApp.sendEmail({ to: recipients.join(\u0027,\u0027), subject: `Confirmation: Your request for ${employeeName} at ${siteName}`, htmlBody: \"Thank you for your submission. A copy of your request is attached.\", attachments: [initialPdf] });\n\n          updateSheetData(sheet, requestId, { \u0027Post-Processing Status\u0027: \u0027Complete\u0027 });\n          processed \u003d true;\n\n        } else if (status \u003d\u003d\u003d \u0027Pending HR Emails\u0027) {\n            // --- STAGE 2: After HR completes their setup ---\n            const fullRequestData \u003d getRequestData(requestId);\n            const employeeName \u003d fullRequestData[\u0027First Name\u0027] + \u0027 \u0027 + fullRequestData[\u0027Last Name\u0027];\n            const siteName \u003d fullRequestData[\u0027Site Name\u0027];\n            const requesterEmail \u003d fullRequestData[\u0027Requester Email\u0027];\n            const managerEmail \u003d fullRequestData[\u0027Reporting Manager Email \u0027];\n            const pdfBlob \u003d generateFinalPdf(fullRequestData);\n            \n            // Send task email to IT.\n            if (IT_SETUP_EMAIL) {\n                const itSetupUrl \u003d ScriptApp.getService().getUrl() + `?view\u003dit\u0026id\u003d${requestId}`;\n                const subject \u003d `IT SETUP REQUIRED: New Hire - ${employeeName} at ${siteName}`;\n                const body \u003d `The initial Employee Setup for ${employeeName} is complete. Please see the attached summary and use the link below to complete the IT setup process.\u003cbr/\u003e\u003cbr/\u003e\u003ca href\u003d\"${itSetupUrl}\" style\u003d\"background-color: #007bff; color: white; padding: 10px 15px; text-decoration: none; border-radius: 5px;\"\u003eComplete IT Setup Form\u003c/a\u003e`;\n                MailApp.sendEmail({ to: IT_SETUP_EMAIL, subject: subject, htmlBody: body, attachments: [pdfBlob] });\n            }\n\n            // Send update notification to Requester and Manager.\n            const recipients \u003d [requesterEmail];\n            if (managerEmail \u0026\u0026 managerEmail.includes(\u0027@\u0027)) recipients.push(managerEmail);\n            if (recipients.length \u003e 0 \u0026\u0026 recipients[0]) {\n                const requesterSubject \u003d `Update: Employee Setup Complete for ${employeeName} at ${siteName}`;\n                const requesterBody \u003d `Hello,\u003cbr\u003e\u003cbr\u003eThis is to confirm that the initial setup for ${employeeName} has been completed and the request has been sent to IT for processing.\u003cbr/\u003e\u003cbr\u003eA copy of the request with the setup information is attached for your records.`;\n                MailApp.sendEmail({ to: recipients.join(\u0027,\u0027), subject: requesterSubject, htmlBody: requesterBody, attachments: [pdfBlob] });\n            }\n\n            // Send task emails for all required parallel tasks.\n            const parallelTasks \u003d getParallelTaskMap();\n            parallelTasks.forEach(task \u003d\u003e {\n                let isTaskRequired \u003d false;\n                // Check if the trigger is an array (like for JR/30-60-90).\n                if (Array.isArray(task.triggerQuestion)) {\n                    isTaskRequired \u003d task.triggerQuestion.some(q \u003d\u003e fullRequestData[q] \u003d\u003d\u003d \u0027Yes\u0027);\n                } else {\n                    // Original logic for single-trigger tasks.\n                    isTaskRequired \u003d (fullRequestData[task.triggerQuestion] \u003d\u003d\u003d \u0027Yes\u0027);\n                }\n                \n                // If the task is required, send the email.\n                if (isTaskRequired) {\n                    const taskUrl \u003d ScriptApp.getService().getUrl() + `?view\u003d${task.viewName}\u0026id\u003d${requestId}`;\n                    const subject \u003d `ACTION REQUIRED: ${task.formTitle} for ${employeeName} at ${siteName}`;\n                    const body \u003d `Please complete the ${task.formTitle} for the new hire, ${employeeName}, using the link below. A summary of the new hire request is attached for your reference.\u003cbr/\u003e\u003cbr/\u003e\u003ca href\u003d\"${taskUrl}\" style\u003d\"background-color: #007bff; color: white; padding: 10px 15px; text-decoration: none; border-radius: 5px;\"\u003eComplete ${task.formTitle}\u003c/a\u003e`;\n                    MailApp.sendEmail({ to: task.recipient, subject: subject, htmlBody: body, attachments: [pdfBlob] });\n                }\n            });\n\n            updateSheetData(sheet, requestId, { \u0027Post-Processing Status\u0027: \u0027Complete\u0027 });\n            processed \u003d true;\n\n        } else if (status \u003d\u003d\u003d \u0027Pending IT Emails\u0027) {\n            // --- STAGE 3: After IT completes their setup ---\n            checkForCompletion(requestId); // This function will determine the next step.\n            updateSheetData(sheet, requestId, { \u0027Post-Processing Status\u0027: \u0027Complete\u0027 });\n            processed \u003d true;\n        }\n\n      } catch(e) {\n        // If an error occurs, log it and mark the row with the error message.\n        Logger.log(`Error processing queue for Request ID ${requestId}: ${e.message}`);\n        updateSheetData(sheet, requestId, { \u0027Post-Processing Status\u0027: `Error: ${e.message}` });\n      }\n    }\n  }\n\n  // If no rows were processed in this run, disable the trigger.\n  if (!processed) {\n      const triggers \u003d ScriptApp.getProjectTriggers();\n      triggers.forEach(trigger \u003d\u003e {\n          if (trigger.getHandlerFunction() \u003d\u003d\u003d \u0027processQueue\u0027) {\n              ScriptApp.deleteTrigger(trigger);\n          }\n      });\n  }\n}\n\n/**\n * @description Checks if all required sequential and parallel tasks for a request are complete. If so, it advances the workflow.\n * @howItWorks It fetches the request data. First, it checks if the main IT setup is done. Then, it iterates through the `getParallelTaskMap()` configuration. For each task that was triggered (\u0027Yes\u0027), it checks if its corresponding status column is marked \u0027Complete\u0027. \n * If all required tasks are done:\n * - If the employee is \u0027Salary\u0027, it changes the status to \u0027Pending Final HR Approval\u0027 and sends a final review email to HR.\n * - If the employee is \u0027Hourly\u0027, it automatically marks the request as \u0027Completed\u0027, updates the sheet, and sends a final completion notification to stakeholders.\n * @output {void}\n */\nfunction checkForCompletion(requestId) {\n  const sheet \u003d SpreadsheetApp.openById(SPREADSHEET_ID).getSheetByName(MASTER_SHEET_NAME);\n  const data \u003d getRequestData(requestId);\n  \n  // Exit if data is not found or it\u0027s not in the correct workflow state.\n  if (!data || data[\u0027Workflow Status\u0027] !\u003d\u003d \u0027Pending IT Setup\u0027) {\n    return;\n  }\n  \n  // Exit if IT has not yet completed their part.\n  if (!data[\u0027IT - Completion Timestamp\u0027]) {\n    return;\n  }\n  \n  const parallelTasks \u003d getParallelTaskMap();\n  let allTasksComplete \u003d true;\n\n  // Check each parallel task to see if it\u0027s complete.\n  parallelTasks.forEach(task \u003d\u003e {\n    // Handle tasks triggered by one of several questions (e.g., JR or 30-60-90).\n    if (Array.isArray(task.triggerQuestion)) {\n      const oneOfIsRequired \u003d task.triggerQuestion.some(q \u003d\u003e data[q] \u003d\u003d\u003d \u0027Yes\u0027);\n      if (oneOfIsRequired) {\n        // Check if all status columns for this task group are \u0027Complete\u0027.\n        task.statusColumn.forEach(sc \u003d\u003e {\n          if (data[sc] !\u003d\u003d \u0027Complete\u0027) allTasksComplete \u003d false;\n        });\n      }\n    } else { // Handle tasks triggered by a single question.\n      if (data[task.triggerQuestion] \u003d\u003d\u003d \u0027Yes\u0027) {\n        if (data[task.statusColumn] !\u003d\u003d \u0027Complete\u0027) {\n          allTasksComplete \u003d false;\n        }\n      }\n    }\n  });\n\n  // If all required tasks are complete, move to the final stage.\n  if (allTasksComplete) {\n    const fullRequestData \u003d getRequestData(requestId);\n    const employeeName \u003d fullRequestData[\u0027First Name\u0027] + \u0027 \u0027 + fullRequestData[\u0027Last Name\u0027];\n    const siteName \u003d fullRequestData[\u0027Site Name\u0027];\n    \n    // Salaried employees require a manual final approval step.\n    if (fullRequestData[\u0027Hourly or Salary\u0027] \u003d\u003d\u003d \u0027Salary\u0027) {\n        updateSheetData(sheet, requestId, { \u0027Workflow Status\u0027: \u0027Pending Final HR Approval\u0027 });\n        SpreadsheetApp.flush();\n        const finalData \u003d getRequestData(requestId);\n        \n        const finalPdf \u003d generateFinalPdf(finalData);\n        const finalApprovalUrl \u003d ScriptApp.getService().getUrl() + `?action\u003dapprove\u0026id\u003d${requestId}`;\n        const finalDenyUrl \u003d ScriptApp.getService().getUrl() + `?action\u003ddeny\u0026id\u003d${requestId}`;\n        \n        const subject \u003d `FINAL REVIEW: All Setup Tasks Complete for ${employeeName} at ${siteName}`;\n        let body \u003d `All required setup tasks for the new hire, ${employeeName}, are now complete. Please review the final attached PDF and provide the final sign-off.\u003cbr/\u003e\u003cbr/\u003e`;\n        body +\u003d `\u003ca href\u003d\"${finalApprovalUrl}\" style\u003d\"background-color: #28a745; color: white; padding: 10px 15px; text-decoration: none; border-radius: 5px;\"\u003eFinal Approve\u003c/a\u003e`;\n        body +\u003d `\u0026nbsp;\u0026nbsp;\u003ca href\u003d\"${finalDenyUrl}\" style\u003d\"background-color: #dc3545; color: white; padding: 10px 15px; text-decoration: none; border-radius: 5px;\"\u003eDeny\u003c/a\u003e`;\n\n        MailApp.sendEmail({ \n          to: HR_APPROVAL_EMAIL, \n          subject: subject, \n          htmlBody: body,\n          attachments: [finalPdf] \n        });\n    } else { // Hourly employees are auto-approved at this stage.\n        const updateData \u003d { \n          \u0027Workflow Status\u0027: \u0027Completed\u0027, \n          \u0027Final Status\u0027: \u0027Completed\u0027, \n          \u0027Final Approver Name\u0027: \u0027System - Auto-approved (Hourly)\u0027, \n          \u0027Final Approval Timestamp\u0027: new Date()\n        };\n        updateSheetData(sheet, requestId, updateData);\n        SpreadsheetApp.flush();\n        \n        // Send final completion notifications.\n        const finalData \u003d getRequestData(requestId);\n        if (finalData) {\n            const subject \u003d `Request Completed: New Hire ${employeeName} at ${siteName}`;\n            const body \u003d `The new hire request for ${employeeName} has been fully processed and completed. The final record is attached.`;\n            const finalPdf \u003d generateFinalPdf(finalData);\n            \n            const requesterEmail \u003d finalData[\u0027Requester Email\u0027];\n            const managerEmail \u003d finalData[\u0027Reporting Manager Email \u0027];\n            const recipients \u003d [];\n            if (requesterEmail \u0026\u0026 requesterEmail.includes(\u0027@\u0027)) recipients.push(requesterEmail);\n            if (managerEmail \u0026\u0026 managerEmail.includes(\u0027@\u0027)) recipients.push(managerEmail);\n\n            if (recipients.length \u003e 0) {\n              MailApp.sendEmail({ to: recipients.join(\u0027,\u0027), subject: subject, htmlBody: body, attachments: [finalPdf] });\n            }\n            MailApp.sendEmail({ to: IT_SETUP_EMAIL, subject: subject, htmlBody: body, attachments: [finalPdf] });\n        }\n    }\n  }\n}\n\n/**\n * @description Processes the final approval submission from the HR approval form.\n * @howItWorks It takes the approval data (ID, signature, comments), updates the spreadsheet to set the `Workflow Status` and `Final Status` to \u0027Completed\u0027, and records the approver\u0027s details. It then generates the final, complete PDF record and emails it to the stakeholders (requester, manager, IT) as a final notification.\n * @output {object} A success object for the client.\n */\nfunction processFinalApproval(approvalData) {\n  const sheet \u003d SpreadsheetApp.openById(SPREADSHEET_ID).getSheetByName(MASTER_SHEET_NAME);\n  const id \u003d approvalData.approvalId;\n  const signature \u003d approvalData.managerSignature;\n  const comments \u003d approvalData.additionalComments;\n  \n  const updateData \u003d { \n    \u0027Workflow Status\u0027: \u0027Completed\u0027, \n    \u0027Final Status\u0027: \u0027Completed\u0027, \n    \u0027Final Approver Name\u0027: signature, \n    \u0027Final Approval Comments\u0027: comments,\n    \u0027Final Approval Timestamp\u0027: new Date()\n  };\n  updateSheetData(sheet, id, updateData);\n  SpreadsheetApp.flush();\n\n  // Send completion notifications.\n  const finalData \u003d getRequestData(id);\n  if (finalData) {\n    const employeeName \u003d finalData[\u0027First Name\u0027] + \u0027 \u0027 + finalData[\u0027Last Name\u0027];\n    const siteName \u003d finalData[\u0027Site Name\u0027];\n    const subject \u003d `Request Completed: New Hire ${employeeName} at ${siteName}`;\n    const body \u003d `The new hire request for ${employeeName} has been fully processed and approved. The final record, including approval details, is attached.`;\n    const finalPdf \u003d generateFinalPdf(finalData);\n    \n    const requesterEmail \u003d finalData[\u0027Requester Email\u0027];\n    const managerEmail \u003d finalData[\u0027Reporting Manager Email \u0027];\n    const recipients \u003d [];\n    if (requesterEmail \u0026\u0026 requesterEmail.includes(\u0027@\u0027)) recipients.push(requesterEmail);\n    if (managerEmail \u0026\u0026 managerEmail.includes(\u0027@\u0027)) recipients.push(managerEmail);\n\n    if (recipients.length \u003e 0) {\n      MailApp.sendEmail({ to: recipients.join(\u0027,\u0027), subject: subject, htmlBody: body, attachments: [finalPdf] });\n    }\n    \n    MailApp.sendEmail({ to: IT_SETUP_EMAIL, subject: subject, htmlBody: body, attachments: [finalPdf] });\n  }\n\n  return { status: \u0027success\u0027 };\n}\n\n/**\n * @description Processes the final denial submission from the HR denial form.\n * @howItWorks Similar to `processFinalApproval`, but it sets the `Workflow Status` to \u0027Denied at Final Review\u0027 and the `Final Status` to \u0027Denied\u0027. It records the denial reason and sends a notification email with the final PDF to stakeholders, informing them of the denial.\n * @output {object} A success object for the client.\n */\nfunction processFinalDenial(denialData) {\n  const sheet \u003d SpreadsheetApp.openById(SPREADSHEET_ID).getSheetByName(MASTER_SHEET_NAME);\n  const id \u003d denialData.approvalId;\n  const signature \u003d denialData.managerSignature;\n  const reason \u003d denialData.denialReason;\n  \n  const updateData \u003d { \n    \u0027Workflow Status\u0027: \u0027Denied at Final Review\u0027, \n    \u0027Final Status\u0027: \u0027Denied\u0027, \n    \u0027Final Approver Name\u0027: signature, \n    \u0027Final Denial Reason\u0027: reason,\n    \u0027Final Approval Timestamp\u0027: new Date() \n  };\n  updateSheetData(sheet, id, updateData);\n  SpreadsheetApp.flush();\n\n  // Send denial notifications.\n  const finalData \u003d getRequestData(id);\n  if (finalData) {\n    const employeeName \u003d finalData[\u0027First Name\u0027] + \u0027 \u0027 + finalData[\u0027Last Name\u0027];\n    const siteName \u003d finalData[\u0027Site Name\u0027];\n    const subject \u003d `Request Denied: New Hire ${employeeName} at ${siteName}`;\n    const body \u003d `The new hire request for ${employeeName} was denied during the final review. The final record, including denial details, is attached.`;\n    const finalPdf \u003d generateFinalPdf(finalData);\n\n    const requesterEmail \u003d finalData[\u0027Requester Email\u0027];\n    const managerEmail \u003d finalData[\u0027Reporting Manager Email \u0027];\n    const recipients \u003d [];\n    if (requesterEmail \u0026\u0026 requesterEmail.includes(\u0027@\u0027)) recipients.push(requesterEmail);\n    if (managerEmail \u0026\u0026 managerEmail.includes(\u0027@\u0027)) recipients.push(managerEmail);\n\n    if (recipients.length \u003e 0) {\n      MailApp.sendEmail({ to: recipients.join(\u0027,\u0027), subject: subject, htmlBody: body, attachments: [finalPdf] });\n    }\n\n    MailApp.sendEmail({ to: IT_SETUP_EMAIL, subject: subject, htmlBody: body, attachments: [finalPdf] });\n  }\n\n  return { status: \u0027success\u0027 };\n}\n\n/**\n * @description Processes a \"Send Back\" action from HR, returning the request to the original requester for edits.\n * @howItWorks It updates the `Workflow Status` to \u0027Sent Back to Requester\u0027 and records the reason for the send-back in the \u0027Approval Notes\u0027 column. It then sends an email to the original requester and their manager containing a special link. This link will open the original form, pre-filled with their previous submission, allowing them to make corrections and resubmit.\n * @output {object} A success object for the client.\n */\nfunction processSendBack(feedbackData) {\n  const sheet \u003d SpreadsheetApp.openById(SPREADSHEET_ID).getSheetByName(MASTER_SHEET_NAME);\n  const id \u003d feedbackData.requestId;\n  const reason \u003d feedbackData.reason;\n  const updateData \u003d { \u0027Workflow Status\u0027: \u0027Sent Back to Requester\u0027, \u0027Final Status\u0027: \u0027Pending\u0027, \u0027Approval Notes\u0027: reason };\n  updateSheetData(sheet, id, updateData);\n  \n  SpreadsheetApp.flush();\n  Utilities.sleep(3000); // Wait for the spreadsheet update to propagate.\n\n  const requestData \u003d getRequestData(id);\n  if (!requestData) {\n      throw new Error(\"Failed to retrieve request data after update. Cannot send notification email.\");\n  }\n  \n  const requesterEmail \u003d requestData[\u0027Requester Email\u0027];\n  const managerEmail \u003d requestData[\u0027Reporting Manager Email \u0027];\n  const recipients \u003d [];\n  if (requesterEmail \u0026\u0026 requesterEmail.includes(\u0027@\u0027)) recipients.push(requesterEmail);\n  if (managerEmail \u0026\u0026 managerEmail.includes(\u0027@\u0027)) recipients.push(managerEmail);\n\n  if (recipients.length \u003e 0) {\n      const editUrl \u003d ScriptApp.getService().getUrl() + `?id\u003d${id}`;\n      const subject \u003d `ACTION REQUIRED: Your Employee Request for ${requestData[\u0027First Name\u0027]} ${requestData[\u0027Last Name\u0027]} needs revision`;\n      let emailBody \u003d `Your employee request for ${requestData[\u0027First Name\u0027]} ${requestData[\u0027Last Name\u0027]} has been sent back for edits.\u003cbr/\u003e\u003cbr/\u003e\u003cstrong\u003eReason:\u003c/strong\u003e\u003cbr/\u003e\u003cem\u003e${reason}\u003c/em\u003e\u003cbr/\u003e\u003cbr/\u003ePlease click the link below to open the form, make the necessary changes, and resubmit.\u003cbr/\u003e\u003cbr/\u003e\u003ca href\u003d\"${editUrl}\" style\u003d\"background-color: #007bff; color: white; padding: 10px 15px; text-decoration: none; border-radius: 5px;\"\u003eEdit and Resubmit Request\u003c/a\u003e`;\n      MailApp.sendEmail({ to: recipients.join(\u0027,\u0027), subject: subject, htmlBody: emailBody });\n  }\n\n  return {status: \u0027success\u0027};\n}\n\n// --- DATA \u0026 HELPER FUNCTIONS ---\n\n/**\n * @description Provides a configuration map for all parallel departmental tasks.\n * @howItWorks This function returns an array of objects. Each object defines a parallel task with properties like:\n * - `triggerQuestion`: The exact question title from the form that triggers this task (if the answer is \u0027Yes\u0027). Can be an array for multiple triggers.\n * - `viewName`: The value used in the URL\u0027s `view` parameter to open this task\u0027s form.\n * - `recipient`: The email address to send the task notification to.\n * - `formTitle`: The title displayed on the task\u0027s web form.\n * - `statusColumn`: The name of the column in the spreadsheet used to track this task\u0027s status. Can be an array.\n * - `formFile`: (Optional) The specific HTML file to use for this task\u0027s form.\n * @output {Array\u003cobject\u003e} An array of configuration objects for parallel tasks.\n */\nfunction getParallelTaskMap() {\n  return [\n    { triggerQuestion: \u0027Fleetio / Vehicle\u0027, viewName: \u0027fleetio\u0027, recipient: FLEETIO_EMAIL, formTitle: \u0027Fleetio Setup\u0027, statusColumn: \u0027Fleetio - Status\u0027, formFile: \u0027FleetioForm.html\u0027 },\n    { triggerQuestion: \u0027Credit Card\u0027, viewName: \u0027creditcard\u0027, recipient: CREDIT_CARD_EMAIL, formTitle: \u0027Credit Card Request\u0027, statusColumn: \u0027Credit Card - Status\u0027, formFile: \u0027CreditCardForm.html\u0027 },\n    { triggerQuestion: [\u0027JR\u0027, \u002730-60-90\u0027], viewName: \u0027jr306090\u0027, recipient: JR_306090_EMAIL, formTitle: \u0027JR / 30-60-90 Plan\u0027, statusColumn: [\u0027JR - Status\u0027, \u002730-60-90 - Status\u0027], formFile: \u0027JR306090Form.html\u0027 },\n    { triggerQuestion: \u0027ADP Supervisor Access\u0027, viewName: \u0027adpsupervisor\u0027, recipient: ADP_SUPERVISOR_ACCESS_EMAIL, formTitle: \u0027ADP Supervisor Access\u0027, statusColumn: \u0027ADP Supervisor Access - Status\u0027 },\n    { triggerQuestion: \u0027ADP Manager Access\u0027, viewName: \u0027adpaccess\u0027, recipient: ADP_MANAGER_ACCESS_EMAIL, formTitle: \u0027ADP Manager Access\u0027, statusColumn: \u0027ADP Manager Access - Status\u0027 },\n    { triggerQuestion: \u0027JONAS\u0027, viewName: \u0027jonas\u0027, recipient: JONAS_EMAIL, formTitle: \u0027JONAS Setup\u0027, statusColumn: \u0027JONAS - Status\u0027 },\n    { triggerQuestion: \u0027SiteDocs\u0027, viewName: \u0027sitedocs\u0027, recipient: SITEDOCS_EMAIL, formTitle: \u0027SiteDocs Setup\u0027, statusColumn: \u0027SiteDocs - Status\u0027}\n  ];\n}\n\n/**\n * @description Prepares a data object to be sent to the client-side JavaScript.\n * @howItWorks It iterates through the properties of a server-side data object. If a property is a JavaScript `Date` object, it converts it into a formatted string (\u0027yyyy-MM-dd HH:mm:ss\u0027). This is necessary because `Date` objects cannot be directly JSON-serialized and sent to the client. Other data types are passed through unchanged.\n * @output {object} A new object with all Date values converted to strings. Returns null if the input is null.\n */\nfunction sanitizeDataForClient(dataObject) {\n    if (!dataObject) return null;\n    const sanitized \u003d {};\n    for (const key in dataObject) {\n        if (dataObject[key] instanceof Date) {\n            sanitized[key] \u003d Utilities.formatDate(dataObject[key], Session.getScriptTimeZone(), \"yyyy-MM-dd HH:mm:ss\");\n        } else {\n            sanitized[key] \u003d dataObject[key];\n        }\n    }\n    return sanitized;\n}\n\n/**\n * @description Fetches an image from a given URL and encodes it as a Base64 string.\n * @howItWorks It uses `UrlFetchApp` to retrieve the image file. It then gets the raw bytes of the image and uses `Utilities.base64Encode` to convert them into a Base64 string. This string can be embedded directly into an HTML `\u003cimg\u003e` tag\u0027s `src` attribute, which is useful for including images in PDFs without relying on external links.\n * @output {string} A data URI string (e.g., \u0027data:image/jpeg;base64,...\u0027) or an empty string on failure.\n */\nfunction getImageAsBase64(url) {\n  try {\n    const response \u003d UrlFetchApp.fetch(url);\n    const blob \u003d response.getBlob();\n    const contentType \u003d blob.getContentType();\n    const base64 \u003d Utilities.base64Encode(blob.getBytes());\n    return `data:${contentType};base64,${base64}`;\n  } catch (e) {\n    Logger.log(`Failed to fetch or encode image from URL: ${url}. Error: ${e.message}`);\n    return \u0027\u0027;\n  }\n}\n\n/**\n * @description Retrieves data from the Job Codes spreadsheet.\n * @howItWorks It opens the spreadsheet specified by `JOB_CODES_SHEET_ID`, gets all the values, and removes the header row (`data.shift()`).\n * @output {Array\u003cArray\u003cstring\u003e\u003e} A 2D array of the job code data, or an empty array on error.\n */\nfunction getJobCodeData() {\n  try {\n    const sheet \u003d SpreadsheetApp.openById(JOB_CODES_SHEET_ID).getSheets()[0];\n    const data \u003d sheet.getDataRange().getValues();\n    data.shift(); // Remove header row\n    return data;\n  } catch (e) {\n    Logger.log(`Error fetching Job Code Data: ${e.message}`);\n    return [];\n  }\n}\n\n/**\n * @description Reads the structure of the primary Google Form.\n * @howItWorks It uses the `FormApp` service to open the form by its ID. It then iterates through all the items (questions, page breaks, etc.) on the form and extracts key information for each one: its ID, title, type, help text, and choices (for multiple choice, dropdowns, etc.). This allows the web app to build a dynamic HTML form that mirrors the Google Form without hardcoding the questions.\n * @output {Array\u003cobject\u003e} An array of objects, where each object represents an item on the Google Form.\n */\nfunction getFormStructure() {\n  const form \u003d FormApp.openById(FORM_ID);\n  return form.getItems().map(item \u003d\u003e ({ id: item.getId(), title: item.getTitle(), type: item.getType().toString(), helpText: item.getHelpText(), choices: (item.getType() \u003d\u003d\u003d FormApp.ItemType.MULTIPLE_CHOICE || item.getType() \u003d\u003d\u003d FormApp.ItemType.LIST || item.getType() \u003d\u003d\u003d FormApp.ItemType.CHECKBOX) ? getChoices(item) : [] }));\n}\n\n/**\n * @description A helper function for `getFormStructure` to extract choices from list-based items.\n * @howItWorks It uses a switch statement based on the item type to call the correct method (`asMultipleChoiceItem`, `asListItem`, etc.) and then maps the choice objects to an array of their string values.\n * @output {Array\u003cstring\u003e} An array of choice strings for the given form item.\n */\nfunction getChoices(item) {\n    switch(item.getType()) {\n        case FormApp.ItemType.MULTIPLE_CHOICE:\n            return item.asMultipleChoiceItem().getChoices().map(c \u003d\u003e c.getValue());\n        case FormApp.ItemType.LIST:\n            return item.asListItem().getChoices().map(c \u003d\u003e c.getValue());\n        case FormApp.ItemType.CHECKBOX:\n            return item.asCheckboxItem().getChoices().map(c \u003d\u003e c.getValue());\n        default:\n            return [];\n    }\n}\n\n/**\n * @description Retrieves all data for a single request from the master spreadsheet, identified by its unique Request ID.\n * @howItWorks It reads the entire data range of the master sheet. It finds the column index for \u0027Request ID\u0027. Then, it searches row by row for a matching ID. To handle potential delays in data writing to the sheet (eventual consistency), it includes a retry mechanism. If it doesn\u0027t find the ID on the first try, it waits 2 seconds and tries again, up to 3 times. Once found, it converts the row array into a more useful key-value pair object using the header row.\n * @output {object} An object where keys are the spreadsheet column headers and values are the data for the found row. Returns null if the ID is not found after all attempts.\n */\nfunction getRequestData(requestId) {\n  if (!requestId) return null;\n\n  const sheet \u003d SpreadsheetApp.openById(SPREADSHEET_ID).getSheetByName(MASTER_SHEET_NAME);\n  if (!sheet || sheet.getLastRow() \u003c 1) return null;\n\n  const maxAttempts \u003d 3;\n  for (let attempt \u003d 1; attempt \u003c\u003d maxAttempts; attempt++) {\n    const allData \u003d sheet.getDataRange().getValues();\n    const headers \u003d allData[0];\n    const idColumnIndex \u003d headers.indexOf(\u0027Request ID\u0027);\n\n    if (idColumnIndex \u003d\u003d\u003d -1) {\n      Logger.log(\"Critical Error: \u0027Request ID\u0027 column not found in spreadsheet.\");\n      return null;\n    }\n\n    // Find the row where the Request ID matches.\n    const foundRow \u003d allData.slice(1).find(row \u003d\u003e {\n      const idFromSheet \u003d row[idColumnIndex];\n      return idFromSheet \u0026\u0026 idFromSheet.toString().trim() \u003d\u003d\u003d requestId.toString().trim();\n    });\n\n    if (foundRow) {\n      Logger.log(`Successfully found Request ID ${requestId} on attempt #${attempt}.`);\n      // Convert the array row into an object.\n      const requestObject \u003d {};\n      headers.forEach((header, index) \u003d\u003e {\n        requestObject[header] \u003d foundRow[index];\n      });\n      return requestObject;\n    }\n\n    // If not found, wait and retry.\n    if (attempt \u003c maxAttempts) {\n      Logger.log(`Attempt #${attempt} failed to find ID ${requestId}. Waiting 2 seconds...`);\n      Utilities.sleep(2000);\n    }\n  }\n\n  Logger.log(`Final Attempt: Could not find Request ID ${requestId} after ${maxAttempts} attempts.`);\n  return null;\n}\n\n/**\n * @description Appends a new row of data to the spreadsheet.\n * @howItWorks It first gets the header row from the sheet. It then creates a new array (`newRow`) in the same order as the headers, pulling values from the input `data` object. If a header doesn\u0027t exist as a key in the `data` object, it inserts an empty string. Finally, it uses `sheet.appendRow()` to add the new data to the bottom of the sheet.\n * @output {void}\n */\nfunction appendDataToSheet(sheet, data) {\n  const headers \u003d sheet.getRange(1, 1, 1, sheet.getLastColumn()).getValues()[0];\n  const newRow \u003d headers.map(header \u003d\u003e data[header] || \u0027\u0027);\n  sheet.appendRow(newRow);\n}\n\n/**\n * @description Finds a specific row by its Request ID and updates its data.\n * @howItWorks It reads all data from the sheet and finds the row number corresponding to the given `id`. Once the row is found, it iterates through the keys in the `newData` object. For each key that matches a column header, it updates the value in that specific cell (`sheet.getRange(row, column).setValue(...)`). This is more efficient than rewriting the entire row.\n * @output {void}\n */\nfunction updateSheetData(sheet, id, newData) {\n  if (!sheet || sheet.getLastRow() \u003c 1) return;\n  const headers \u003d sheet.getRange(1, 1, 1, sheet.getLastColumn()).getValues()[0];\n  const data \u003d sheet.getDataRange().getValues();\n  const idColumnIndex \u003d headers.indexOf(\u0027Request ID\u0027);\n  for (let i \u003d 1; i \u003c data.length; i++) {\n    const idFromSheet \u003d data[i][idColumnIndex];\n    if (idFromSheet \u0026\u0026 idFromSheet.toString().trim() \u003d\u003d\u003d id.toString().trim()) {\n      const rowToUpdate \u003d i + 1; // +1 because sheet rows are 1-indexed\n      headers.forEach((colName, colIndex) \u003d\u003e {\n        if (newData.hasOwnProperty(colName)) {\n          sheet.getRange(rowToUpdate, colIndex + 1).setValue(newData[colName]);\n        }\n      });\n      break; // Stop searching once the row is found and updated\n    }\n  }\n}\n\n/**\n * @description Generates a PDF summary of the initial requester\u0027s submission.\n * @howItWorks It builds an HTML string containing a table. It iterates through the questions from the form structure and finds the corresponding answers in the `data` object, creating a table row for each question/answer pair. It embeds the company logo (as a Base64 string) and applies basic styling. Finally, it uses `Utilities.newBlob()` to convert the HTML string into a PDF file blob.\n * @output {Blob} A PDF file as a Google Apps Script Blob object, ready to be attached to an email.\n */\nfunction generateRequesterPdf(data) {\n  const employeeName \u003d data[\u0027First Name\u0027] + \u0027 \u0027 + data[\u0027Last Name\u0027];\n  const timestamp \u003d Utilities.formatDate(new Date(), Session.getScriptTimeZone(), \u0027yyyy-MM-dd_HH-mm-ss\u0027);\n  const fileName \u003d `Employee Request - ${employeeName} - ${timestamp}.pdf`;\n  let tableRows \u003d \u0027\u0027;\n  const structure \u003d getFormStructure();\n  structure.forEach(item \u003d\u003e {\n    const question \u003d item.title;\n    let value \u003d data[question];\n    if (value instanceof Date) {\n        value \u003d Utilities.formatDate(value, Session.getScriptTimeZone(), \"yyyy-MM-dd HH:mm:ss\");\n    }\n    if (value \u0026\u0026 value !\u003d\u003d \u0027\u0027 \u0026\u0026 item.type !\u003d\u003d \u0027PAGE_BREAK\u0027) {\n      tableRows +\u003d `\u003ctr\u003e\u003ctd class\u003d\"question-cell\"\u003e${question}\u003c/td\u003e\u003ctd class\u003d\"answer-cell\"\u003e${value}\u003c/td\u003e\u003c/tr\u003e`;\n    }\n  });\n\n  const submissionTimestamp \u003d data[\u0027Submission Timestamp\u0027] instanceof Date ? Utilities.formatDate(data[\u0027Submission Timestamp\u0027], Session.getScriptTimeZone(), \"yyyy-MM-dd HH:mm:ss\") : data[\u0027Submission Timestamp\u0027];\n  if (submissionTimestamp) {\n      tableRows +\u003d `\u003ctr class\u003d\"timestamp-row\" style\u003d\"background-color:#f2f2f2; font-style: italic; color: #555;\"\u003e\u003ctd colspan\u003d\"2\"\u003e\u003cstrong\u003eSubmitted on:\u003c/strong\u003e ${submissionTimestamp}\u003c/td\u003e\u003c/tr\u003e`;\n  }\n  \n  const logoBase64 \u003d getImageAsBase64(LOGO_URL);\n  let htmlBody \u003d `\u003chtml\u003e\u003chead\u003e\u003cstyle\u003ebody { font-family: Arial, sans-serif; text-align: center; } h1, h2 { color: #EB1C2E; } table { width: 100%; border-collapse: collapse; margin-bottom: 20px; text-align: left; } td { border: 1px solid #ccc; padding: 8px; } .question-cell { font-weight: bold; width: 35%; }\u003c/style\u003e\u003c/head\u003e\u003cbody\u003e\n    \u003cimg src\u003d\"${logoBase64}\" alt\u003d\"Company Logo\" style\u003d\"max-height: 70px; margin-bottom: 20px;\"\u003e\n    \u003ch1\u003eNew Employee Request: ${employeeName}\u003c/h1\u003e\u003ch2\u003eEmployee Request Information\u003c/h2\u003e\u003ctable\u003e${tableRows}\u003c/table\u003e\u003c/body\u003e\u003c/html\u003e`;\n  return Utilities.newBlob(htmlBody, \u0027text/html\u0027, fileName).getAs(\u0027application/pdf\u0027);\n}\n\n/**\n * @description Generates a comprehensive PDF summary of the entire request, including data from all stages (Requester, HR, IT, Parallel Tasks, Final Approval).\n * @howItWorks It builds a more complex HTML string with multiple sections and tables. It organizes the data by workflow stage (Request, HR Setup, IT Setup, etc.). It has specific logic to find and display details for certain parallel tasks (like Fleetio asset numbers or credit card details). It also includes a final approval/denial section if the request is complete. This complete HTML document is then converted into a PDF blob.\n * @output {Blob} A PDF file as a Google Apps Script Blob object.\n */\nfunction generateFinalPdf(data) {\n  const employeeName \u003d data[\u0027First Name\u0027] + \u0027 \u0027 + data[\u0027Last Name\u0027];\n  const timestamp \u003d Utilities.formatDate(new Date(), Session.getScriptTimeZone(), \u0027yyyy-MM-dd_HH-mm-ss\u0027);\n  const fileName \u003d `Employee Request Final - ${employeeName} - ${timestamp}.pdf`;\n  let requesterRows \u003d \u0027\u0027, hrRows \u003d \u0027\u0027, itRows \u003d \u0027\u0027, finalApprovalRows \u003d \u0027\u0027, parallelTaskRows \u003d \u0027\u0027;\n  \n  const allQuestions \u003d getFormStructure().map(item \u003d\u003e item.title);\n  \n  // --- Requester Info Section ---\n  const requesterQuestions \u003d allQuestions.filter(q \u003d\u003e data[q] \u0026\u0026 !q.startsWith(\u0027HR - \u0027) \u0026\u0026 !q.startsWith(\u0027IT - \u0027));\n  requesterQuestions.forEach(q \u003d\u003e {\n      let value \u003d data[q];\n      if (value instanceof Date) { value \u003d Utilities.formatDate(value, Session.getScriptTimeZone(), \"yyyy-MM-dd HH:mm:ss\"); }\n      requesterRows +\u003d `\u003ctr\u003e\u003ctd class\u003d\"question-cell\"\u003e${q}\u003c/td\u003e\u003ctd class\u003d\"answer-cell\"\u003e${value}\u003c/td\u003e\u003c/tr\u003e`;\n  });\n  \n  // --- HR Info Section ---\n  const hrFields \u003d [\n      \u0027Temporary ID\u0027, \u0027HR - SiteDocs Worker ID\u0027, \u0027HR - DSS Username\u0027, \u0027HR - DSS Password\u0027,\n      \u0027HR - Employee assigned to WIS module?\u0027, \u0027HR - Additional Comments\u0027, \u0027HR - Team Member Name\u0027, \n      \u0027HR - Date of Submission\u0027, \u0027HR - SiteDocs Training Username\u0027, \u0027HR - SiteDocs Training Password\u0027\n  ];\n  hrFields.forEach(field \u003d\u003e { \n      let value \u003d data[field];\n      if (value instanceof Date) { value \u003d Utilities.formatDate(value, Session.getScriptTimeZone(), \"yyyy-MM-dd HH:mm:ss\"); }\n      if (value \u0026\u0026 value !\u003d\u003d \u0027\u0027) { hrRows +\u003d `\u003ctr\u003e\u003ctd class\u003d\"question-cell\"\u003e${field.replace(\u0027HR - \u0027, \u0027\u0027)}\u003c/td\u003e\u003ctd class\u003d\"answer-cell\"\u003e${value}\u003c/td\u003e\u003c/tr\u003e`; }\n  });\n\n  // --- IT Info Section ---\n  const itFields \u003d [\n    \u0027IT - BOSS User Account\u0027, \u0027IT - Cost Sheet\u0027, \u0027IT - Leader Access\u0027, \u0027IT - Trip Reports Access\u0027,\n    \u0027IT - Incidents\u0027, \u0027IT - CAA\u0027, \u0027IT - Transform\u0027, \u0027IT - Net Promoter Score\u0027, \u0027IT - Delivery App\u0027, \u0027IT - E-Business Card\u0027,\n    \u0027IT - Google Account Email\u0027, \u0027IT - Google Account Password\u0027, \u0027IT - Phone Number\u0027, \u0027IT - Phone Voicemail Password\u0027,\n    \u0027IT - Computer Model\u0027, \u0027IT - Computer Serial Number\u0027\n  ];\n  itFields.forEach(field \u003d\u003e {\n    let value \u003d data[field];\n    if (value \u0026\u0026 value !\u003d\u003d \u0027\u0027) { itRows +\u003d `\u003ctr\u003e\u003ctd class\u003d\"question-cell\"\u003e${field.replace(\u0027IT - \u0027, \u0027\u0027)}\u003c/td\u003e\u003ctd class\u003d\"answer-cell\"\u003e${value}\u003c/td\u003e\u003c/tr\u003e`; }\n  });\n  \n  // --- Parallel Tasks Section ---\n  const parallelTaskMap \u003d getParallelTaskMap();\n  parallelTaskMap.forEach(task \u003d\u003e {\n    const statusColumns \u003d Array.isArray(task.statusColumn) ? task.statusColumn : [task.statusColumn];\n    statusColumns.forEach(sc \u003d\u003e {\n      const taskName \u003d sc.replace(\u0027 - Status\u0027, \u0027\u0027);\n      const status \u003d data[sc];\n      if(status) {\n          parallelTaskRows +\u003d `\u003ctr\u003e\u003ctd class\u003d\"question-cell\"\u003e${taskName}\u003c/td\u003e\u003ctd class\u003d\"answer-cell\"\u003e${status}\u003c/td\u003e\u003c/tr\u003e`;\n          \n          // Add specific sub-details for certain tasks.\n          if (taskName \u003d\u003d\u003d \u0027Fleetio\u0027) {\n            const fleetioDetails \u003d [\u0027Fleetio - Asset Number\u0027, \u0027Fleetio - Vehicle Make\u0027, \u0027Fleetio - Vehicle Model\u0027, \u0027Fleetio - License Plate\u0027];\n            fleetioDetails.forEach(detail \u003d\u003e {\n              if(data[detail]) {\n                parallelTaskRows +\u003d `\u003ctr\u003e\u003ctd class\u003d\"question-cell\" style\u003d\"padding-left: 30px;\"\u003e${detail.replace(\u0027Fleetio - \u0027, \u0027\u0027)}\u003c/td\u003e\u003ctd class\u003d\"answer-cell\"\u003e${data[detail]}\u003c/td\u003e\u003c/tr\u003e`;\n              }\n            });\n          }\n\n          if (taskName \u003d\u003d\u003d \u0027Credit Card\u0027) {\n            const cardDetails \u003d [\u0027Credit Card - Limit\u0027, \u0027Credit Card - Currency\u0027, \u0027Credit Card - Per\u0027, \u0027Credit Card - Spend Dynamics Username\u0027, \u0027Credit Card - Spend Dynamics Password\u0027, \u0027Amazon - Username / Number\u0027, \u0027Amazon - Password / PIN\u0027, \u0027Staples - Username / Number\u0027, \u0027Staples - Password / PIN\u0027, \u0027HomeDepot - Card Number\u0027, \u0027HomeDepot - PIN\u0027];\n            cardDetails.forEach(detail \u003d\u003e {\n              if(data[detail]) {\n                parallelTaskRows +\u003d `\u003ctr\u003e\u003ctd class\u003d\"question-cell\" style\u003d\"padding-left: 30px;\"\u003e${detail.replace(\u0027Credit Card - \u0027, \u0027\u0027).replace(\u0027Amazon - \u0027, \u0027Amazon: \u0027).replace(\u0027Staples - \u0027, \u0027Staples: \u0027).replace(\u0027HomeDepot - \u0027, \u0027HomeDepot: \u0027)}\u003c/td\u003e\u003ctd class\u003d\"answer-cell\"\u003e${data[detail]}\u003c/td\u003e\u003c/tr\u003e`;\n              }\n            });\n          }\n\n          // Add completion timestamp for the task.\n          const taskTimestamp \u003d data[`${taskName} - Timestamp`];\n          if (taskTimestamp) {\n            const formattedTimestamp \u003d (taskTimestamp instanceof Date) ? Utilities.formatDate(taskTimestamp, Session.getScriptTimeZone(), \"yyyy-MM-dd HH:mm:ss\") : taskTimestamp;\n            parallelTaskRows +\u003d `\u003ctr class\u003d\"timestamp-row\" style\u003d\"background-color:#f9f9f9;\"\u003e\u003ctd colspan\u003d\"2\"\u003e\u003cstrong\u003eCompleted on:\u003c/strong\u003e ${formattedTimestamp}\u003c/td\u003e\u003c/tr\u003e`;\n          }\n      }\n    });\n  });\n\n  // --- Final Approval Section ---\n  if (data[\u0027Final Status\u0027] \u003d\u003d\u003d \u0027Completed\u0027 || data[\u0027Final Status\u0027] \u003d\u003d\u003d \u0027Denied\u0027) {\n    const statusLabel \u003d data[\u0027Final Status\u0027] \u003d\u003d\u003d \u0027Completed\u0027 ? \u0027Approval\u0027 : \u0027Denial\u0027;\n    finalApprovalRows +\u003d `\u003ctr\u003e\u003ctd class\u003d\"question-cell\"\u003eApprover Name\u003c/td\u003e\u003ctd class\u003d\"answer-cell\"\u003e${data[\u0027Final Approver Name\u0027] || \u0027\u0027}\u003c/td\u003e\u003c/tr\u003e`;\n    if(data[\u0027Final Approval Comments\u0027]) {\n      finalApprovalRows +\u003d `\u003ctr\u003e\u003ctd class\u003d\"question-cell\"\u003eComments\u003c/td\u003e\u003ctd class\u003d\"answer-cell\"\u003e${data[\u0027Final Approval Comments\u0027]}\u003c/td\u003e\u003c/tr\u003e`;\n    }\n    if(data[\u0027Final Denial Reason\u0027]) {\n       finalApprovalRows +\u003d `\u003ctr\u003e\u003ctd class\u003d\"question-cell\"\u003eDenial Reason\u003c/td\u003e\u003ctd class\u003d\"answer-cell\"\u003e${data[\u0027Final Denial Reason\u0027]}\u003c/td\u003e\u003c/tr\u003e`;\n    }\n    const finalTimestamp \u003d data[\u0027Final Approval Timestamp\u0027];\n    if (finalTimestamp) {\n        const formattedTimestamp \u003d (finalTimestamp instanceof Date) ? Utilities.formatDate(finalTimestamp, Session.getScriptTimeZone(), \"yyyy-MM-dd HH:mm:ss\") : finalTimestamp;\n        finalApprovalRows +\u003d `\u003ctr class\u003d\"timestamp-row\"\u003e\u003ctd colspan\u003d\"2\"\u003e\u003cstrong\u003e${statusLabel} on:\u003c/strong\u003e ${formattedTimestamp}\u003c/td\u003e\u003c/tr\u003e`;\n    }\n  }\n\n  // --- Assemble the final HTML body ---\n  let htmlBody \u003d `\u003chtml\u003e\u003chead\u003e\u003cstyle\u003ebody { font-family: Arial, sans-serif; text-align: center;} h1, h2 { color: #EB1C2E; } table { width: 100%; border-collapse: collapse; margin-bottom: 20px; text-align: left;} td { border: 1px solid #ccc; padding: 8px; } .question-cell { font-weight: bold; width: 35%; } .timestamp-row td { background-color: #f2f2f2; font-style: italic; color: #555; }\u003c/style\u003e\u003c/head\u003e\u003cbody\u003e\n    \u003cimg src\u003d\"${getImageAsBase64(LOGO_URL)}\" alt\u003d\"Company Logo\" style\u003d\"max-height: 70px; margin-bottom: 20px;\"\u003e\n    \u003ch1\u003eNew Employee Request: ${employeeName}\u003c/h1\u003e`;\n    \n  const submissionTimestamp \u003d data[\u0027Submission Timestamp\u0027] instanceof Date ? Utilities.formatDate(data[\u0027Submission Timestamp\u0027], Session.getScriptTimeZone(), \"yyyy-MM-dd HH:mm:ss\") : data[\u0027Submission Timestamp\u0027];\n  if (requesterRows) {\n    if (submissionTimestamp) { requesterRows +\u003d `\u003ctr class\u003d\"timestamp-row\"\u003e\u003ctd colspan\u003d\"2\"\u003e\u003cstrong\u003eSubmitted on:\u003c/strong\u003e ${submissionTimestamp}\u003c/td\u003e\u003c/tr\u003e`; }\n    htmlBody +\u003d `\u003ch2\u003eEmployee Request Information\u003c/h2\u003e\u003ctable\u003e${requesterRows}\u003c/table\u003e`;\n  }\n  \n  const hrTimestamp \u003d data[\u0027HR - Date of Submission\u0027] instanceof Date ? Utilities.formatDate(data[\u0027HR - Date of Submission\u0027], Session.getScriptTimeZone(), \"yyyy-MM-dd HH:mm:ss\") : data[\u0027HR - Date of Submission\u0027];\n  if (hrRows) {\n    if (hrTimestamp) { hrRows +\u003d `\u003ctr class\u003d\"timestamp-row\"\u003e\u003ctd colspan\u003d\"2\"\u003e\u003cstrong\u003eCompleted on:\u003c/strong\u003e ${hrTimestamp}\u003c/td\u003e\u003c/tr\u003e`; }\n    htmlBody +\u003d `\u003ch2\u003eEmployee Setup Information\u003c/h2\u003e\u003ctable\u003e${hrRows}\u003c/table\u003e`;\n  }\n  \n  const itTimestamp \u003d data[\u0027IT - Completion Timestamp\u0027] instanceof Date ? Utilities.formatDate(data[\u0027IT - Completion Timestamp\u0027], Session.getScriptTimeZone(), \"yyyy-MM-dd HH:mm:ss\") : data[\u0027IT - Completion Timestamp\u0027];\n  if (itRows) {\n    if (itTimestamp) { itRows +\u003d `\u003ctr class\u003d\"timestamp-row\"\u003e\u003ctd colspan\u003d\"2\"\u003e\u003cstrong\u003eCompleted on:\u003c/strong\u003e ${itTimestamp}\u003c/td\u003e\u003c/tr\u003e`; }\n    htmlBody +\u003d `\u003ch2\u003eIT: System Setup Information\u003c/h2\u003e\u003ctable\u003e${itRows}\u003c/table\u003e`;\n  }\n\n  if (parallelTaskRows) {\n    htmlBody +\u003d `\u003ch2\u003eDepartmental Setup Tasks\u003c/h2\u003e\u003ctable\u003e${parallelTaskRows}\u003c/table\u003e`;\n  }\n  \n  if (finalApprovalRows) {\n    htmlBody +\u003d `\u003ch2\u003eFinal Approval Status\u003c/h2\u003e\u003ctable\u003e${finalApprovalRows}\u003c/table\u003e`;\n  }\n\n  htmlBody +\u003d `\u003c/body\u003e\u003c/html\u003e`;\n  return Utilities.newBlob(htmlBody, \u0027text/html\u0027, fileName).getAs(\u0027application/pdf\u0027);\n}\n\n// --- HELPER FUNCTIONS FOR doGet ROUTER ---\n\n/**\n * @description Renders and returns an HTML page from a template file.\n * @howItWorks It uses `HtmlService.createTemplateFromFile()` to load an HTML file. It can inject server-side data (like `logoUrl` or `requestId`) into the template. The `template.evaluate()` method processes the template and returns an `HtmlOutput` object that can be sent to the user\u0027s browser. It also sets standard properties like the page title and X-Frame options.\n * @output {HtmlService.HtmlOutput} The final HTML page to be displayed.\n */\nfunction showPage(filename, title, data) {\n  const template \u003d HtmlService.createTemplateFromFile(filename);\n  // Make the logo URL available in all HTML templates.\n  template.logoUrl \u003d LOGO_URL;\n  // Pass any additional data to the template.\n  if (data) {\n    for (const key in data) {\n      template[key] \u003d data[key];\n    }\n  }\n  const output \u003d template.evaluate().setTitle(title);\n  // Set security options for embedding.\n  output.setXFrameOptionsMode(HtmlService.XFrameOptionsMode.DEFAULT);\n  // Add mobile-friendly viewport meta tag for the main form.\n  if (filename \u003d\u003d\u003d \u0027Index.html\u0027) {\n    output.addMetaTag(\u0027viewport\u0027, \u0027width\u003ddevice-width, initial-scale\u003d1.0\u0027);\n  }\n  return output;\n}\n\n/**\n * @description Renders a generic \"Closed\" or \"Invalid State\" page.\n * @howItWorks It uses the `Closed.html` template, passing the current `status` of the request to be displayed to the user. This is a catch-all page for when a user tries to access a URL that is no longer valid for the request\u0027s current state.\n * @output {HtmlService.HtmlOutput} The \"Closed\" HTML page.\n */\nfunction showClosedPage(status) {\n  const template \u003d HtmlService.createTemplateFromFile(\u0027Closed.html\u0027);\n  template.logoUrl \u003d LOGO_URL;\n  template.status \u003d status;\n  return template.evaluate().setTitle(\u0027Request Closed\u0027);\n}"},{"id":"7133bc3a-736c-44d9-8068-1b52c5023dc6","name":"Index","type":"html","source":"\u003c!DOCTYPE html\u003e\n\u003chtml\u003e\n  \u003chead\u003e\n    \u003cbase target\u003d\"_top\"\u003e\n    \u003c?!\u003d HtmlService.createHtmlOutputFromFile(\u0027CSS.html\u0027).getContent(); ?\u003e\n  \u003c/head\u003e\n  \u003cbody\u003e\n    \u003cdiv class\u003d\"container\"\u003e\n      \u003cdiv style\u003d\"text-align: center; margin-bottom: 20px;\"\u003e\n        \u003cimg src\u003d\"\u003c?\u003d logoUrl ?\u003e\" alt\u003d\"Company Logo\" style\u003d\"max-height: 70px;\"\u003e\n      \u003c/div\u003e\n      \u003cdiv id\u003d\"form-container\"\u003e\n        \u003cdiv class\u003d\"loader\"\u003eLoading...\u003c/div\u003e\n      \u003c/div\u003e\n      \u003cdiv id\u003d\"status-message\"\u003e\u003c/div\u003e\n    \u003c/div\u003e\n    \u003c?!\u003d HtmlService.createHtmlOutputFromFile(\u0027JavaScript.html\u0027).getContent(); ?\u003e\n  \u003c/body\u003e\n\u003c/html\u003e"},{"id":"169a4085-8d01-4825-b49d-cfd094283ce9","name":"CSS","type":"html","source":"\u003cstyle\u003e\n  body { font-family: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, Helvetica, Arial, sans-serif; background-color: #f7f9fc; color: #333; line-height: 1.6; }\n  .container { max-width: 900px; margin: 20px auto; padding: 20px 40px; background: #fff; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.08); }\n  h1 { color: #2c3e50; border-bottom: 2px solid #eaecee; padding-bottom: 15px; }\n  h2 { font-size: 1.5em; color: #34495e; border-top: 1px solid #eaecee; padding-top: 20px; margin-top: 30px; }\n  .question-wrapper { margin-bottom: 25px; }\n  .form-section { padding: 10px 0; }\n  .sub-section { border-left: 4px solid #EB1C2D; padding: 20px; margin-top: 15px; background-color: #fcf6f6; border-radius: 5px; }\n  h3 { color: #EB1C2D; margin-top: 0; border-bottom: 1px solid #ecf0f1; padding-bottom: 10px; }\n  label { display: block; font-weight: bold; margin-bottom: 8px; color: #555; }\n  input[type\u003d\"text\"], input[type\u003d\"date\"], input[type\u003d\"email\"], textarea, select { width: 100%; padding: 12px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; font-size: 1em; }\n  input:focus, textarea:focus, select:focus { border-color: #EB1C2D; outline: none; box-shadow: 0 0 5px rgba(235, 28, 46, 0.5); }\n  button { background-color: #EB1C2D; color: white; padding: 12px 25px; border: none; border-radius: 5px; cursor: pointer; font-size: 1.1em; transition: background-color 0.3s; }\n  button:hover { background-color: #be1624; }\n  .multi-input-container { display: flex; flex-direction: column; gap: 8px; }\n  .multi-input-row { display: flex; gap: 8px; align-items: center; }\n  .multi-input-row select, .multi-input-row input { flex-grow: 1; }\n  .add-btn { padding: 0; width: 45px; height: 45px; flex-shrink: 0; background-color: #2ecc71; font-size: 1.5em; line-height: 45px; }\n  .add-btn:hover { background-color: #27ae60; }\n  #submit-container { text-align: right; margin-top: 30px; }\n  #gatekeeper-message, #status-message { margin-top: 20px; padding: 15px; border-radius: 5px; text-align: center; }\n  .status-success { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }\n  .status-error { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }\n  .status-info { background-color: #cce5ff; color: #004085; border: 1px solid #b8daff; }\n  .loader { text-align: center; padding: 40px; font-size: 1.2em; color: #777; }\n\u003c/style\u003e"},{"id":"96d5b476-3d65-4d7a-aafd-28daff88dbb8","name":"JavaScript","type":"html","source":"\u003cscript\u003e\n/**\n * @description Main entry point for the script. This function executes after the entire HTML document has been loaded and parsed.\n * @howItWorks It adds an event listener for \u0027DOMContentLoaded\u0027. Once the DOM is ready, it initiates the process of fetching data from the server-side Apps Script and then builds the dynamic form on the page.\n */\ndocument.addEventListener(\u0027DOMContentLoaded\u0027, function() {\n  // Get references to the main DOM elements where the form and status messages will be rendered.\n  const formContainer \u003d document.getElementById(\u0027form-container\u0027);\n  const statusMessage \u003d document.getElementById(\u0027status-message\u0027);\n  // A global variable to hold job code data fetched from the server, used for populating dynamic dropdowns.\n  let jobCodeData \u003d [];\n\n  // --- 1. INITIAL DATA FETCH ---\n  /**\n   * @description Fetches the initial data required to build the form from the server-side Google Apps Script.\n   * @howItWorks\n   * - It reads the URL parameters (specifically the \u0027id\u0027 for editing an existing request).\n   * - It calls the `getRequesterInitialData` function in the `code.gs` file using `google.script.run`.\n   * - `withSuccessHandler(onDataReceived)` specifies the function to call when data is returned successfully.\n   * - `withFailureHandler(onFailure)` specifies the function to call if an error occurs.\n   */\n  const urlParams \u003d new URLSearchParams(window.location.search);\n  const params \u003d {\n    id: urlParams.get(\u0027id\u0027) // Will be null if it\u0027s a new form, or have a value if editing.\n  };\n\n  google.script.run\n    .withSuccessHandler(onDataReceived)\n    .withFailureHandler(onFailure)\n    .getRequesterInitialData(params);\n\n  /**\n   * @description Callback function that executes when the initial data is successfully fetched from the server.\n   * @whatItDoes It receives the data object from the server, stores the job code data, and triggers the form building process.\n   * @param {object} data - An object returned from the server containing `requestData` (for edits), `formStructure`, and `jobCodeData`.\n   */\n  function onDataReceived(data) {\n    // If the server returned a custom error message, handle it.\n    if (data.error) {\n      onFailure({ message: data.error });\n      return;\n    }\n    // Store job code data for later use.\n    jobCodeData \u003d data.jobCodeData;\n    // Call the main function to construct the HTML form.\n    buildRequesterForm(data.requestData, params.id, data.formStructure);\n  }\n\n  /**\n   * @description Callback function that executes if the server call fails.\n   * @whatItDoes It displays a user-friendly error message in the main form container.\n   * @param {Error} error - An error object containing a message about the failure.\n   */\n  function onFailure(error) {\n    formContainer.innerHTML \u003d `\u003ch1\u003eError\u003c/h1\u003e\u003cp\u003eCould not load the application: ${error.message}\u003c/p\u003e`;\n  }\n\n\n  // --- 2. FORM BUILDING ---\n  /**\n   * @description The core function that dynamically builds the entire HTML form based on the structure received from the server. It also sets up all client-side logic and event listeners.\n   * @whatItDoes It iterates through the form structure, creates corresponding HTML elements for each question and section, and attaches event listeners to handle dynamic interactions like showing/hiding sections, auto-populating fields, and syncing dropdowns.\n   * @param {object} existingData - An object with pre-filled data if editing a request. Null for a new request.\n   * @param {string} id - The request ID, if editing.\n   * @param {Array\u003cobject\u003e} structure - An array of objects, where each object describes a question or section from the Google Form.\n   */\n  function buildRequesterForm(existingData, id, structure) {\n    // Determine titles and text based on whether this is a new form or an edit.\n    let formTitle \u003d existingData ? \u0027Edit Employee Request\u0027 : \u0027Employee Request Form\u0027;\n    let submitButtonText \u003d existingData ? \u0027Resubmit Request\u0027 : \u0027Submit Request\u0027;\n    let introText \u003d existingData ? `Please revise the details below. Reason for sending back: \u003cstrong\u003e\u003cem\u003e${existingData[\u0027Approval Notes\u0027] || \u0027N/A\u0027}\u003c/em\u003e\u003c/strong\u003e` : \u0027This form is generated directly from the master Google Form. Sections will appear below as you make selections.\u0027;\n    \n    // Set up the basic skeleton of the form.\n    formContainer.innerHTML \u003d `\u003ch1\u003e${formTitle}\u003c/h1\u003e\u003cp\u003e${introText}\u003c/p\u003e\u003cform id\u003d\"requester-form\"\u003e\u003cinput type\u003d\"hidden\" name\u003d\"formType\" value\u003d\"requester\"\u003e\u003cdiv id\u003d\"gatekeeper-container\"\u003e\u003c/div\u003e\u003cdiv id\u003d\"gatekeeper-message\" class\u003d\"status-error\" style\u003d\"display: none;\"\u003eAll Recruiting Requirements must be met to proceed.\u003c/div\u003e\u003cdiv id\u003d\"main-form-container\" style\u003d\"display: none;\"\u003e\u003cdiv id\u003d\"form-content\"\u003e\u003c/div\u003e\u003cdiv id\u003d\"submit-container\"\u003e\u003cbutton type\u003d\"submit\"\u003e${submitButtonText}\u003c/button\u003e\u003c/div\u003e\u003c/div\u003e\u003c/form\u003e`;\n    \n    // If we are editing, add a hidden input to store the Request ID.\n    if (existingData) {\n      const hiddenIdInput \u003d document.createElement(\u0027input\u0027);\n      hiddenIdInput.type \u003d \u0027hidden\u0027;\n      hiddenIdInput.name \u003d \u0027Request ID\u0027;\n      hiddenIdInput.value \u003d id;\n      document.getElementById(\u0027requester-form\u0027).appendChild(hiddenIdInput);\n    }\n    \n    // Handle case where form structure failed to load.\n    if (!structure || structure.length \u003d\u003d\u003d 0) {\n      formContainer.innerHTML \u003d \u0027\u003ch1\u003eError: Could not load form structure.\u003c/h1\u003e\u0027;\n      return;\n    }\n\n    // Get references to the newly created form elements.\n    const formElement \u003d document.getElementById(\u0027requester-form\u0027);\n    const formContent \u003d document.getElementById(\u0027form-content\u0027);\n    const gatekeeperContainer \u003d document.getElementById(\u0027gatekeeper-container\u0027);\n    let gatekeeperSelect \u003d null;\n    \n    // --- Loop through the form structure from the server and build HTML elements ---\n    structure.forEach(item \u003d\u003e {\n        if (item.type \u003d\u003d\u003d \u0027PAGE_BREAK\u0027) {\n            // Create a new section \u003cdiv\u003e with an \u003ch2\u003e title.\n            const sectionDiv \u003d document.createElement(\u0027div\u0027);\n            sectionDiv.className \u003d \u0027form-section\u0027;\n            const sectionId \u003d \u0027section-\u0027 + item.title.replace(/\\s|[/?]/g, \u0027-\u0027);\n            sectionDiv.id \u003d sectionId;\n            const sectionTitle \u003d document.createElement(\u0027h2\u0027);\n            sectionTitle.textContent \u003d item.title;\n            sectionDiv.appendChild(sectionTitle);\n            // Hide sections that are controlled by conditional logic by default.\n            if (Object.values(logicMap).includes(item.title)) {\n                sectionDiv.style.display \u003d \u0027none\u0027;\n            }\n            formContent.appendChild(sectionDiv);\n        } else {\n            // For regular questions, create the appropriate input element.\n            const questionElement \u003d createQuestionElement(item, existingData);\n            // The \"gatekeeper\" question is special and gets placed in its own container.\n            if (item.title \u003d\u003d\u003d \"Have all Recruiting Requirements been met?\") {\n                gatekeeperContainer.appendChild(questionElement);\n                gatekeeperSelect \u003d questionElement.querySelector(\u0027select\u0027);\n                if (gatekeeperSelect) {\n                    gatekeeperSelect.addEventListener(\u0027change\u0027, handleGatekeeperChange);\n                }\n            } else {\n                // All other questions go into the current section.\n                const sections \u003d formContent.querySelectorAll(\u0027.form-section\u0027);\n                const currentSection \u003d sections.length \u003e 0 ? sections[sections.length - 1] : formContent;\n                currentSection.appendChild(questionElement);\n            }\n        }\n    });\n    \n    // After creating all elements, set up dropdowns that depend on the job code data.\n    setupDynamicDropdowns(existingData);\n\n    // --- Set up dynamic client-side logic and event listeners ---\n    const hourlySalarySelect \u003d formElement.querySelector(\u0027[name\u003d\"Hourly or Salary\"]\u0027);\n    const firstNameInput \u003d formElement.querySelector(\u0027[name\u003d\"First Name\"]\u0027);\n    const lastNameInput \u003d formElement.querySelector(\u0027[name\u003d\"Last Name\"]\u0027);\n    const emailInput \u003d formElement.querySelector(\u0027[name\u003d\"Email Requested\"]\u0027);\n    const googleAccountSelect \u003d formElement.querySelector(\u0027[name\u003d\"Google Account\"]\u0027);\n    const emailWrapper \u003d emailInput ? emailInput.closest(\u0027.question-wrapper\u0027) : null;\n\n    /**\n     * @description Shows or hides the \"Email Requested\" input field based on whether a Google Account is needed.\n     */\n    function updateEmailVisibility() {\n        if (!googleAccountSelect || !emailWrapper) return;\n        if (googleAccountSelect.checked) {\n            emailWrapper.style.display \u003d \u0027block\u0027;\n        } else {\n            emailWrapper.style.display \u003d \u0027none\u0027;\n            emailInput.value \u003d \u0027\u0027; // Clear the value when hidden.\n        }\n    }\n\n    /**\n     * @description Automatically generates a suggested email address for salaried employees.\n     * @howItWorks It combines the first and last names into the format \"firstname.lastname@team-group.com\".\n     */\n    function updateEmail() {\n        if (!hourlySalarySelect || !firstNameInput || !lastNameInput || !emailInput || !googleAccountSelect) return;\n        \n        if (googleAccountSelect.checked \u0026\u0026 hourlySalarySelect.value \u003d\u003d\u003d \u0027Salary\u0027) {\n            const first \u003d firstNameInput.value.trim().toLowerCase().split(\u0027 \u0027)[0];\n            const last \u003d lastNameInput.value.trim().toLowerCase().split(\u0027 \u0027)[0];\n            if (first \u0026\u0026 last) {\n                emailInput.value \u003d `${first}.${last}@team-group.com`;\n            } else {\n                 emailInput.value \u003d \u0027\u0027;\n            }\n        }\n    }\n    \n    // Attach listeners for the email generation logic.\n    if (googleAccountSelect) {\n        googleAccountSelect.addEventListener(\u0027change\u0027, () \u003d\u003e {\n            updateEmailVisibility();\n            updateEmail();\n        });\n    }\n    if (firstNameInput \u0026\u0026 lastNameInput \u0026\u0026 hourlySalarySelect) {\n        firstNameInput.addEventListener(\u0027input\u0027, updateEmail);\n        lastNameInput.addEventListener(\u0027input\u0027, updateEmail);\n        hourlySalarySelect.addEventListener(\u0027change\u0027, updateEmail);\n    }\n\n    // Logic for showing/hiding the entire \"System/Equipment Access\" section.\n    const additionalAccessCheckbox \u003d formElement.querySelector(\u0027[name\u003d\"Additional System/Equipment Access Needed?\"]\u0027);\n    const systemAccessSection \u003d document.getElementById(\u0027section-System-Equipment-Access\u0027);\n\n    function updateSystemAccessVisibility() {\n        if (!hourlySalarySelect || !systemAccessSection) return;\n        const type \u003d hourlySalarySelect.value;\n        if (type \u003d\u003d\u003d \u0027Salary\u0027) {\n            // Salaried employees always see this section.\n            systemAccessSection.style.display \u003d \u0027block\u0027;\n            if (additionalAccessCheckbox) additionalAccessCheckbox.closest(\u0027.question-wrapper\u0027).style.display \u003d \u0027none\u0027;\n            if (googleAccountSelect) {\n              googleAccountSelect.checked \u003d true; // Salaried employees get a Google account by default.\n              googleAccountSelect.dispatchEvent(new Event(\u0027change\u0027)); // Trigger other logic.\n            }\n        } else if (type \u003d\u003d\u003d \u0027Hourly\u0027) {\n            // Hourly employees only see it if they check the \u0027Additional Access\u0027 box.\n            if (additionalAccessCheckbox) {\n                additionalAccessCheckbox.closest(\u0027.question-wrapper\u0027).style.display \u003d \u0027block\u0027;\n                systemAccessSection.style.display \u003d additionalAccessCheckbox.checked ? \u0027block\u0027 : \u0027none\u0027;\n            } else {\n                systemAccessSection.style.display \u003d \u0027none\u0027;\n            }\n            if (googleAccountSelect \u0026\u0026 !existingData) { // Don\u0027t override existing data.\n              googleAccountSelect.checked \u003d false;\n              googleAccountSelect.dispatchEvent(new Event(\u0027change\u0027));\n            }\n        } else {\n            // If neither is selected, hide everything.\n            systemAccessSection.style.display \u003d \u0027none\u0027;\n            if (additionalAccessCheckbox) additionalAccessCheckbox.closest(\u0027.question-wrapper\u0027).style.display \u003d \u0027none\u0027;\n        }\n    }\n    \n    // Attach listeners for the system access visibility logic.\n    if (hourlySalarySelect) hourlySalarySelect.addEventListener(\u0027change\u0027, updateSystemAccessVisibility);\n    if (additionalAccessCheckbox) additionalAccessCheckbox.addEventListener(\u0027change\u0027, updateSystemAccessVisibility);\n\n    // Logic to ensure \"BOSS User Account\" is checked if any of its sub-options are checked.\n    const bossAccountCheckbox \u003d formElement.querySelector(\u0027[name\u003d\"BOSS User Account\"]\u0027);\n    const dependentCheckboxes \u003d [\n        formElement.querySelector(\u0027[name\u003d\"Cost Sheet\"]\u0027),\n        formElement.querySelector(\u0027[name\u003d\"Leader Access\"]\u0027),\n        formElement.querySelector(\u0027[name\u003d\"Trip Reports Access\"]\u0027)\n    ];\n    \n    dependentCheckboxes.forEach(checkbox \u003d\u003e {\n        if (checkbox) {\n            checkbox.addEventListener(\u0027change\u0027, () \u003d\u003e {\n                if (checkbox.checked \u0026\u0026 bossAccountCheckbox) {\n                    bossAccountCheckbox.checked \u003d true;\n                }\n            });\n        }\n    });\n\n    // Logic to show/hide \u0027Transform\u0027 and \u0027CAA\u0027 checkboxes based on selected Site Name.\n    const siteNameSelectForLogic \u003d formElement.querySelector(\u0027[name\u003d\"Site Name\"]\u0027);\n    const transformCheckboxWrapper \u003d formElement.querySelector(\u0027[name\u003d\"Transform\"]\u0027)?.closest(\u0027.question-wrapper\u0027);\n    const caaCheckboxWrapper \u003d formElement.querySelector(\u0027[name\u003d\"CAA\"]\u0027)?.closest(\u0027.question-wrapper\u0027);\n\n    function updateSiteSpecificCheckboxes() {\n        if (!siteNameSelectForLogic || (!transformCheckboxWrapper \u0026\u0026 !caaCheckboxWrapper)) return;\n        \n        const selectedSite \u003d siteNameSelectForLogic.value.toLowerCase();\n        \n        // \u0027Transform\u0027 is only for Toyota sites.\n        if (transformCheckboxWrapper) {\n            transformCheckboxWrapper.style.display \u003d selectedSite.startsWith(\u0027toyota\u0027) ? \u0027flex\u0027 : \u0027none\u0027;\n            if (!selectedSite.startsWith(\u0027toyota\u0027)) formElement.querySelector(\u0027[name\u003d\"Transform\"]\u0027).checked \u003d false;\n        }\n        // \u0027CAA\u0027 is only for GM sites.\n        if (caaCheckboxWrapper) {\n            caaCheckboxWrapper.style.display \u003d selectedSite.startsWith(\u0027gm\u0027) ? \u0027flex\u0027 : \u0027none\u0027;\n            if (!selectedSite.startsWith(\u0027gm\u0027)) formElement.querySelector(\u0027[name\u003d\"CAA\"]\u0027).checked \u003d false;\n        }\n    }\n\n    if (siteNameSelectForLogic) {\n      siteNameSelectForLogic.addEventListener(\u0027change\u0027, updateSiteSpecificCheckboxes);\n    }\n    \n    // --- Initial State Setup ---\n    // Run all the logic functions once on page load to set the initial state of the form correctly.\n    document.querySelectorAll(\u0027select, input[type\u003dcheckbox]\u0027).forEach(el \u003d\u003e handleSubLogicChange({target: el}));\n    if (gatekeeperSelect) handleGatekeeperChange({ target: gatekeeperSelect });\n    updateSystemAccessVisibility();\n    updateEmailVisibility();\n    updateEmail();\n    updateSiteSpecificCheckboxes();\n\n    // Attach the final submit handler to the form.\n    formElement.addEventListener(\u0027submit\u0027, handleFormSubmit);\n    // Prevent accidental submission by pressing Enter in text fields.\n    formElement.addEventListener(\u0027keydown\u0027, function(event) {\n        if (event.key \u003d\u003d\u003d \u0027Enter\u0027 \u0026\u0026 event.target.tagName !\u003d\u003d \u0027TEXTAREA\u0027) {\n            event.preventDefault();\n        }\n    });\n\n    // Remove the initial loading spinner.\n    const loader \u003d formContainer.querySelector(\u0027.loader\u0027);\n    if(loader) loader.remove();\n  }\n  \n  /**\n   * @description Handles the change event for the \"gatekeeper\" question.\n   * @whatItDoes It shows or hides the main body of the form. The user cannot proceed until they select \"Yes\".\n   */\n  function handleGatekeeperChange(event) {\n    const showForm \u003d event.target.value \u003d\u003d\u003d \u0027Yes\u0027;\n    document.getElementById(\u0027main-form-container\u0027).style.display \u003d showForm ? \u0027block\u0027 : \u0027none\u0027;\n    document.getElementById(\u0027gatekeeper-message\u0027).style.display \u003d showForm ? \u0027none\u0027 : \u0027block\u0027;\n  }\n  \n  /**\n   * @description A configuration object mapping a trigger question (the key) to the title of the form section it controls (the value).\n   * @howItWorks The `handleSubLogicChange` function uses this map to determine which section to show or hide when a trigger question\u0027s value changes.\n   */\n  const logicMap \u003d {\u0027Cost Sheet\u0027: \u0027COST Sheet Module\u0027,\u0027Delivery App\u0027: \u0027Delivery Module\u0027,\u0027JONAS Purchasing Software\u0027: \u0027JONAS Purchasing Module\u0027,\u0027JONAS Field Time/Field Project Access\u0027: \u0027JONAS Field Time/Field Project Access\u0027,\u0027JONAS EBI Access\u0027: \u0027JONAS EBI Access\u0027,\u0027Mobile Phone\u0027: \u0027Mobile Phone Assignment\u0027,\u0027Computer\u0027: \u0027Computer Assignment\u0027,\u0027Is the new User getting a previous user assigned phone?\u0027: \u0027Reassigned Phone Details\u0027,\u0027Is the new User getting a previous user assigned computer?\u0027: \u0027Reassigned Computer Details\u0027, \u0027BOSS User Account\u0027: \u0027BOSS User Account\u0027};\n\n  /**\n   * @description Creates the HTML elements for a single question based on its type and other properties from the form structure.\n   * @whatItDoes This is a factory function for form elements. It handles simple text inputs, textareas, dropdowns, checkboxes, and special multi-input fields.\n   * @param {object} item - An object describing the question (title, type, choices, etc.).\n   * @param {object} existingData - The pre-filled data for the form, if any.\n   * @returns {HTMLElement} A div element (`question-wrapper`) containing the label and input field for the question.\n   */\n  function createQuestionElement(item, existingData) {\n    const questionWrapper \u003d document.createElement(\u0027div\u0027);\n    questionWrapper.className \u003d \u0027question-wrapper\u0027;\n    \n    // Create the \u003clabel\u003e for the question.\n    if(item.type !\u003d\u003d \u0027PAGE_BREAK\u0027) {\n        const label \u003d document.createElement(\u0027label\u0027);\n        label.textContent \u003d item.title;\n        // Special styling for checkboxes to align them nicely.\n        if(item.type \u003d\u003d\u003d \u0027CHECKBOX\u0027) {\n          questionWrapper.style.display \u003d \u0027flex\u0027;\n          questionWrapper.style.alignItems \u003d \u0027center\u0027;\n          label.style.order \u003d 2; // Label comes after checkbox.\n          label.style.marginBottom \u003d 0;\n          label.style.marginLeft \u003d \u002710px\u0027;\n        }\n        questionWrapper.appendChild(label);\n    }\n\n    // Get the existing value for this question, if available.\n    const value \u003d existingData ? (existingData[item.title] || \u0027\u0027) : \u0027\u0027;\n    const lowerCaseTitle \u003d item.title.toLowerCase();\n    \n    // --- SPECIAL LOGIC for Multi-Input Dropdowns ---\n    if (lowerCaseTitle.includes(\u0027job site(s) to be assigned\u0027) || lowerCaseTitle.includes(\u0027job number(s) to be assigned\u0027)) {\n        const isJobNumber \u003d lowerCaseTitle.includes(\u0027job number(s) to be assigned\u0027);\n        const sourceIndex \u003d isJobNumber ? 2 : 0; // Index in jobCodeData array\n        const placeholder \u003d isJobNumber ? \u0027Job Number\u0027 : \u0027Site Name\u0027;\n\n        const multiInputContainer \u003d document.createElement(\u0027div\u0027);\n        multiInputContainer.className \u003d \u0027multi-input-container\u0027;\n\n        // Function to create a single dropdown row.\n        const createDropdownRow \u003d (selectedValue) \u003d\u003e {\n            const row \u003d document.createElement(\u0027div\u0027);\n            row.className \u003d \u0027multi-input-row\u0027;\n            const dropdown \u003d document.createElement(\u0027select\u0027);\n            dropdown.name \u003d item.title; // All dropdowns share the same name.\n            dropdown.innerHTML \u003d `\u003coption value\u003d\"\"\u003e-- Select ${placeholder} --\u003c/option\u003e`;\n            jobCodeData.forEach(jobRow \u003d\u003e {\n                dropdown.innerHTML +\u003d `\u003coption value\u003d\"${jobRow[sourceIndex]}\"\u003e${jobRow[sourceIndex]}\u003c/option\u003e`;\n            });\n            if (selectedValue) {\n                dropdown.value \u003d selectedValue;\n            }\n            row.appendChild(dropdown);\n            return row;\n        };\n        \n        // If editing, split the comma-separated string into multiple dropdowns.\n        const existingValues \u003d value ? value.split(\u0027, \u0027) : [\u0027\u0027];\n        existingValues.forEach((val, index) \u003d\u003e {\n            const newRow \u003d createDropdownRow(val);\n            if (index \u003d\u003d\u003d 0) { // Add the \u0027+\u0027 button only to the first row.\n                const addButton \u003d document.createElement(\u0027button\u0027);\n                addButton.type \u003d \u0027button\u0027;\n                addButton.className \u003d \u0027add-btn\u0027;\n                addButton.textContent \u003d \u0027+\u0027;\n                addButton.addEventListener(\u0027click\u0027, () \u003d\u003e {\n                    const freshRow \u003d createDropdownRow();\n                    multiInputContainer.appendChild(freshRow);\n                });\n                newRow.appendChild(addButton);\n            }\n            multiInputContainer.appendChild(newRow);\n        });\n\n        questionWrapper.appendChild(multiInputContainer);\n        return questionWrapper;\n    }\n    \n    // --- SPECIAL LOGIC for Credit Card Accounts ---\n    if (item.title \u003d\u003d\u003d \u0027Additional Credit/ Purchasing Accounts\u0027) {\n        questionWrapper.style.display \u003d \u0027none\u0027; // Hide by default.\n        const creditCardOptions \u003d [\"Amazon\", \"Staples\", \"HomeDepot (physical card)\"];\n        const multiSelectContainer \u003d document.createElement(\u0027div\u0027);\n        multiSelectContainer.className \u003d \u0027multi-input-container\u0027;\n\n        const createSelectRow \u003d (selectedValue) \u003d\u003e {\n            const row \u003d document.createElement(\u0027div\u0027);\n            row.className \u003d \u0027multi-input-row\u0027;\n            const select \u003d document.createElement(\u0027select\u0027);\n            select.name \u003d item.title;\n            select.innerHTML \u003d \u0027\u003coption value\u003d\"\"\u003e-- Select Account Type --\u003c/option\u003e\u0027;\n            creditCardOptions.forEach(opt \u003d\u003e {\n                select.innerHTML +\u003d `\u003coption value\u003d\"${opt}\"\u003e${opt}\u003c/option\u003e`;\n            });\n            if (selectedValue) {\n                select.value \u003d selectedValue;\n            }\n            row.appendChild(select);\n            return row;\n        }\n        \n        const existingValues \u003d value ? value.split(\u0027, \u0027) : [\u0027\u0027];\n        existingValues.forEach((val, index) \u003d\u003e {\n            const newRow \u003d createSelectRow(val);\n            if (index \u003d\u003d\u003d 0) { // Add the \u0027+\u0027 button to the first row.\n                const addButton \u003d document.createElement(\u0027button\u0027);\n                addButton.type \u003d \u0027button\u0027;\n                addButton.className \u003d \u0027add-btn\u0027;\n                addButton.textContent \u003d \u0027+\u0027;\n                addButton.addEventListener(\u0027click\u0027, () \u003d\u003e {\n                    multiSelectContainer.appendChild(createSelectRow());\n                });\n                newRow.appendChild(addButton);\n            }\n            multiSelectContainer.appendChild(newRow);\n        });\n        \n        questionWrapper.appendChild(multiSelectContainer);\n        // This entire question is only visible if the \"Credit Card\" checkbox is checked.\n        const creditCardCheckbox \u003d document.querySelector(\u0027[name\u003d\"Credit Card\"]\u0027);\n        if (creditCardCheckbox) {\n          creditCardCheckbox.addEventListener(\u0027change\u0027, () \u003d\u003e {\n            questionWrapper.style.display \u003d creditCardCheckbox.checked ? \u0027block\u0027 : \u0027none\u0027;\n          });\n          // Set initial state on load.\n          questionWrapper.style.display \u003d creditCardCheckbox.checked ? \u0027block\u0027 : \u0027none\u0027;\n        }\n        return questionWrapper;\n    }\n\n    // --- Standard Input Creation ---\n    let input;\n    switch(item.type) {\n        case \u0027CHECKBOX\u0027:\n            input \u003d document.createElement(\u0027input\u0027);\n            input.type \u003d \u0027checkbox\u0027;\n            input.name \u003d item.title;\n            input.style.width \u003d \u002720px\u0027;\n            input.style.height \u003d \u002720px\u0027;\n            input.style.order \u003d 1; // Checkbox comes before label.\n            input.checked \u003d value \u003d\u003d\u003d \u0027Yes\u0027 || value \u003d\u003d\u003d true;\n            // Add a listener if this checkbox controls a section\u0027s visibility.\n            if (logicMap[item.title] || item.title.startsWith(\u0027BOSS\u0027) || item.title.startsWith(\u0027Cost\u0027) || item.title.startsWith(\u0027Leader\u0027) || item.title.startsWith(\u0027Trip\u0027)) {\n                input.addEventListener(\u0027change\u0027, handleSubLogicChange);\n            }\n            break;\n        case \u0027TEXT\u0027:\n        case \u0027DATE\u0027:\n            input \u003d document.createElement(\u0027input\u0027);\n            input.type \u003d item.type \u003d\u003d\u003d \u0027DATE\u0027 ? \u0027date\u0027 : \u0027text\u0027;\n            break;\n        case \u0027PARAGRAPH_TEXT\u0027:\n            input \u003d document.createElement(\u0027textarea\u0027);\n            break;\n        case \u0027MULTIPLE_CHOICE\u0027:\n        case \u0027LIST\u0027:\n            input \u003d document.createElement(\u0027select\u0027);\n            input.innerHTML \u003d \u0027\u003coption value\u003d\"\"\u003e--Please choose an option--\u003c/option\u003e\u0027;\n            if (item.choices) item.choices.forEach(c \u003d\u003e { \n                const isSelected \u003d (c \u003d\u003d\u003d value) ? \u0027selected\u0027 : \u0027\u0027;\n                input.innerHTML +\u003d `\u003coption value\u003d\"${c}\" ${isSelected}\u003e${c}\u003c/option\u003e`; \n            });\n            // Add a listener if this dropdown controls a section\u0027s visibility.\n            if (logicMap[item.title]) {\n                input.addEventListener(\u0027change\u0027, handleSubLogicChange);\n            }\n            break;\n    }\n\n    if (input) {\n        if (input.type !\u003d\u003d \u0027checkbox\u0027) {\n            input.name \u003d item.title;\n            if(input.tagName.toLowerCase() !\u003d\u003d \u0027select\u0027){\n                input.value \u003d value;\n            }\n        }\n        questionWrapper.appendChild(input);\n    }\n    return questionWrapper;\n  }\n\n  /**\n   * @description Converts the plain text inputs for \"Site Name\" and \"Job Site Number\" into dynamic, synchronized dropdowns.\n   * @howItWorks It finds the original input elements created by `createQuestionElement`, replaces them with `\u003cselect\u003e` elements populated from `jobCodeData`, and then adds `change` listeners to each. When one dropdown changes, the `syncDropdowns` function is called to update the other.\n   */\n  function setupDynamicDropdowns(existingData) {\n      if (jobCodeData.length \u003d\u003d\u003d 0) return;\n      \n      let siteNameWrapper, jobSiteNumberWrapper;\n      document.querySelectorAll(\u0027.question-wrapper label\u0027).forEach(label \u003d\u003e {\n          if (label.textContent \u003d\u003d\u003d \"Site Name\") siteNameWrapper \u003d label.parentElement;\n          if (label.textContent \u003d\u003d\u003d \"Job Site Number\") jobSiteNumberWrapper \u003d label.parentElement;\n      });\n\n      if (!siteNameWrapper || !jobSiteNumberWrapper) return;\n\n      // Create Site Name dropdown.\n      const siteNameSelect \u003d document.createElement(\u0027select\u0027);\n      siteNameSelect.name \u003d \"Site Name\";\n      siteNameSelect.innerHTML \u003d \u0027\u003coption value\u003d\"\"\u003e-- Select Site Name --\u003c/option\u003e\u0027;\n      jobCodeData.forEach(row \u003d\u003e {\n          siteNameSelect.innerHTML +\u003d `\u003coption value\u003d\"${row[0]}\"\u003e${row[0]}\u003c/option\u003e`;\n      });\n\n      // Create Job Site Number dropdown.\n      const jobSiteNumberSelect \u003d document.createElement(\u0027select\u0027);\n      jobSiteNumberSelect.name \u003d \"Job Site Number\";\n      jobSiteNumberSelect.innerHTML \u003d \u0027\u003coption value\u003d\"\"\u003e-- Select Job Number --\u003c/option\u003e\u0027;\n      jobCodeData.forEach(row \u003d\u003e {\n          jobSiteNumberSelect.innerHTML +\u003d `\u003coption value\u003d\"${row[2]}\"\u003e${row[2]}\u003c/option\u003e`;\n      });\n\n      // Replace the original text inputs with the new select elements.\n      siteNameWrapper.querySelector(\u0027input\u0027).replaceWith(siteNameSelect);\n      jobSiteNumberWrapper.querySelector(\u0027input\u0027).replaceWith(jobSiteNumberSelect);\n\n      // Add event listeners to sync them.\n      siteNameSelect.addEventListener(\u0027change\u0027, () \u003d\u003e syncDropdowns(\u0027siteName\u0027, siteNameSelect.value, jobSiteNumberSelect));\n      jobSiteNumberSelect.addEventListener(\u0027change\u0027, () \u003d\u003e syncDropdowns(\u0027jobNumber\u0027, jobSiteNumberSelect.value, siteNameSelect));\n      \n      // If editing, set the dropdowns to their previously saved values.\n      if (existingData) {\n        siteNameSelect.value \u003d existingData[\u0027Site Name\u0027] || \u0027\u0027;\n        jobSiteNumberSelect.value \u003d existingData[\u0027Job Site Number\u0027] || \u0027\u0027;\n      }\n  }\n\n  /**\n   * @description A helper function that synchronizes the \"Site Name\" and \"Job Site Number\" dropdowns.\n   * @howItWorks When one dropdown changes, this function finds the corresponding value for the other dropdown in the `jobCodeData` array and sets its value.\n   */\n  function syncDropdowns(source, value, targetSelect) {\n      if (!value) {\n          targetSelect.value \u003d \u0027\u0027;\n          return;\n      }\n      if (source \u003d\u003d\u003d \u0027siteName\u0027) {\n          const match \u003d jobCodeData.find(row \u003d\u003e row[0] \u003d\u003d\u003d value);\n          if (match) targetSelect.value \u003d match[2];\n      } else if (source \u003d\u003d\u003d \u0027jobNumber\u0027) {\n          const match \u003d jobCodeData.find(row \u003d\u003e row[2] \u003d\u003d\u003d value);\n          if (match) targetSelect.value \u003d match[0];\n      }\n  }\n\n  /**\n   * @description Handles the logic for showing/hiding form sections based on user selections.\n   * @howItWorks It checks if the changed input (`triggerInput`) is a key in the `logicMap`. If it is, it finds the target section by its ID and toggles its `display` style between \u0027block\u0027 and \u0027none\u0027 based on the input\u0027s value or checked state.\n   */\n  function handleSubLogicChange(event) {\n    const triggerInput \u003d event.target;\n    const sectionTitleToShow \u003d logicMap[triggerInput.name];\n    if (sectionTitleToShow) {\n        const sectionId \u003d \u0027section-\u0027 + sectionTitleToShow.replace(/\\s|[/?]/g, \u0027-\u0027);\n        const sectionElement \u003d document.getElementById(sectionId);\n        if (sectionElement) {\n            const show \u003d (triggerInput.type \u003d\u003d\u003d \u0027checkbox\u0027) ? triggerInput.checked : (triggerInput.value \u003d\u003d\u003d \u0027Required\u0027 || triggerInput.value \u003d\u003d\u003d \u0027Yes\u0027);\n            sectionElement.style.display \u003d show ? \u0027block\u0027 : \u0027none\u0027;\n        }\n    }\n  }\n\n\n  // --- 3. FORM SUBMISSION ---\n  /**\n   * @description Handles the form\u0027s submit event.\n   * @whatItDoes It gathers all the data from the form, packages it into a single object, and sends it to the server-side `processSubmission` function for processing.\n   * @howItWorks\n   * - It prevents the default browser form submission.\n   * - It creates a `FormData` object and converts it to a plain JavaScript object.\n   * - It has special logic to correctly handle multi-select fields (joining them with \u0027, \u0027) and to format all checkbox values as \"Yes\" or \"No\".\n   * - It calls `google.script.run.processSubmission(data)` and provides success and failure handlers to display the final outcome to the user.\n   */\n  function handleFormSubmit(e) {\n    e.preventDefault(); // Stop the browser from reloading the page.\n    \n    // Provide user feedback.\n    statusMessage.textContent \u003d \u0027Submitting...\u0027;\n    statusMessage.className \u003d \u0027status-info\u0027;\n    \n    const form \u003d e.target;\n    const formData \u003d new FormData(form);\n    const data \u003d {};\n    const multiInputNames \u003d new Set(); // To handle fields with multiple inputs of the same name.\n\n    // Convert FormData to a plain object.\n    for (const [key, value] of formData.entries()) {\n      // Check if this is a multi-input field (e.g., Job Sites).\n      if (form.elements[key] \u0026\u0026 form.elements[key].length \u003e 1 \u0026\u0026 !form.elements[key].nodeName) {\n        if (!multiInputNames.has(key)) {\n          multiInputNames.add(key);\n          const values \u003d formData.getAll(key).filter(v \u003d\u003e v.trim() !\u003d\u003d \u0027\u0027); // Get all values and remove empty ones.\n          if (values.length \u003e 0) data[key] \u003d values.join(\u0027, \u0027); // Join into a single string.\n        }\n      } else { \n        // For single-input fields.\n        data[key] \u003d value; \n      }\n    }\n    \n    // Standardize checkbox values to \u0027Yes\u0027/\u0027No\u0027 for the spreadsheet.\n    form.querySelectorAll(\u0027input[type\u003d\"checkbox\"]\u0027).forEach(cb \u003d\u003e {\n        data[cb.name] \u003d cb.checked ? \u0027Yes\u0027 : \u0027No\u0027;\n    });\n\n    // Send the final data object to the server.\n    google.script.run\n      .withSuccessHandler(response \u003d\u003e {\n        // Handle the server\u0027s response (success or error message).\n        statusMessage.className \u003d response.status \u003d\u003d\u003d \u0027success\u0027 ? \u0027status-success\u0027 : \u0027status-error\u0027;\n        statusMessage.textContent \u003d response.message;\n        if (response.status \u003d\u003d\u003d \u0027success\u0027) {\n          // On success, replace the form with a confirmation message.\n          formContainer.innerHTML \u003d `\u003cdiv style\u003d\"text-align: center; padding: 40px;\"\u003e\u003ch2\u003e${response.message}\u003c/h2\u003e\u003cp\u003eYou may now close this window.\u003c/p\u003e\u003c/div\u003e`;\n        }\n      })\n      .withFailureHandler(err \u003d\u003e {\n        // Handle script execution errors.\n        statusMessage.textContent \u003d \u0027An error occurred: \u0027 + err.message;\n        statusMessage.className \u003d \u0027status-error\u0027;\n      })\n      .processSubmission(data);\n  }\n});\n\u003c/script\u003e"},{"id":"3f9b78f8-e77b-46e7-888d-6ceb2717eb68","name":"Approval","type":"html","source":"\u003c!DOCTYPE html\u003e\n\u003chtml\u003e\n  \u003chead\u003e\n    \u003cbase target\u003d\"_top\"\u003e\n    \u003cscript src\u003d\"https://cdn.tailwindcss.com\"\u003e\u003c/script\u003e\n    \u003clink href\u003d\"https://fonts.googleapis.com/css2?family\u003dInter:wght@400;500;700\u0026display\u003dswap\" rel\u003d\"stylesheet\"\u003e\n  \u003c/head\u003e\n  \u003cbody class\u003d\"bg-gray-100 flex items-center justify-center h-screen\" style\u003d\"font-family: \u0027Inter\u0027, sans-serif;\"\u003e\n    \u003cdiv id\u003d\"main-content\" class\u003d\"bg-white p-10 rounded-lg shadow-lg w-full max-w-lg\"\u003e\n      \u003cdiv style\u003d\"text-align: center; margin-bottom: 20px;\"\u003e\n        \u003cimg src\u003d\"\u003c?\u003d logoUrl ?\u003e\" alt\u003d\"Company Logo\" style\u003d\"max-height: 70px;\"\u003e\n      \u003c/div\u003e\n      \u003ch1 class\u003d\"text-2xl font-bold text-gray-800 text-center\"\u003eApprove \u0026 E-Sign Request\u003c/h1\u003e\n      \u003cp class\u003d\"text-gray-600 mt-2 text-center mb-6\"\u003ePlease type your full name below to electronically sign and approve this request.\u003c/p\u003e\n      \n      \u003cform id\u003d\"approvalForm\"\u003e\n        \u003cinput type\u003d\"hidden\" id\u003d\"approvalId\" name\u003d\"approvalId\" value\u003d\"\u003c?\u003d approvalId ?\u003e\"\u003e\n        \n        \u003cdiv\u003e\n          \u003clabel for\u003d\"managerSignature\" class\u003d\"block text-sm font-medium text-gray-700\"\u003eYour Full Name (E-Signature)*\u003c/label\u003e\n          \u003cdiv class\u003d\"mt-1\"\u003e\n            \u003cinput type\u003d\"text\" id\u003d\"managerSignature\" name\u003d\"managerSignature\" required class\u003d\"w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500\" placeholder\u003d\"e.g., Jane Doe\"\u003e\n          \u003c/div\u003e\n        \u003c/div\u003e\n\n        \u003cdiv class\u003d\"mt-6\"\u003e\n          \u003clabel for\u003d\"additionalComments\" class\u003d\"block text-sm font-medium text-gray-700\"\u003eAdditional Comments (optional)\u003c/label\u003e\n          \u003cdiv class\u003d\"mt-1\"\u003e\n            \u003ctextarea id\u003d\"additionalComments\" name\u003d\"additionalComments\" rows\u003d\"3\" class\u003d\"w-full p-2 border border-gray-300 rounded-md shadow-sm\" placeholder\u003d\"e.g., Approved.\"\u003e\u003c/textarea\u003e\n          \u003c/div\u003e\n        \u003c/div\u003e\n\n        \u003cdiv class\u003d\"mt-6\"\u003e\n          \u003cbutton type\u003d\"submit\" id\u003d\"submitButton\" class\u003d\"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500\"\u003e\n            Approve and Submit Signature\n          \u003c/button\u003e\n        \u003c/div\u003e\n      \u003c/form\u003e\n      \u003cdiv id\u003d\"status\" class\u003d\"mt-4 text-center text-sm\"\u003e\u003c/div\u003e\n    \u003c/div\u003e\n\n    \u003cscript\u003e\n      // Adds an event listener to the form that triggers a function when the form is submitted.\n      document.getElementById(\u0027approvalForm\u0027).addEventListener(\u0027submit\u0027, function(e) {\n        // Prevents the default form submission action, which would reload the page. We handle it with JavaScript instead.\n        e.preventDefault();\n        // Get references to the submit button and the status message div.\n        const submitButton \u003d document.getElementById(\u0027submitButton\u0027);\n        const statusDiv \u003d document.getElementById(\u0027status\u0027);\n        // Disable the button and change its text to give the user feedback that something is happening.\n        submitButton.disabled \u003d true;\n        submitButton.textContent \u003d \u0027Submitting...\u0027;\n\n        // Create an object to hold the data from the form fields.\n        const approvalData \u003d {\n          approvalId: this.approvalId.value,\n          managerSignature: this.managerSignature.value,\n          additionalComments: this.additionalComments.value\n        };\n\n        // This gets the name of the server-side function to call, which is dynamically passed from Google Apps Script.\n        // This makes the HTML template reusable for different types of approvals.\n        const submitFunction \u003d \"\u003c?\u003d submitFunction ?\u003e\";\n\n        // This is the Google Apps Script API to run a server-side function from the client.\n        google.script.run\n          // Defines the callback function to execute if the server-side function completes successfully.\n          .withSuccessHandler(function(response) {\n            // On success, replace the form content with a confirmation message.\n            document.getElementById(\u0027main-content\u0027).innerHTML \u003d \u0027\u003cdiv style\u003d\"text-align: center; margin-bottom: 20px;\"\u003e\u003cimg src\u003d\"\u003c?\u003d logoUrl ?\u003e\" alt\u003d\"Company Logo\" style\u003d\"max-height: 70px;\"\u003e\u003c/div\u003e\u003cdiv class\u003d\"text-center\"\u003e\u003ch1 class\u003d\"text-2xl font-bold text-green-700\"\u003eRequest Approved\u003c/h1\u003e\u003cp class\u003d\"text-gray-600 mt-2\"\u003eThe approval has been processed successfully. You may now close this window.\u003c/p\u003e\u003c/div\u003e\u0027;\n          })\n          // Defines the callback function to execute if the server-side function fails.\n          .withFailureHandler(function(error) {\n            // On failure, display the error message in the status div.\n            statusDiv.textContent \u003d \u0027Error: \u0027 + error.message;\n            statusDiv.className \u003d \u0027mt-4 text-center text-sm text-red-600 font-semibold\u0027;\n            // Re-enable the submit button and reset its text so the user can try again.\n            submitButton.disabled \u003d false;\n            submitButton.textContent \u003d \u0027Approve and Submit Signature\u0027;\n          })\n          // This calls the server-side function. The function name is determined by the \u0027submitFunction\u0027 variable,\n          // and the \u0027approvalData\u0027 object is passed as its argument.\n          [submitFunction](approvalData);\n      });\n    \u003c/script\u003e\n  \u003c/body\u003e\n\u003c/html\u003e"},{"id":"e9c878d8-5bc3-4923-8529-d6e1abd1f701","name":"Denial","type":"html","source":"\u003c!DOCTYPE html\u003e\n\u003chtml\u003e\n  \u003chead\u003e\n    \u003cbase target\u003d\"_top\"\u003e\n    \u003cscript src\u003d\"https://cdn.tailwindcss.com\"\u003e\u003c/script\u003e\n    \u003clink href\u003d\"https://fonts.googleapis.com/css2?family\u003dInter:wght@400;500;700\u0026display\u003dswap\" rel\u003d\"stylesheet\"\u003e\n  \u003c/head\u003e\n  \u003cbody class\u003d\"bg-gray-100 flex items-center justify-center h-screen\" style\u003d\"font-family: \u0027Inter\u0027, sans-serif;\"\u003e\n    \u003cdiv id\u003d\"main-content\" class\u003d\"bg-white p-10 rounded-lg shadow-lg w-full max-w-lg\"\u003e\n      \u003cdiv style\u003d\"text-align: center; margin-bottom: 20px;\"\u003e\n        \u003cimg src\u003d\"\u003c?\u003d logoUrl ?\u003e\" alt\u003d\"Company Logo\" style\u003d\"max-height: 70px;\"\u003e\n      \u003c/div\u003e\n      \u003ch1 class\u003d\"text-2xl font-bold text-gray-800 text-center\"\u003eDeny Request\u003c/h1\u003e\n      \u003cp class\u003d\"text-gray-600 mt-2 text-center mb-6\"\u003ePlease provide a reason for denying this request and sign below. This information will be stored.\u003c/p\u003e\n      \n      \u003cform id\u003d\"denialForm\"\u003e\n        \u003cinput type\u003d\"hidden\" id\u003d\"approvalId\" name\u003d\"approvalId\" value\u003d\"\u003c?\u003d approvalId ?\u003e\"\u003e\n        \n        \u003cdiv\u003e\n          \u003clabel for\u003d\"denialReason\" class\u003d\"block text-sm font-medium text-gray-700\"\u003eDenial Reason*\u003c/label\u003e\n          \u003cdiv class\u003d\"mt-1\"\u003e\n            \u003ctextarea id\u003d\"denialReason\" name\u003d\"denialReason\" rows\u003d\"4\" required class\u003d\"w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-red-500 focus:border-red-500\"\u003e\u003c/textarea\u003e\n          \u003c/div\u003e\n        \u003c/div\u003e\n\n        \u003cdiv class\u003d\"mt-6\"\u003e\n          \u003clabel for\u003d\"managerSignature\" class\u003d\"block text-sm font-medium text-gray-700\"\u003eYour Full Name (E-Signature)*\u003c/label\u003e\n          \u003cdiv class\u003d\"mt-1\"\u003e\n            \u003cinput type\u003d\"text\" id\u003d\"managerSignature\" name\u003d\"managerSignature\" required class\u003d\"w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-red-500 focus:border-red-500\" placeholder\u003d\"e.g., John Doe\"\u003e\n          \u003c/div\u003e\n        \u003c/div\u003e\n\n        \u003cdiv class\u003d\"mt-6\"\u003e\n          \u003cbutton type\u003d\"submit\" id\u003d\"submitButton\" class\u003d\"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500\"\u003e\n            Submit Denial\n          \u003c/button\u003e\n        \u003c/div\u003e\n      \u003c/form\u003e\n      \u003cdiv id\u003d\"status\" class\u003d\"mt-4 text-center text-sm\"\u003e\u003c/div\u003e\n    \u003c/div\u003e\n\n    \u003cscript\u003e\n      // Attaches an event listener to the form that triggers when the user clicks the submit button.\n      document.getElementById(\u0027denialForm\u0027).addEventListener(\u0027submit\u0027, function(e) {\n        // Prevents the default browser behavior for form submission, which is to reload the page.\n        e.preventDefault();\n        // Gets references to the submit button and the status message div.\n        const submitButton \u003d document.getElementById(\u0027submitButton\u0027);\n        const statusDiv \u003d document.getElementById(\u0027status\u0027);\n        // Provides visual feedback to the user by disabling the button and changing its text.\n        submitButton.disabled \u003d true;\n        submitButton.textContent \u003d \u0027Submitting...\u0027;\n\n        // Collects the data from the form fields into a JavaScript object.\n        const denialData \u003d {\n          approvalId: this.approvalId.value,\n          denialReason: this.denialReason.value,\n          managerSignature: this.managerSignature.value\n        };\n        \n        // Gets the name of the server-side function to call, which is passed dynamically from Google Apps Script.\n        // This makes the HTML template reusable.\n        const submitFunction \u003d \"\u003c?\u003d submitFunction ?\u003e\";\n\n        // Calls a server-side Google Apps Script function from the client-side JavaScript.\n        google.script.run\n          // Sets up a success handler: a function to run if the server call is successful.\n          .withSuccessHandler(function(response) {\n            // On success, the form is replaced with a confirmation message.\n            document.getElementById(\u0027main-content\u0027).innerHTML \u003d \u0027\u003cdiv style\u003d\"text-align: center; margin-bottom: 20px;\"\u003e\u003cimg src\u003d\"\u003c?\u003d logoUrl ?\u003e\" alt\u003d\"Company Logo\" style\u003d\"max-height: 70px;\"\u003e\u003c/div\u003e\u003cdiv class\u003d\"text-center\"\u003e\u003ch1 class\u003d\"text-2xl font-bold text-red-700\"\u003eRequest Denied\u003c/h1\u003e\u003cp class\u003d\"text-gray-600 mt-2\"\u003eThe denial has been processed successfully. You may now close this window.\u003c/p\u003e\u003c/div\u003e\u0027;\n          })\n          // Sets up a failure handler: a function to run if the server call fails.\n          .withFailureHandler(function(error) {\n            // On failure, an error message is displayed in the status div.\n            statusDiv.textContent \u003d \u0027Error: \u0027 + error.message;\n            statusDiv.className \u003d \u0027mt-4 text-center text-sm text-red-600 font-semibold\u0027;\n            // The submit button is re-enabled and its text is reset so the user can try again.\n            submitButton.disabled \u003d false;\n            submitButton.textContent \u003d \u0027Submit Denial\u0027;\n          })\n          // Executes the server-side function whose name is stored in the \u0027submitFunction\u0027 variable,\n          // passing the \u0027denialData\u0027 object as an argument.\n          [submitFunction](denialData);\n      });\n    \u003c/script\u003e\n  \u003c/body\u003e\n\u003c/html\u003e"},{"id":"60b87f27-0ea5-49e5-8f7f-56c3ccd95e8f","name":"SendBack","type":"html","source":"\u003c!DOCTYPE html\u003e\n\u003chtml\u003e\n  \u003chead\u003e\n    \u003cbase target\u003d\"_top\"\u003e\n    \u003cscript src\u003d\"https://cdn.tailwindcss.com\"\u003e\u003c/script\u003e\n    \u003clink href\u003d\"https://fonts.googleapis.com/css2?family\u003dInter:wght@400;500;700\u0026display\u003dswap\" rel\u003d\"stylesheet\"\u003e\n  \u003c/head\u003e\n  \u003cbody class\u003d\"bg-gray-100 flex items-center justify-center h-screen\" style\u003d\"font-family: \u0027Inter\u0027, sans-serif;\"\u003e\n    \u003cdiv id\u003d\"main-content\" class\u003d\"bg-white p-10 rounded-lg shadow-lg w-full max-w-lg\"\u003e\n      \u003cdiv style\u003d\"text-align: center; margin-bottom: 20px;\"\u003e\n        \u003cimg src\u003d\"\u003c?\u003d logoUrl ?\u003e\" alt\u003d\"Company Logo\" style\u003d\"max-height: 70px;\"\u003e\n      \u003c/div\u003e\n      \u003ch1 class\u003d\"text-2xl font-bold text-gray-800 text-center\"\u003eSend Back for Edits\u003c/h1\u003e\n      \u003cp class\u003d\"text-gray-600 mt-2 text-center mb-6\"\u003ePlease provide the reason(s) this request needs to be revised. This information will be sent to the original requester.\u003c/p\u003e\n      \n      \u003cform id\u003d\"sendBackForm\"\u003e\n        \u003cinput type\u003d\"hidden\" id\u003d\"requestId\" name\u003d\"requestId\" value\u003d\"\u003c?\u003d requestId ?\u003e\"\u003e\n        \n        \u003cdiv\u003e\n          \u003clabel for\u003d\"reason\" class\u003d\"block text-sm font-medium text-gray-700\"\u003eReason for Sending Back*\u003c/label\u003e\n          \u003cdiv class\u003d\"mt-1\"\u003e\n            \u003ctextarea id\u003d\"reason\" name\u003d\"reason\" rows\u003d\"4\" required class\u003d\"w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-yellow-500 focus:border-yellow-500\"\u003e\u003c/textarea\u003e\n          \u003c/div\u003e\n        \u003c/div\u003e\n\n        \u003cdiv class\u003d\"mt-6\"\u003e\n          \u003cbutton type\u003d\"submit\" id\u003d\"submitButton\" class\u003d\"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-black bg-yellow-400 hover:bg-yellow-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-yellow-500\"\u003e\n            Submit Feedback to Requester\n          \u003c/button\u003e\n        \u003c/div\u003e\n      \u003c/form\u003e\n      \u003cdiv id\u003d\"status\" class\u003d\"mt-4 text-center text-sm\"\u003e\u003c/div\u003e\n    \u003c/div\u003e\n\n    \u003cscript\u003e\n      document.getElementById(\u0027sendBackForm\u0027).addEventListener(\u0027submit\u0027, function(e) {\n        e.preventDefault();\n        const submitButton \u003d document.getElementById(\u0027submitButton\u0027);\n        const statusDiv \u003d document.getElementById(\u0027status\u0027);\n        submitButton.disabled \u003d true;\n        submitButton.textContent \u003d \u0027Submitting...\u0027;\n\n        const feedbackData \u003d {\n          requestId: this.requestId.value,\n          reason: this.reason.value,\n        };\n\n        google.script.run\n          .withSuccessHandler(function(response) {\n            document.getElementById(\u0027main-content\u0027).innerHTML \u003d \u0027\u003cdiv style\u003d\"text-align: center; margin-bottom: 20px;\"\u003e\u003cimg src\u003d\"\u003c?\u003d logoUrl ?\u003e\" alt\u003d\"Company Logo\" style\u003d\"max-height: 70px;\"\u003e\u003c/div\u003e\u003cdiv class\u003d\"text-center\"\u003e\u003ch1 class\u003d\"text-2xl font-bold text-yellow-600\"\u003eRequest Sent Back\u003c/h1\u003e\u003cp class\u003d\"text-gray-600 mt-2\"\u003eThe requester has been notified to edit their submission. You may now close this window.\u003c/p\u003e\u003c/div\u003e\u0027;\n          })\n          .withFailureHandler(function(error) {\n            statusDiv.textContent \u003d \u0027Error: \u0027 + error.message;\n            statusDiv.className \u003d \u0027mt-4 text-center text-sm text-red-600 font-semibold\u0027;\n            submitButton.disabled \u003d false;\n            submitButton.textContent \u003d \u0027Submit Feedback to Requester\u0027;\n          })\n          .processSendBack(feedbackData);\n      });\n    \u003c/script\u003e\n  \u003c/body\u003e\n\u003c/html\u003e"},{"id":"f0e03d5b-ccff-4b71-867f-f43a91251ffc","name":"HR","type":"html","source":"\u003c!DOCTYPE html\u003e\n\u003chtml\u003e\n  \u003chead\u003e\n    \u003cbase target\u003d\"_top\"\u003e\n    \u003c?!\u003d HtmlService.createHtmlOutputFromFile(\u0027CSS.html\u0027).getContent(); ?\u003e\n  \u003c/head\u003e\n  \u003cbody\u003e\n    \u003cdiv class\u003d\"container\"\u003e\n      \u003cdiv style\u003d\"text-align: center; margin-bottom: 20px;\"\u003e\n        \u003cimg src\u003d\"\u003c?\u003d logoUrl ?\u003e\" alt\u003d\"Company Logo\" style\u003d\"max-height: 70px;\"\u003e\n      \u003c/div\u003e\n      \u003cdiv id\u003d\"form-container\"\u003e\n        \u003cdiv class\u003d\"loader\"\u003eLoading Request Data...\u003c/div\u003e\n      \u003c/div\u003e\n      \u003cdiv id\u003d\"status-message\"\u003e\u003c/div\u003e\n    \u003c/div\u003e\n\n    \u003cscript\u003e\n      document.addEventListener(\u0027DOMContentLoaded\u0027, function() {\n        const formContainer \u003d document.getElementById(\u0027form-container\u0027);\n        const statusMessage \u003d document.getElementById(\u0027status-message\u0027);\n        const requestId \u003d \"\u003c?\u003d requestId ?\u003e\";\n\n        google.script.run\n          .withSuccessHandler(buildHrForm)\n          .withFailureHandler(onFailure)\n          .getHrRequestData(requestId);\n          \n        function buildHrForm(data) {\n          if (!data) {\n            onFailure({ message: `Could not find a request with the ID \"${requestId}\". The link may be invalid or the request may have been deleted.` });\n            return;\n          }\n\n          let siteDocsFields \u003d \u0027\u0027;\n          if (data[\u0027SiteDocs\u0027] \u003d\u003d\u003d \u0027Yes\u0027) {\n            siteDocsFields \u003d `\n              \u003ch3\u003eSiteDocs\u003c/h3\u003e\n              \u003cdiv class\u003d\"question-wrapper\"\u003e\n                \u003clabel\u003eSiteDocs Worker ID\u003c/label\u003e\n                \u003cinput type\u003d\"text\" class\u003d\"form-control\" name\u003d\"HR - SiteDocs Worker ID\" required\u003e\n              \u003c/div\u003e\n              \u003cdiv class\u003d\"question-wrapper\"\u003e\n                \u003clabel\u003eSiteDocs Training Username\u003c/label\u003e\n                \u003cinput type\u003d\"text\" class\u003d\"form-control\" name\u003d\"HR - SiteDocs Training Username\" required\u003e\n              \u003c/div\u003e\n              \u003cdiv class\u003d\"question-wrapper\"\u003e\n                \u003clabel\u003eSiteDocs Training Password\u003c/label\u003e\n                \u003cinput type\u003d\"text\" class\u003d\"form-control\" name\u003d\"HR - SiteDocs Training Password\" required\u003e\n              \u003c/div\u003e\n            `;\n          }\n          \n          formContainer.innerHTML \u003d `\n            \u003ch1\u003eEmployee Setup Form\u003c/h1\u003e\n            \u003ch3\u003eRequest for: ${data[\u0027First Name\u0027]} ${data[\u0027Last Name\u0027]} (Temporary ID: ${data[\u0027Temporary ID\u0027]})\u003c/h3\u003e\n            \u003cdiv style\u003d\"margin-top:-5px; margin-bottom: 15px; color: #555; font-size: 0.9em; border-left: 3px solid #ccc; padding-left: 10px;\"\u003e\n                \u003cp\u003e\u003cb\u003eRequested Email:\u003c/b\u003e ${data[\u0027Email Requested\u0027] || \u0027Not Specified\u0027}\u003c/p\u003e\n                \u003cp\u003e\u003cb\u003eRequester:\u003c/b\u003e ${data[\u0027Requester Name\u0027] || \u0027Not Specified\u0027} (${data[\u0027Requester Email\u0027] || \u0027N/A\u0027})\u003c/p\u003e\n                \u003cp\u003e\u003cb\u003eReporting Manager:\u003c/b\u003e ${data[\u0027Reporting Manager Name\u0027] || \u0027Not Specified\u0027} (${data[\u0027Reporting Manager Email \u0027] || \u0027N/A\u0027})\u003c/p\u003e\n            \u003c/div\u003e\n            \u003cp\u003ePlease enroll the new hire and complete the access details below.\u003c/p\u003e\n            \u003chr\u003e\n            \u003cform id\u003d\"hr-form\"\u003e\n              \u003cinput type\u003d\"hidden\" name\u003d\"formType\" value\u003d\"hr\"\u003e\n              \u003cinput type\u003d\"hidden\" name\u003d\"Request ID\" value\u003d\"${requestId}\"\u003e\n\n              ${siteDocsFields}\n\n              \u003ch3\u003eAccess Details\u003c/h3\u003e\n              \u003cdiv class\u003d\"question-wrapper\"\u003e\n                \u003clabel\u003eDSS Username\u003c/label\u003e\n                \u003cinput type\u003d\"text\" class\u003d\"form-control\" name\u003d\"HR - DSS Username\" value\u003d\"${data.generatedDssUsername || \u0027\u0027}\" required\u003e\n              \u003c/div\u003e\n              \u003cdiv class\u003d\"question-wrapper\"\u003e\n                \u003clabel\u003eDSS Password\u003c/label\u003e\n                \u003cinput type\u003d\"text\" class\u003d\"form-control\" name\u003d\"HR - DSS Password\" required\u003e\n              \u003c/div\u003e\n              \u003cdiv class\u003d\"question-wrapper\"\u003e\n                \u003clabel\u003eEmployee assigned to WIS module?\u003c/label\u003e\n                \u003cselect class\u003d\"form-control\" name\u003d\"HR - Employee assigned to WIS module?\" required\u003e\n                    \u003coption value\u003d\"\"\u003e--Please Select--\u003c/option\u003e\n                    \u003coption value\u003d\"Yes\"\u003eYes\u003c/option\u003e\n                    \u003coption value\u003d\"No\"\u003eNo\u003c/option\u003e\n                \u003c/select\u003e\n              \u003c/div\u003e\n\n              \u003chr\u003e\n              \u003ch3\u003eSignoff\u003c/h3\u003e\n              \u003cdiv class\u003d\"question-wrapper\"\u003e\n                \u003clabel\u003eAdditional Comments/Notes\u003c/label\u003e\n                \u003ctextarea class\u003d\"form-control\" name\u003d\"HR - Additional Comments\"\u003e\u003c/textarea\u003e\n              \u003c/div\u003e\n              \u003cdiv class\u003d\"question-wrapper\"\u003e\n                \u003clabel\u003eAuthorizer Name\u003c/label\u003e\n                \u003cinput type\u003d\"text\" class\u003d\"form-control\" name\u003d\"HR - Team Member Name\" value\u003d\"Jennifer\" required\u003e\n              \u003c/div\u003e\n              \u003cdiv id\u003d\"submit-container\"\u003e\n                \u003cbutton type\u003d\"submit\"\u003eSubmit\u003c/button\u003e\n              \u003c/div\u003e\n            \u003c/form\u003e`;\n          document.getElementById(\u0027hr-form\u0027).addEventListener(\u0027submit\u0027, handleFormSubmit);\n        }\n        \n        function onFailure(error) {\n          formContainer.innerHTML \u003d `\u003ch1\u003eError\u003c/h1\u003e\u003cp\u003e${error.message}\u003c/p\u003e`;\n        }\n\n        function handleFormSubmit(e) {\n          e.preventDefault();\n          statusMessage.textContent \u003d \u0027Submitting...\u0027;\n          statusMessage.className \u003d \u0027status-info\u0027;\n          const form \u003d e.target;\n          const formData \u003d new FormData(form);\n          const data \u003d Object.fromEntries(formData.entries());\n\n          google.script.run\n            .withSuccessHandler(response \u003d\u003e {\n              if (response.status \u003d\u003d\u003d \u0027success\u0027) {\n                formContainer.innerHTML \u003d `\u003cdiv style\u003d\"text-align: center; padding: 40px;\"\u003e\u003ch2\u003e${response.message}\u003c/h2\u003e\u003cp\u003eYou may now close this window.\u003c/p\u003e\u003c/div\u003e`;\n                statusMessage.innerHTML \u003d \u0027\u0027;\n              } else {\n                statusMessage.className \u003d \u0027status-error\u0027;\n                statusMessage.textContent \u003d response.message;\n              }\n            })\n            .withFailureHandler(onFailure)\n            .processSubmission(data);\n        }\n      });\n    \u003c/script\u003e\n  \u003c/body\u003e\n\u003c/html\u003e"},{"id":"900df802-da4a-4d27-9f89-a428b07b74ff","name":"Closed","type":"html","source":"\u003c!DOCTYPE html\u003e\n\u003chtml\u003e\n  \u003chead\u003e\n    \u003cbase target\u003d\"_top\"\u003e\n    \u003cscript src\u003d\"https://cdn.tailwindcss.com\"\u003e\u003c/script\u003e\n    \u003clink href\u003d\"https://fonts.googleapis.com/css2?family\u003dInter:wght@400;500;700\u0026display\u003dswap\" rel\u003d\"stylesheet\"\u003e\n  \u003c/head\u003e\n  \u003cbody class\u003d\"bg-gray-100 flex items-center justify-center h-screen\" style\u003d\"font-family: \u0027Inter\u0027, sans-serif;\"\u003e\n    \u003cdiv class\u003d\"bg-white p-10 rounded-lg shadow-lg w-full max-w-lg text-center\"\u003e\n      \u003cdiv style\u003d\"text-align: center; margin-bottom: 20px;\"\u003e\n        \u003cimg src\u003d\"\u003c?\u003d logoUrl ?\u003e\" alt\u003d\"Company Logo\" style\u003d\"max-height: 70px;\"\u003e\n      \u003c/div\u003e\n      \u003ch1 class\u003d\"text-2xl font-bold text-gray-800\"\u003eLink Expired or Action Not Available\u003c/h1\u003e\n      \n      \u003c? if (status) { ?\u003e\n        \u003cp class\u003d\"text-gray-600 mt-4\"\u003eThis action cannot be completed because the request\u0027s current status is: \u003cstrong class\u003d\"font-bold\"\u003e\u003c?\u003d status ?\u003e\u003c/strong\u003e.\u003c/p\u003e\n      \u003c? } else { ?\u003e\n        \u003cp class\u003d\"text-gray-600 mt-4\"\u003eThis request has already been processed and is now closed.\u003c/p\u003e\n      \u003c? } ?\u003e\n\n      \u003cp class\u003d\"text-gray-600 mt-2\"\u003eNo further action can be taken from this link. You may now close this window.\u003c/p\u003e\n    \u003c/div\u003e\n  \u003c/body\u003e\n\u003c/html\u003e"},{"id":"2f8f4728-2e59-4ecf-842c-c6ac7049ec1b","name":"ITSetup","type":"html","source":"\u003c!DOCTYPE html\u003e\n\u003chtml\u003e\n  \u003chead\u003e\n    \u003cbase target\u003d\"_top\"\u003e\n    \u003c?!\u003d HtmlService.createHtmlOutputFromFile(\u0027CSS.html\u0027).getContent(); ?\u003e\n    \u003cstyle\u003e\n      /* Styles for the checkbox question container to align label and input side-by-side. */\n      .checkbox-question { display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px; }\n      /* Removes the default bottom margin from the label within the flex container. */\n      .checkbox-question label { margin-bottom: 0; }\n      /* Sets a fixed larger size for the checkbox inputs for better visibility and usability. */\n      .checkbox-question input { width: auto; height: 1.5rem; width: 1.5rem; }\n    \u003c/style\u003e\n  \u003c/head\u003e\n  \u003cbody\u003e\n    \u003cdiv class\u003d\"container\"\u003e\n       \u003cdiv style\u003d\"text-align: center; margin-bottom: 20px;\"\u003e\n        \u003cimg src\u003d\"\u003c?\u003d logoUrl ?\u003e\" alt\u003d\"Company Logo\" style\u003d\"max-height: 70px;\"\u003e\n      \u003c/div\u003e\n      \u003cdiv id\u003d\"form-container\"\u003e\n        \u003cdiv class\u003d\"loader\"\u003eLoading Request Data...\u003c/div\u003e\n      \u003c/div\u003e\n      \u003cdiv id\u003d\"status-message\"\u003e\u003c/div\u003e\n    \u003c/div\u003e\n\n    \u003cscript\u003e\n      // Adds an event listener that runs the enclosed function once the entire HTML document has been loaded and parsed.\n      document.addEventListener(\u0027DOMContentLoaded\u0027, function() {\n        // Get references to the main form container and the status message element.\n        const formContainer \u003d document.getElementById(\u0027form-container\u0027);\n        const statusMessage \u003d document.getElementById(\u0027status-message\u0027);\n        // The unique ID for the request is injected here from the server-side Google Apps Script.\n        const requestId \u003d \"\u003c?\u003d requestId ?\u003e\";\n\n        // Call a server-side function to fetch the data needed to build the form.\n        google.script.run\n          // If the server call is successful, run the \u0027buildItForm\u0027 function with the returned data.\n          .withSuccessHandler(buildItForm)\n          // If the server call fails, run the \u0027onFailure\u0027 function with the error object.\n          .withFailureHandler(onFailure)\n          // The name of the server-side function to call, passing the requestId as an argument.\n          .getItSetupData(requestId);\n          \n        /**\n         * Dynamically builds the IT setup form based on data fetched from the server.\n         * @param {object} data - The data for the specific request, usually a row from a Google Sheet.\n         */\n        function buildItForm(data) {\n          // Log the received data to the browser console for debugging purposes.\n          console.log(\"Data received for IT form:\", data);\n          // Check if any data was returned. If not, the request ID might be invalid.\n          if (!data) {\n            onFailure({ message: `Could not find a request with the ID \"${requestId}\". The link may be invalid.` });\n            return; // Stop the function execution.\n          }\n          \n          // Use a template literal to create the basic HTML structure of the form.\n          // Data from the server (e.g., names, emails) is used to populate the header.\n          let formHtml \u003d `\n            \u003ch1\u003eIT Setup Form\u003c/h1\u003e\n            \u003ch3\u003eRequest for: ${data[\u0027First Name\u0027]} ${data[\u0027Last Name\u0027]} (Temporary ID: ${data[\u0027Temporary ID\u0027]})\u003c/h3\u003e\n            \u003cdiv style\u003d\"margin-top:-5px; margin-bottom: 15px; color: #555; font-size: 0.9em; border-left: 3px solid #ccc; padding-left: 10px;\"\u003e\n                \u003cp\u003e\u003cb\u003eRequested Email:\u003c/b\u003e ${data[\u0027Email Requested\u0027] || \u0027Not Specified\u0027}\u003c/p\u003e\n                \u003cp\u003e\u003cb\u003eRequester:\u003c/b\u003e ${data[\u0027Requester Name\u0027] || \u0027Not Specified\u0027} (${data[\u0027Requester Email\u0027] || \u0027N/A\u0027})\u003c/p\u003e\n                \u003cp\u003e\u003cb\u003eReporting Manager:\u003c/b\u003e ${data[\u0027Reporting Manager Name\u0027] || \u0027Not Specified\u0027} (${data[\u0027Reporting Manager Email \u0027] || \u0027N/A\u0027})\u003c/p\u003e\n            \u003c/div\u003e\n            \u003cp\u003ePlease complete the setup for the required items below.\u003c/p\u003e\n            \u003chr\u003e\n            \u003cform id\u003d\"it-form\"\u003e\n              \u003cinput type\u003d\"hidden\" name\u003d\"formType\" value\u003d\"it\"\u003e\n              \u003cinput type\u003d\"hidden\" name\u003d\"Request ID\" value\u003d\"${requestId}\"\u003e\n              \u003cdiv id\u003d\"it-form-content\"\u003e\u003c/div\u003e\n              \u003cdiv id\u003d\"submit-container\" style\u003d\"margin-top: 20px;\"\u003e\n                \u003cbutton type\u003d\"submit\"\u003eSubmit\u003c/button\u003e\n              \u003c/div\u003e\n            \u003c/form\u003e`;\n            \n          // Inject the basic form structure into the page.\n          formContainer.innerHTML \u003d formHtml;\n          // Get a reference to the container where the form questions will be added.\n          const itFormContent \u003d document.getElementById(\u0027it-form-content\u0027);\n\n          // A configuration object that defines all possible sections and questions for the IT form.\n          // The keys (e.g., \u0027BOSS User Account\u0027) match column headers in the source Google Sheet.\n          const sections \u003d {\n            \u0027BOSS\u0027: {\n                \u0027BOSS User Account\u0027: { label: \u0027BOSS User Account\u0027, type: \u0027checkbox\u0027 },\n                \u0027Cost Sheet\u0027: { label: \u0027Cost Sheet\u0027, type: \u0027checkbox\u0027 },\n                \u0027Leader Access\u0027: { label: \u0027Leader Access\u0027, type: \u0027checkbox\u0027 },\n                \u0027Trip Reports Access\u0027: { label: \u0027Trip Reports Access\u0027, type: \u0027checkbox\u0027 }\n            },\n            \u0027Additional\u0027: {\n                \u0027Incidents\u0027: { label: \u0027Incidents\u0027, type: \u0027checkbox\u0027 },\n                \u0027CAA\u0027: { label: \u0027CAA\u0027, type: \u0027checkbox\u0027 },\n                \u0027Transform\u0027: { label: \u0027Transform\u0027, type: \u0027checkbox\u0027 },\n                \u0027Net Promoter Score\u0027: { label: \u0027Net Promoter Score\u0027, type: \u0027checkbox\u0027 },\n                \u0027Delivery App\u0027: { label: \u0027Delivery App\u0027, type: \u0027checkbox\u0027 },\n                \u0027E-Business Card\u0027: { label: \u0027E-Business Card\u0027, type: \u0027checkbox\u0027 }\n            },\n            \u0027Google Account\u0027: {\n                \u0027Google Account\u0027: [\n                    { label: \u0027Google Account Email\u0027, type: \u0027text\u0027, name: \u0027IT - Google Account Email\u0027 },\n                    { label: \u0027Google Account Password\u0027, type: \u0027text\u0027, name: \u0027IT - Google Account Password\u0027 }\n                ]\n            },\n            \u0027Phone\u0027: {\n                \u0027Mobile Phone\u0027: [\n                    { label: \u0027Phone Number\u0027, type: \u0027text\u0027, name: \u0027IT - Phone Number\u0027 },\n                    { label: \u0027Phone Voicemail Password\u0027, type: \u0027text\u0027, name: \u0027IT - Phone Voicemail Password\u0027 }\n                ]\n            },\n            \u0027Computer\u0027: {\n                \u0027Computer\u0027: [\n                    { label: \u0027Computer Model\u0027, type: \u0027text\u0027, name: \u0027IT - Computer Model\u0027 },\n                    { label: \u0027Computer Serial Number\u0027, type: \u0027text\u0027, name: \u0027IT - Computer Serial Number\u0027 }\n                ]\n            }\n          };\n          \n          // Build the form content dynamically based on the received data.\n          let formContentHtml \u003d \u0027\u0027;\n          // Loop through each section defined in the configuration object.\n          for (const sectionTitle in sections) {\n              let sectionHtml \u003d \u0027\u0027;\n              const questions \u003d sections[sectionTitle];\n              // Loop through each question within the section.\n              for (const key in questions) {\n                  // CRITICAL LOGIC: Only add a question to the form if the corresponding column in the spreadsheet for this request is \u0027Yes\u0027.\n                  if (data[key] \u003d\u003d\u003d \u0027Yes\u0027) {\n                      const item \u003d questions[key];\n                      // If the question is an array, it means it\u0027s a group of text inputs.\n                      if (Array.isArray(item)) {\n                          item.forEach(q \u003d\u003e sectionHtml +\u003d createTextInput(q.label, q.name));\n                      } else { // Otherwise, it\u0027s a single checkbox.\n                          sectionHtml +\u003d createCheckbox(item.label, `IT - ${key}`);\n                      }\n                  }\n              }\n              // If any questions were added for this section, add the section title and its questions to the final HTML.\n              if (sectionHtml !\u003d\u003d \u0027\u0027) {\n                  formContentHtml +\u003d `\u003ch3\u003e${sectionTitle}\u003c/h3\u003e${sectionHtml}\u003chr\u003e`;\n              }\n          }\n          // Inject the generated questions into the form content area.\n          itFormContent.innerHTML \u003d formContentHtml;\n\n          // Now that the form exists in the DOM, add a submit event listener to it.\n          document.getElementById(\u0027it-form\u0027).addEventListener(\u0027submit\u0027, handleFormSubmit);\n        }\n\n        /**\n         * Helper function to create the HTML string for a checkbox input.\n         * @param {string} label - The text label for the checkbox.\n         * @param {string} name - The name attribute for the input element.\n         * @returns {string} The HTML string for the checkbox question.\n         */\n        function createCheckbox(label, name) {\n            return `\u003cdiv class\u003d\"checkbox-question\"\u003e\u003clabel for\u003d\"${name}\"\u003e${label}:\u003c/label\u003e\u003cinput type\u003d\"checkbox\" id\u003d\"${name}\" name\u003d\"${name}\" value\u003d\"Complete\" required\u003e\u003c/div\u003e`;\n        }\n        \n        /**\n         * Helper function to create the HTML string for a text input.\n         * @param {string} label - The text label for the input.\n         * @param {string} name - The name attribute for the input element.\n         * @returns {string} The HTML string for the text input question.\n         */\n        function createTextInput(label, name) {\n            return `\u003cdiv class\u003d\"question-wrapper\"\u003e\u003clabel\u003e${label}\u003c/label\u003e\u003cinput type\u003d\"text\" class\u003d\"form-control\" name\u003d\"${name}\" required\u003e\u003c/div\u003e`;\n        }\n        \n        /**\n         * Generic failure handler function that displays an error message on the page.\n         * @param {Error} error - The error object returned from the server.\n         */\n        function onFailure(error) {\n          formContainer.innerHTML \u003d `\u003ch1\u003eError\u003c/h1\u003e\u003cp\u003e${error.message}\u003c/p\u003e`;\n        }\n\n        /**\n         * Handles the form submission event.\n         * @param {Event} e - The form submission event object.\n         */\n        function handleFormSubmit(e) {\n          // Prevent the default form submission behavior (which would cause a page reload).\n          e.preventDefault();\n          // Provide visual feedback to the user.\n          statusMessage.textContent \u003d \u0027Submitting...\u0027;\n          statusMessage.className \u003d \u0027status-info\u0027;\n          const form \u003d e.target;\n          // Use the FormData API to easily collect all form data.\n          const formData \u003d new FormData(form);\n          // Convert the FormData object into a plain JavaScript object.\n          const data \u003d Object.fromEntries(formData.entries());\n\n          // Unchecked checkboxes are not included by FormData, so we loop through them manually\n          // to ensure every checkbox has a value (\u0027Complete\u0027 or \u0027Incomplete\u0027) in the submitted data.\n          form.querySelectorAll(\u0027input[type\u003dcheckbox]\u0027).forEach(cb \u003d\u003e {\n            data[cb.name] \u003d cb.checked ? \u0027Complete\u0027 : \u0027Incomplete\u0027;\n          });\n\n          // Send the collected form data to the server for processing.\n          google.script.run\n            .withSuccessHandler(response \u003d\u003e {\n              // The server sends back a response object with a status.\n              if (response.status \u003d\u003d\u003d \u0027success\u0027) {\n                // If successful, replace the form with a success message.\n                formContainer.innerHTML \u003d `\u003cdiv style\u003d\"text-align: center; padding: 40px;\"\u003e\u003ch2\u003e${response.message}\u003c/h2\u003e\u003cp\u003eYou may now close this window.\u003c/p\u003e\u003c/div\u003e`;\n                statusMessage.innerHTML \u003d \u0027\u0027;\n              } else {\n                // If the server indicates an error, display the error message.\n                statusMessage.className \u003d \u0027status-error\u0027;\n                statusMessage.textContent \u003d response.message;\n              }\n            })\n            // If the call to the server fails entirely, use the generic failure handler.\n            .withFailureHandler(onFailure)\n            // The name of the server-side function to handle the submission.\n            .processSubmission(data);\n        }\n      });\n    \u003c/script\u003e\n  \u003c/body\u003e\n\u003c/html\u003e"},{"id":"6ca5ce80-772c-4f92-83c5-fe6861cfaadb","name":"ParallelTaskForm","type":"html","source":"\u003c!DOCTYPE html\u003e\n\u003chtml\u003e\n  \u003chead\u003e\n    \u003cbase target\u003d\"_top\"\u003e\n    \u003c?!\u003d HtmlService.createHtmlOutputFromFile(\u0027CSS.html\u0027).getContent(); ?\u003e\n  \u003c/head\u003e\n  \u003cbody\u003e\n    \u003cdiv class\u003d\"container\"\u003e\n      \u003cdiv style\u003d\"text-align: center; margin-bottom: 20px;\"\u003e\n        \u003cimg src\u003d\"\u003c?\u003d logoUrl ?\u003e\" alt\u003d\"Company Logo\" style\u003d\"max-height: 70px;\"\u003e\n      \u003c/div\u003e\n      \u003cdiv id\u003d\"form-container\"\u003e\n          \u003ch1\u003e\u003c?\u003d formTitle ?\u003e\u003c/h1\u003e\n          \u003ch3\u003eRequest for: \u003c?\u003d employeeName ?\u003e (Temporary ID: \u003c?\u003d employeeId ?\u003e)\u003c/h3\u003e\n          \u003cp\u003ePlease confirm once the setup for this item has been completed.\u003c/p\u003e\n          \u003chr\u003e\n          \u003cform id\u003d\"parallel-task-form\"\u003e\n              \u003cinput type\u003d\"hidden\" name\u003d\"formType\" value\u003d\"parallel_task_submission\"\u003e\n              \u003cinput type\u003d\"hidden\" name\u003d\"requestId\" value\u003d\"\u003c?\u003d requestId ?\u003e\"\u003e\n              \u003cinput type\u003d\"hidden\" name\u003d\"statusColumn\" value\u003d\"\u003c?\u003d statusColumn ?\u003e\"\u003e\n              \n              \u003cdiv class\u003d\"question-wrapper\" style\u003d\"display: flex; align-items: center; gap: 15px;\"\u003e\n                  \u003cinput type\u003d\"checkbox\" id\u003d\"isComplete\" name\u003d\"isComplete\" style\u003d\"width: 20px; height: 20px;\" required\u003e\n                  \u003clabel for\u003d\"isComplete\" style\u003d\"margin: 0; font-size: 1.2em;\"\u003eHas this setup been completed?\u003c/label\u003e\n              \u003c/div\u003e\n\n              \u003cdiv id\u003d\"submit-container\"\u003e\n                  \u003cbutton type\u003d\"submit\"\u003eSubmit Confirmation\u003c/button\u003e\n              \u003c/div\u003e\n          \u003c/form\u003e\n      \u003c/div\u003e\n      \u003cdiv id\u003d\"status-message\"\u003e\u003c/div\u003e\n    \u003c/div\u003e\n\n    \u003cscript\u003e\n      // Adds an event listener to the form that triggers when the \u0027submit\u0027 event occurs (i.e., the submit button is clicked).\n      document.getElementById(\u0027parallel-task-form\u0027).addEventListener(\u0027submit\u0027, function(e) {\n        // Prevents the default form submission behavior, which would cause the page to reload. We handle submission with JavaScript.\n        e.preventDefault();\n        // Get a reference to the form element that triggered the event.\n        const form \u003d e.target;\n        // Provide immediate feedback to the user that the form is being processed.\n        form.querySelector(\u0027button[type\u003d\"submit\"]\u0027).textContent \u003d \u0027Submitting...\u0027;\n        // Disable the button to prevent multiple submissions while the current one is in progress.\n        form.querySelector(\u0027button[type\u003d\"submit\"]\u0027).disabled \u003d true;\n\n        // Create an object to hold the form data that will be sent to the server-side Google Apps Script function.\n        const formData \u003d {\n            formType: form.formType.value,\n            requestId: form.requestId.value,\n            statusColumn: form.statusColumn.value,\n            // **MODIFIED:** Now sends \u0027statusValue\u0027 for the generic handler\n            // Ternary operator checks if the \u0027isComplete\u0027 checkbox is checked.\n            // If it is, set \u0027statusValue\u0027 to \u0027Complete\u0027; otherwise, set it to \u0027Incomplete\u0027.\n            statusValue: form.isComplete.checked ? \u0027Complete\u0027 : \u0027Incomplete\u0027\n        };\n\n        // This is the core of client-server communication in Google Apps Script.\n        // It calls a server-side function from the client-side JavaScript.\n        google.script.run\n            // Defines a function to run if the server-side call is successful.\n            .withSuccessHandler(function(response) {\n                // On success, replace the form content with a confirmation message.\n                document.getElementById(\u0027form-container\u0027).innerHTML \u003d `\u003ch1\u003eConfirmation Received\u003c/h1\u003e\u003cp\u003eThank you, the status has been updated. You may now close this window.\u003c/p\u003e`;\n            })\n            // Defines a function to run if the server-side call fails.\n            .withFailureHandler(function(error) {\n                // On failure, get the status message element to display the error.\n                const statusMessage \u003d document.getElementById(\u0027status-message\u0027);\n                statusMessage.className \u003d \u0027status-error\u0027; // Apply error styling.\n                statusMessage.textContent \u003d \u0027Error: \u0027 + error.message; // Show the error message.\n                // Re-enable the form for another attempt.\n                form.querySelector(\u0027button[type\u003d\"submit\"]\u0027).textContent \u003d \u0027Submit Confirmation\u0027;\n                form.querySelector(\u0027button[type\u003d\"submit\"]\u0027).disabled \u003d false;\n            })\n            // The actual server-side function to call, passing the \u0027formData\u0027 object as an argument.\n            .handleParallelTaskSubmission(formData);\n      });\n    \u003c/script\u003e\n  \u003c/body\u003e\n\u003c/html\u003e"},{"id":"a4525e65-7b96-4c09-b7a7-6b29f2f7f834","name":"FleetioForm","type":"html","source":"\u003c!DOCTYPE html\u003e\n\u003chtml\u003e\n  \u003chead\u003e\n    \u003cbase target\u003d\"_top\"\u003e\n    \u003c?!\u003d HtmlService.createHtmlOutputFromFile(\u0027CSS.html\u0027).getContent(); ?\u003e\n  \u003c/head\u003e\n  \u003cbody\u003e\n    \u003cdiv class\u003d\"container\"\u003e\n      \u003cdiv style\u003d\"text-align: center; margin-bottom: 20px;\"\u003e\n        \u003cimg src\u003d\"\u003c?\u003d logoUrl ?\u003e\" alt\u003d\"Company Logo\" style\u003d\"max-height: 70px;\"\u003e\n      \u003c/div\u003e\n      \u003cdiv id\u003d\"form-container\"\u003e\n          \u003ch1\u003eFleetio Setup\u003c/h1\u003e\n          \u003ch3\u003eRequest for: \u003c?\u003d employeeName ?\u003e (Temporary ID: \u003c?\u003d employeeId ?\u003e)\u003c/h3\u003e\n          \u003cp\u003ePlease provide the vehicle details below and confirm completion.\u003c/p\u003e\n          \u003chr\u003e\n          \u003cform id\u003d\"task-form\"\u003e\n              \u003cinput type\u003d\"hidden\" name\u003d\"formType\" value\u003d\"parallel_task_submission\"\u003e\n              \u003cinput type\u003d\"hidden\" name\u003d\"requestId\" value\u003d\"\u003c?\u003d requestId ?\u003e\"\u003e\n              \u003cinput type\u003d\"hidden\" name\u003d\"statusColumn\" value\u003d\"\u003c?\u003d statusColumn ?\u003e\"\u003e\n              \n              \u003cdiv class\u003d\"question-wrapper\"\u003e\n                \u003clabel\u003eAsset Number\u003c/label\u003e\n                \u003cinput type\u003d\"text\" class\u003d\"form-control\" name\u003d\"Fleetio - Asset Number\" required\u003e\n              \u003c/div\u003e\n              \u003cdiv class\u003d\"question-wrapper\"\u003e\n                \u003clabel\u003eVehicle Make\u003c/label\u003e\n                \u003cinput type\u003d\"text\" class\u003d\"form-control\" name\u003d\"Fleetio - Vehicle Make\" required\u003e\n              \u003c/div\u003e\n              \u003cdiv class\u003d\"question-wrapper\"\u003e\n                \u003clabel\u003eVehicle Model\u003c/label\u003e\n                \u003cinput type\u003d\"text\" class\u003d\"form-control\" name\u003d\"Fleetio - Vehicle Model\" required\u003e\n              \u003c/div\u003e\n              \u003cdiv class\u003d\"question-wrapper\"\u003e\n                \u003clabel\u003eLicense Plate\u003c/label\u003e\n                \u003cinput type\u003d\"text\" class\u003d\"form-control\" name\u003d\"Fleetio - License Plate\" required\u003e\n              \u003c/div\u003e\n\n              \u003cdiv id\u003d\"submit-container\"\u003e\n                  \u003cbutton type\u003d\"submit\"\u003eSubmit Fleetio Details\u003c/button\u003e\n              \u003c/div\u003e\n          \u003c/form\u003e\n      \u003c/div\u003e\n      \u003cdiv id\u003d\"status-message\"\u003e\u003c/div\u003e\n    \u003c/div\u003e\n\n    \u003cscript\u003e\n      document.getElementById(\u0027task-form\u0027).addEventListener(\u0027submit\u0027, function(e) {\n        e.preventDefault();\n        const form \u003d e.target;\n        form.querySelector(\u0027button[type\u003d\"submit\"]\u0027).textContent \u003d \u0027Submitting...\u0027;\n        form.querySelector(\u0027button[type\u003d\"submit\"]\u0027).disabled \u003d true;\n        \n        // --- STEP 2: MODIFY THE JAVASCRIPT LOGIC HERE ---\n        const formData \u003d new FormData(form);\n        const data \u003d Object.fromEntries(formData.entries());\n        // Instead of hardcoding \u0027Fleetio - Status\u0027, we now use the generic statusValue.\n        data.statusValue \u003d \u0027Complete\u0027; \n        // --- END OF MODIFICATION ---\n\n        google.script.run\n            .withSuccessHandler(function(response) {\n                document.getElementById(\u0027form-container\u0027).innerHTML \u003d `\u003ch1\u003eConfirmation Received\u003c/h1\u003e\u003cp\u003eThank you, the Fleetio details have been updated. You may now close this window.\u003c/p\u003e`;\n            })\n            .withFailureHandler(function(error) {\n                const statusMessage \u003d document.getElementById(\u0027status-message\u0027);\n                statusMessage.className \u003d \u0027status-error\u0027;\n                statusMessage.textContent \u003d \u0027Error: \u0027 + error.message;\n                form.querySelector(\u0027button[type\u003d\"submit\"]\u0027).textContent \u003d \u0027Submit Fleetio Details\u0027;\n                form.querySelector(\u0027button[type\u003d\"submit\"]\u0027).disabled \u003d false;\n            })\n            .handleParallelTaskSubmission(data);\n      });\n    \u003c/script\u003e\n  \u003c/body\u003e\n\u003c/html\u003e"},{"id":"4e0693cb-99cc-43b2-910b-86e46e6b7b23","name":"JR306090Form","type":"html","source":"\u003c!DOCTYPE html\u003e\n\u003chtml\u003e\n  \u003chead\u003e\n    \u003cbase target\u003d\"_top\"\u003e\n    \u003c?!\u003d HtmlService.createHtmlOutputFromFile(\u0027CSS.html\u0027).getContent(); ?\u003e\n    \u003cstyle\u003e\n      .checkbox-question { display: flex; align-items: center; gap: 15px; margin-bottom: 20px;}\n      .checkbox-question label { margin: 0; font-size: 1.2em; }\n      .checkbox-question input { width: 20px; height: 20px; }\n    \u003c/style\u003e\n  \u003c/head\u003e\n  \u003cbody\u003e\n    \u003cdiv class\u003d\"container\"\u003e\n      \u003cdiv style\u003d\"text-align: center; margin-bottom: 20px;\"\u003e\n        \u003cimg src\u003d\"\u003c?\u003d logoUrl ?\u003e\" alt\u003d\"Company Logo\" style\u003d\"max-height: 70px;\"\u003e\n      \u003c/div\u003e\n      \u003cdiv id\u003d\"form-container\"\u003e\n          \u003ch1\u003eJR / 30-60-90 Plan Setup\u003c/h1\u003e\n          \u003ch3\u003eRequest for: \u003c?\u003d employeeName ?\u003e (Temporary ID: \u003c?\u003d employeeId ?\u003e)\u003c/h3\u003e\n          \u003cp\u003ePlease confirm once the following items have been completed.\u003c/p\u003e\n          \u003chr\u003e\n          \u003cform id\u003d\"task-form\"\u003e\n              \u003cinput type\u003d\"hidden\" name\u003d\"formType\" value\u003d\"parallel_task_submission\"\u003e\n              \u003cinput type\u003d\"hidden\" name\u003d\"requestId\" value\u003d\"\u003c?\u003d requestId ?\u003e\"\u003e\n              \n              \u003cdiv class\u003d\"question-wrapper checkbox-question\"\u003e\n                  \u003cinput type\u003d\"checkbox\" id\u003d\"jr_complete\" name\u003d\"JR - Status\" value\u003d\"Complete\"\u003e\n                  \u003clabel for\u003d\"jr_complete\"\u003eJR Setup Complete?\u003c/label\u003e\n              \u003c/div\u003e\n              \u003cdiv class\u003d\"question-wrapper checkbox-question\"\u003e\n                  \u003cinput type\u003d\"checkbox\" id\u003d\"plan_complete\" name\u003d\"30-60-90 - Status\" value\u003d\"Complete\"\u003e\n                  \u003clabel for\u003d\"plan_complete\"\u003e30-60-90 Plan Complete?\u003c/label\u003e\n              \u003c/div\u003e\n\n              \u003cdiv id\u003d\"submit-container\"\u003e\n                  \u003cbutton type\u003d\"submit\"\u003eSubmit Confirmation\u003c/button\u003e\n              \u003c/div\u003e\n          \u003c/form\u003e\n      \u003c/div\u003e\n      \u003cdiv id\u003d\"status-message\"\u003e\u003c/div\u003e\n    \u003c/div\u003e\n\n    \u003cscript\u003e\n      document.getElementById(\u0027task-form\u0027).addEventListener(\u0027submit\u0027, function(e) {\n        e.preventDefault();\n        const form \u003d e.target;\n        form.querySelector(\u0027button[type\u003d\"submit\"]\u0027).textContent \u003d \u0027Submitting...\u0027;\n        form.querySelector(\u0027button[type\u003d\"submit\"]\u0027).disabled \u003d true;\n\n        const formData \u003d new FormData(form);\n        const data \u003d Object.fromEntries(formData.entries());\n\n        // Manually set status for checkboxes\n        data[\u0027JR - Status\u0027] \u003d form.querySelector(\u0027#jr_complete\u0027).checked ? \u0027Complete\u0027 : \u0027Incomplete\u0027;\n        data[\u002730-60-90 - Status\u0027] \u003d form.querySelector(\u0027#plan_complete\u0027).checked ? \u0027Complete\u0027 : \u0027Incomplete\u0027;\n\n        google.script.run\n            .withSuccessHandler(function(response) {\n                document.getElementById(\u0027form-container\u0027).innerHTML \u003d `\u003ch1\u003eConfirmation Received\u003c/h1\u003e\u003cp\u003eThank you, the status has been updated. You may now close this window.\u003c/p\u003e`;\n            })\n            .withFailureHandler(function(error) {\n                const statusMessage \u003d document.getElementById(\u0027status-message\u0027);\n                statusMessage.className \u003d \u0027status-error\u0027;\n                statusMessage.textContent \u003d \u0027Error: \u0027 + error.message;\n                form.querySelector(\u0027button[type\u003d\"submit\"]\u0027).textContent \u003d \u0027Submit Confirmation\u0027;\n                form.querySelector(\u0027button[type\u003d\"submit\"]\u0027).disabled \u003d false;\n            })\n            .handleParallelTaskSubmission(data);\n      });\n    \u003c/script\u003e\n  \u003c/body\u003e\n\u003c/html\u003e"},{"id":"1df6203c-bd38-4e52-a202-e0a4191ef857","name":"CreditCardForm","type":"html","source":"\u003c!DOCTYPE html\u003e\n\u003chtml\u003e\n  \u003chead\u003e\n    \u003cbase target\u003d\"_top\"\u003e\n    \u003c?!\u003d HtmlService.createHtmlOutputFromFile(\u0027CSS.html\u0027).getContent(); ?\u003e\n    \u003cstyle\u003e\n      .checkbox-question { display: flex; align-items: center; gap: 15px; margin-top: 20px;}\n      .checkbox-question label { margin: 0; font-size: 1.2em; }\n      .checkbox-question input { width: 20px; height: 20px; }\n    \u003c/style\u003e\n  \u003c/head\u003e\n  \u003cbody\u003e\n    \u003cdiv class\u003d\"container\"\u003e\n      \u003cdiv style\u003d\"text-align: center; margin-bottom: 20px;\"\u003e\n        \u003cimg src\u003d\"\u003c?\u003d logoUrl ?\u003e\" alt\u003d\"Company Logo\" style\u003d\"max-height: 70px;\"\u003e\n      \u003c/div\u003e\n      \u003cdiv id\u003d\"form-container\"\u003e\n          \u003ch1\u003eCredit Card Request\u003c/h1\u003e\n          \u003ch3\u003eRequest for: \u003c?\u003d employeeName ?\u003e (Temporary ID: \u003c?\u003d employeeId ?\u003e)\u003c/h3\u003e\n          \u003cp\u003ePlease provide the credit card details below and confirm completion.\u003c/p\u003e\n          \u003chr\u003e\n          \u003cform id\u003d\"task-form\"\u003e\n              \u003cinput type\u003d\"hidden\" name\u003d\"formType\" value\u003d\"parallel_task_submission\"\u003e\n              \u003cinput type\u003d\"hidden\" name\u003d\"statusColumn\" value\u003d\"\u003c?\u003d statusColumn ?\u003e\"\u003e\n              \u003cinput type\u003d\"hidden\" name\u003d\"requestId\" value\u003d\"\u003c?\u003d requestId ?\u003e\"\u003e\n              \n              \u003ch3\u003eCredit Card Limit\u003c/h3\u003e\n              \u003cdiv class\u003d\"question-wrapper\"\u003e\n                \u003clabel\u003ePlease enter the Credit Card Spending Limit\u003c/label\u003e\n                \u003cdiv style\u003d\"display: flex; gap: 10px; align-items: center;\"\u003e\n                    \u003cinput type\u003d\"text\" class\u003d\"form-control\" name\u003d\"Credit Card - Limit\" placeholder\u003d\"$\" required style\u003d\"width: 75%;\"\u003e\n                    \u003cselect class\u003d\"form-control\" name\u003d\"Credit Card - Currency\" required style\u003d\"width: 25%;\"\u003e\n                        \u003coption value\u003d\"CAD\"\u003eCAD\u003c/option\u003e\n                        \u003coption value\u003d\"USD\"\u003eUSD\u003c/option\u003e\n                    \u003c/select\u003e\n                \u003c/div\u003e\n              \u003c/div\u003e\n\n              \u003chr\u003e\n              \n              \u003cdiv id\u003d\"additional-accounts\"\u003e\u003c/div\u003e\n\n              \u003cdiv class\u003d\"question-wrapper checkbox-question\"\u003e\n                  \u003cinput type\u003d\"checkbox\" id\u003d\"isComplete\" name\u003d\"isComplete\" required\u003e\n                  \u003clabel for\u003d\"isComplete\"\u003eHas the main credit card setup been completed?\u003c/label\u003e\n              \u003c/div\u003e\n\n              \u003cdiv id\u003d\"submit-container\"\u003e\n                  \u003cbutton type\u003d\"submit\"\u003eSubmit Credit Card Details\u003c/button\u003e\n              \u003c/div\u003e\n          \u003c/form\u003e\n      \u003c/div\u003e\n      \u003cdiv id\u003d\"status-message\"\u003e\u003c/div\u003e\n    \u003c/div\u003e\n\n    \u003cscript\u003e\n      const additionalAccounts \u003d \"\u003c?\u003d additionalAccounts ?\u003e\";\n      const container \u003d document.getElementById(\u0027additional-accounts\u0027);\n\n      if (additionalAccounts.includes(\"Amazon\")) {\n        container.innerHTML +\u003d `\n            \u003chr\u003e\u003ch3\u003eAmazon Account\u003c/h3\u003e\n            \u003cdiv class\u003d\"question-wrapper checkbox-question\"\u003e\n                \u003cinput type\u003d\"checkbox\" id\u003d\"amazon_complete\" name\u003d\"Amazon - Status\" value\u003d\"Complete\"\u003e\n                \u003clabel for\u003d\"amazon_complete\"\u003eAmazon Setup Complete?\u003c/label\u003e\n            \u003c/div\u003e`;\n      }\n      if (additionalAccounts.includes(\"Staples\")) {\n        container.innerHTML +\u003d `\n            \u003chr\u003e\u003ch3\u003eStaples Account\u003c/h3\u003e\n            \u003cdiv class\u003d\"question-wrapper checkbox-question\"\u003e\n                \u003cinput type\u003d\"checkbox\" id\u003d\"staples_complete\" name\u003d\"Staples - Status\" value\u003d\"Complete\"\u003e\n                \u003clabel for\u003d\"staples_complete\"\u003eStaples Setup Complete?\u003c/label\u003e\n            \u003c/div\u003e`;\n      }\n      if (additionalAccounts.includes(\"HomeDepot\")) {\n        container.innerHTML +\u003d `\n            \u003chr\u003e\u003ch3\u003eHomeDepot Account\u003c/h3\u003e\n            \u003cdiv class\u003d\"question-wrapper checkbox-question\"\u003e\n                \u003cinput type\u003d\"checkbox\" id\u003d\"homedepot_complete\" name\u003d\"HomeDepot - Status\" value\u003d\"Complete\"\u003e\n                \u003clabel for\u003d\"homedepot_complete\"\u003eHomeDepot Setup Complete?\u003c/label\u003e\n            \u003c/div\u003e`;\n      }\n\n      document.getElementById(\u0027task-form\u0027).addEventListener(\u0027submit\u0027, function(e) {\n        e.preventDefault();\n        const form \u003d e.target;\n        form.querySelector(\u0027button[type\u003d\"submit\"]\u0027).textContent \u003d \u0027Submitting...\u0027;\n        form.querySelector(\u0027button[type\u003d\"submit\"]\u0027).disabled \u003d true;\n\n        const formData \u003d new FormData(form);\n        const data \u003d Object.fromEntries(formData.entries());\n        data[\u0027Credit Card - Status\u0027] \u003d form.isComplete.checked ? \u0027Complete\u0027 : \u0027Incomplete\u0027;\n        delete data.isComplete;\n\n        if(form.querySelector(\u0027#amazon_complete\u0027)) data[\u0027Amazon - Status\u0027] \u003d form.querySelector(\u0027#amazon_complete\u0027).checked ? \u0027Complete\u0027 : \u0027Incomplete\u0027;\n        if(form.querySelector(\u0027#staples_complete\u0027)) data[\u0027Staples - Status\u0027] \u003d form.querySelector(\u0027#staples_complete\u0027).checked ? \u0027Complete\u0027 : \u0027Incomplete\u0027;\n        if(form.querySelector(\u0027#homedepot_complete\u0027)) data[\u0027HomeDepot - Status\u0027] \u003d form.querySelector(\u0027#homedepot_complete\u0027).checked ? \u0027Complete\u0027 : \u0027Incomplete\u0027;\n\n        google.script.run\n            .withSuccessHandler(function(response) {\n                document.getElementById(\u0027form-container\u0027).innerHTML \u003d `\u003ch1\u003eConfirmation Received\u003c/h1\u003e\u003cp\u003eThank you, the Credit Card details have been updated. You may now close this window.\u003c/p\u003e`;\n            })\n            .withFailureHandler(function(error) {\n                const statusMessage \u003d document.getElementById(\u0027status-message\u0027);\n                statusMessage.className \u003d \u0027status-error\u0027;\n                statusMessage.textContent \u003d \u0027Error: \u0027 + error.message;\n                form.querySelector(\u0027button[type\u003d\"submit\"]\u0027).textContent \u003d \u0027Submit Credit Card Details\u0027;\n                form.querySelector(\u0027button[type\u003d\"submit\"]\u0027).disabled \u003d false;\n            })\n            .handleParallelTaskSubmission(data);\n      });\n    \u003c/script\u003e\n  \u003c/body\u003e\n\u003c/html\u003e"}]}